<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>First Sip - Professional Networking</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,700&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* New design system */
            --cream: #F5F0E8;
            --warm-white: #FDFAF4;
            --espresso: #1C1208;
            --brown: #3D2B1A;
            --caramel: #C07C3A;
            --caramel-light: #D4964F;
            --latte: #EAD9B8;
            --latte-soft: #F2E9D6;
            --sage: #8A9E85;
            --muted: #7A6E62;
            --card: #FFFDF8;
            --border: rgba(192,124,58,0.14);
            --sidebar-w: 228px;

            /* Legacy aliases so existing JS-generated HTML still works */
            --primary: #C07C3A;
            --primary-light: #D4964F;
            --primary-dark: #1C1208;
            --accent: #EAD9B8;
            --accent-light: #F2E9D6;
            --success: #4CAF50;
            --danger: #FF6B6B;
            --bg-dark: #1C1208;
            --bg-light: #F5F0E8;
            --text-dark: #1C1208;
            --text-light: #FDFAF4;
            --shadow: 0 4px 12px rgba(0,0,0,0.06);
            --shadow-hover: 0 8px 24px rgba(192,124,58,0.15);
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--cream);
            color: var(--espresso);
            line-height: 1.6;
        }

        html { height: 100%; }

        /* ‚îÄ‚îÄ‚îÄ TOP BAR ‚îÄ‚îÄ‚îÄ */
        .topbar {
            height: 56px;
            background: var(--card);
            border-bottom: 1px solid var(--border);
            display: none; /* shown only when logged in */
            align-items: center;
            padding: 0 20px 0 0;
            flex-shrink: 0;
            z-index: 50;
            position: fixed;
            top: 0; left: 0; right: 0;
        }
        .topbar.visible { display: flex; }

        .topbar-logo {
            width: var(--sidebar-w);
            padding: 0 20px;
            font-family: 'Playfair Display', serif;
            font-size: 19px;
            font-weight: 900;
            color: var(--espresso);
            flex-shrink: 0;
            border-right: 1px solid var(--border);
            height: 100%;
            display: flex;
            align-items: center;
            gap: 7px;
        }
        .topbar-logo span { color: var(--caramel); }

        .topbar-search { flex: 1; padding: 0 20px; }

        .topbar-search-input {
            width: 280px;
            height: 34px;
            border: 1.5px solid var(--border);
            border-radius: 8px;
            background: var(--cream);
            padding: 0 14px 0 34px;
            font-family: 'DM Sans', sans-serif;
            font-size: 13px;
            color: var(--espresso);
            outline: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%237A6E62' stroke-width='2'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cpath d='m21 21-4.35-4.35'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 10px center;
            transition: border-color 0.2s;
        }
        .topbar-search-input:focus { border-color: var(--caramel); }
        .topbar-search-input::placeholder { color: var(--muted); }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-left: auto;
        }

        .icon-btn {
            width: 34px; height: 34px;
            border-radius: 8px;
            border: none;
            background: none;
            color: var(--muted);
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px;
            transition: background 0.15s, color 0.15s;
            position: relative;
        }
        .icon-btn:hover { background: var(--latte-soft); color: var(--espresso); }

        .notif-dot {
            position: absolute;
            top: 6px; right: 6px;
            width: 7px; height: 7px;
            background: var(--caramel);
            border-radius: 50%;
            border: 1.5px solid var(--card);
        }

        .user-chip {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 10px 4px 4px;
            border-radius: 20px;
            border: 1.5px solid var(--border);
            cursor: pointer;
            transition: background 0.15s;
            margin-left: 4px;
            background: var(--warm-white);
        }
        .user-chip:hover { background: var(--latte-soft); }

        .user-chip-av {
            width: 28px; height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--caramel), var(--caramel-light));
            display: flex; align-items: center; justify-content: center;
            font-size: 11px; font-weight: 700; color: white;
        }
        .user-chip-name { font-size: 13px; font-weight: 500; color: var(--espresso); }

        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* App body shifts down when topbar is visible */
        body.app-mode { overflow: hidden; }
        body.app-mode .app-container { padding-top: 56px; height: 100vh; box-sizing: border-box; }

        /* ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ */
        .sidebar {
            background: var(--card);
            border-right: 1px solid var(--border);
            position: fixed;
            left: 0;
            top: 56px;
            height: calc(100vh - 56px);
            width: var(--sidebar-w);
            overflow-y: auto;
            z-index: 90;
            display: flex;
            flex-direction: column;
            padding: 16px 12px;
        }

        /* Sidebar hidden on landing/login/signup */
        body:not(.app-mode) .sidebar { display: none; }

        .sidebar-label {
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 1.2px;
            text-transform: uppercase;
            color: var(--muted);
            padding: 0 8px;
            margin-bottom: 4px;
            margin-top: 16px;
        }
        .sidebar-label:first-child { margin-top: 0; }

        .sidebar-divider {
            height: 1px;
            background: var(--border);
            margin: 10px 0;
        }

        .sidebar-bottom {
            margin-top: auto;
            padding-top: 12px;
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-weight: 900;
            font-size: 19px;
            color: var(--espresso);
        }

        .sidebar nav {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 9px 10px;
            border-radius: 9px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--muted);
            transition: all 0.15s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-family: 'DM Sans', sans-serif;
            position: relative;
        }

        .nav-item:hover { background: var(--latte-soft); color: var(--espresso); }

        .nav-item.active {
            background: var(--latte);
            color: var(--brown);
            font-weight: 600;
        }

        .nav-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
            opacity: 0.8;
            flex-shrink: 0;
        }

        .nav-badge {
            margin-left: auto;
            background: var(--caramel);
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        .sidebar-spacer { flex: 1; }

        .logout-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 9px 10px;
            border-radius: 9px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--muted);
            transition: all 0.15s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-family: 'DM Sans', sans-serif;
            flex-shrink: 0;
        }

        .logout-btn:hover { background: var(--latte-soft); color: var(--espresso); }

        /* ‚îÄ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ‚îÄ */
        .main-content {
            margin-left: var(--sidebar-w);
            padding: 2rem;
            overflow-y: auto;
            flex: 1;
            min-width: 0;
            height: calc(100vh - 56px);
        }

        /* Landing page ‚Äî no sidebar offset */
        body:not(.app-mode) .main-content {
            margin-left: 0;
            height: 100vh;
            padding: 0;
        }

        .content-view {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .content-view.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Headers */
        h1 {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            font-size: 28px;
            margin-bottom: 1rem;
            color: var(--espresso);
        }

        h2 {
            font-family: 'Playfair Display', serif;
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--espresso);
        }

        h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--espresso);
            margin-bottom: 0.5rem;
        }

        /* Cards */
        .card {
            background: var(--card);
            border-radius: 14px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 28px rgba(28,18,8,0.08);
        }

        .card.compact {
            padding: 1rem;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-dark);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 14px;
            border: 1.5px solid var(--border);
            border-radius: 8px;
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            transition: all 0.2s ease;
            background: var(--warm-white);
            color: var(--espresso);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--caramel);
            box-shadow: 0 0 0 3px rgba(192,124,58,0.1);
            background: var(--warm-white);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            font-family: 'DM Sans', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--espresso);
            color: var(--cream);
        }

        .btn-primary:hover {
            background: var(--brown);
            transform: translateY(-1px);
            box-shadow: 0 4px 14px rgba(28,18,8,0.2);
        }

        .btn-secondary {
            background: var(--latte-soft);
            color: var(--espresso);
            border: 1.5px solid var(--latte);
        }

        .btn-secondary:hover {
            background: var(--latte);
        }

        .btn-accent {
            background: var(--caramel);
            color: white;
        }

        .btn-accent:hover {
            background: var(--caramel-light);
            transform: translateY(-1px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #e55555;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 12px;
        }

        .btn-icon {
            padding: 10px 12px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        /* Auth Screens */
        .auth-container {
            max-width: 500px;
            margin: 4rem auto;
            background: var(--card);
            padding: 3rem;
            border-radius: 18px;
            border: 1px solid var(--border);
        }

        .auth-container h1 {
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .auth-subtitle {
            text-align: center;
            color: var(--muted);
            margin-bottom: 2rem;
            font-size: 14px;
        }

        .toggle-auth {
            text-align: center;
            margin-top: 1.5rem;
            font-size: 14px;
        }

        .toggle-auth button {
            background: none;
            border: none;
            color: var(--caramel);
            text-decoration: underline;
            cursor: pointer;
            font-weight: 600;
        }

        /* === LANDING PAGE === */
        .sidebar-hidden .sidebar { display: none; }
        .sidebar-hidden .main-content { margin-left: 0; padding: 0; width: 100%; }

        .landing-page {
            min-height: 100vh;
            overflow-x: hidden;
            background: var(--warm-white);
            color: var(--espresso);
            font-family: 'DM Sans', sans-serif;
            font-weight: 400;
        }

        /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
        .landing-page nav {
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 48px;
            background: rgba(253, 250, 244, 0.88);
            backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(192, 124, 58, 0.12);
        }

        .lp-nav-logo {
            font-family: 'Playfair Display', serif;
            font-size: 22px;
            font-weight: 900;
            color: var(--espresso);
            letter-spacing: -0.5px;
        }
        .lp-nav-logo span { color: var(--caramel); }

        .lp-nav-links { display: flex; gap: 36px; list-style: none; }
        .lp-nav-links a {
            text-decoration: none;
            color: var(--muted);
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 0.3px;
            transition: color 0.2s;
            cursor: pointer;
        }
        .lp-nav-links a:hover { color: var(--espresso); }

        .lp-nav-actions { display: flex; gap: 12px; align-items: center; }

        .lp-btn-ghost {
            background: none;
            border: none;
            color: var(--brown);
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            padding: 10px 18px;
            border-radius: 8px;
            transition: background 0.2s;
        }
        .lp-btn-ghost:hover { background: var(--latte); }

        .lp-btn-primary {
            background: var(--espresso);
            color: var(--cream);
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            padding: 10px 22px;
            border-radius: 8px;
            border: none;
            transition: background 0.2s, transform 0.15s;
            letter-spacing: 0.2px;
        }
        .lp-btn-primary:hover { background: var(--brown); transform: translateY(-1px); }

        /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
        .lp-hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            padding: 120px 48px 80px;
            position: relative;
            overflow: hidden;
        }

        .lp-hero-bg {
            position: absolute;
            inset: 0;
            background:
                radial-gradient(ellipse 60% 50% at 70% 40%, rgba(192, 124, 58, 0.10) 0%, transparent 70%),
                radial-gradient(ellipse 40% 60% at 20% 80%, rgba(138, 158, 133, 0.10) 0%, transparent 60%);
        }

        .lp-coffee-ring {
            position: absolute;
            right: 6%; top: 18%;
            width: 480px; height: 480px;
            border-radius: 50%;
            border: 1.5px solid rgba(192, 124, 58, 0.15);
            animation: lpSlowSpin 40s linear infinite;
        }
        .lp-coffee-ring::before {
            content: '';
            position: absolute; inset: 24px;
            border-radius: 50%;
            border: 1px solid rgba(192, 124, 58, 0.10);
        }
        .lp-coffee-ring::after {
            content: '';
            position: absolute; inset: 48px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(192, 124, 58, 0.06) 0%, transparent 70%);
        }
        @keyframes lpSlowSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .lp-float-card {
            position: absolute;
            background: var(--card);
            border: 1px solid rgba(192, 124, 58, 0.18);
            border-radius: 16px;
            padding: 14px 18px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 8px 32px rgba(28, 18, 8, 0.08);
            animation: lpFloatUp 6s ease-in-out infinite;
        }
        .lp-float-card:nth-child(2) { animation-delay: -2s; }
        .lp-float-card:nth-child(3) { animation-delay: -4s; }
        @keyframes lpFloatUp {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }
        .lp-card-1 { right: 14%; top: 28%; }
        .lp-card-2 { right: 28%; top: 55%; }
        .lp-card-3 { right: 8%; top: 64%; }

        .lp-avatar {
            width: 40px; height: 40px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 14px;
            color: white; flex-shrink: 0;
        }
        .lp-avatar.a { background: linear-gradient(135deg, #C07C3A, #D4964F); }
        .lp-avatar.b { background: linear-gradient(135deg, #8A9E85, #6B8566); }
        .lp-avatar.c { background: linear-gradient(135deg, #3D2B1A, #6B4A2E); }

        .lp-float-name { font-size: 13px; font-weight: 600; color: var(--espresso); line-height: 1; margin-bottom: 3px; }
        .lp-float-meta { font-size: 11px; color: var(--muted); }

        .lp-match-badge {
            margin-left: auto;
            background: var(--cream);
            color: var(--caramel);
            font-size: 11px; font-weight: 600;
            padding: 4px 8px;
            border-radius: 20px;
            border: 1px solid var(--latte);
        }

        .lp-hero-content {
            max-width: 580px;
            position: relative; z-index: 1;
            animation: lpFadeUp 0.8s ease both;
        }
        @keyframes lpFadeUp {
            from { opacity: 0; transform: translateY(24px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .lp-hero-tag {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--latte);
            color: var(--brown);
            font-size: 12px; font-weight: 600;
            letter-spacing: 0.8px;
            text-transform: uppercase;
            padding: 6px 14px;
            border-radius: 20px;
            margin-bottom: 28px;
        }
        .lp-hero-tag::before {
            content: '';
            width: 6px; height: 6px;
            border-radius: 50%;
            background: var(--caramel);
        }

        .landing-page h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(44px, 5.5vw, 72px);
            font-weight: 900;
            line-height: 1.05;
            letter-spacing: -1.5px;
            color: var(--espresso);
            margin-bottom: 24px;
        }
        .landing-page h1 em { font-style: italic; color: var(--caramel); }

        .lp-hero-sub {
            font-size: 17px;
            line-height: 1.7;
            color: var(--muted);
            max-width: 460px;
            margin-bottom: 40px;
            font-weight: 300;
        }

        .lp-hero-cta { display: flex; gap: 14px; align-items: center; flex-wrap: wrap; }

        .lp-btn-cta {
            background: var(--caramel);
            color: white;
            font-family: 'DM Sans', sans-serif;
            font-size: 15px; font-weight: 600;
            padding: 16px 32px;
            border-radius: 10px; border: none;
            cursor: pointer;
            transition: all 0.2s;
            letter-spacing: 0.2px;
            box-shadow: 0 4px 24px rgba(192, 124, 58, 0.35);
        }
        .lp-btn-cta:hover {
            background: var(--caramel-light);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(192, 124, 58, 0.40);
        }

        .lp-btn-outline {
            background: transparent;
            color: var(--brown);
            font-family: 'DM Sans', sans-serif;
            font-size: 15px; font-weight: 500;
            padding: 15px 28px;
            border-radius: 10px;
            border: 1.5px solid rgba(61, 43, 26, 0.25);
            cursor: pointer;
            transition: all 0.2s;
        }
        .lp-btn-outline:hover { border-color: var(--caramel); color: var(--caramel); }

        .lp-social-proof {
            margin-top: 52px;
            display: flex; align-items: center; gap: 16px;
        }
        .lp-avatars-row { display: flex; }
        .lp-mini-av {
            width: 34px; height: 34px;
            border-radius: 50%;
            border: 2.5px solid var(--warm-white);
            margin-left: -10px;
            font-size: 12px; font-weight: 700;
            display: flex; align-items: center; justify-content: center;
            color: white;
        }
        .lp-mini-av:first-child { margin-left: 0; }
        .lp-mini-av.m1 { background: var(--caramel); }
        .lp-mini-av.m2 { background: var(--sage); }
        .lp-mini-av.m3 { background: var(--brown); }
        .lp-mini-av.m4 { background: #C4956A; }
        .lp-proof-text { font-size: 13px; color: var(--muted); line-height: 1.4; }
        .lp-proof-text strong { color: var(--espresso); font-weight: 600; }

        /* ‚îÄ‚îÄ STATS BAR ‚îÄ‚îÄ */
        .lp-stats-bar {
            background: var(--espresso);
            padding: 28px 48px;
            display: flex;
            justify-content: center;
            gap: 80px;
            flex-wrap: wrap;
        }
        .lp-stat-item { text-align: center; }
        .lp-stat-num {
            font-family: 'Playfair Display', serif;
            font-size: 32px; font-weight: 700;
            color: var(--caramel-light);
            line-height: 1; margin-bottom: 4px;
        }
        .lp-stat-label { font-size: 13px; color: rgba(245, 240, 232, 0.6); letter-spacing: 0.3px; }

        /* ‚îÄ‚îÄ SECTION BASE ‚îÄ‚îÄ */
        .lp-section { padding: 96px 48px; }
        .lp-section-tag {
            font-size: 11px; font-weight: 700;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            color: var(--caramel);
            margin-bottom: 16px;
        }
        .landing-page h2 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(32px, 4vw, 52px);
            font-weight: 700;
            line-height: 1.1;
            letter-spacing: -1px;
            color: var(--espresso);
            margin-bottom: 16px;
        }
        .landing-page h2 em { font-style: italic; color: var(--caramel); }
        .lp-section-sub {
            font-size: 16px;
            color: var(--muted);
            line-height: 1.7;
            font-weight: 300;
            max-width: 520px;
        }

        /* ‚îÄ‚îÄ HOW IT WORKS ‚îÄ‚îÄ */
        .lp-how { background: var(--cream); }
        .lp-how-inner { max-width: 1100px; margin: 0 auto; }
        .lp-how-header { margin-bottom: 64px; }
        .lp-steps {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 32px;
        }
        .lp-step {
            background: var(--card);
            border: 1px solid rgba(192, 124, 58, 0.15);
            border-radius: 20px;
            padding: 36px 32px;
            position: relative;
            transition: transform 0.25s, box-shadow 0.25s;
        }
        .lp-step:hover { transform: translateY(-4px); box-shadow: 0 16px 48px rgba(28, 18, 8, 0.10); }
        .lp-step-num {
            font-family: 'Playfair Display', serif;
            font-size: 64px; font-weight: 900;
            color: rgba(192, 124, 58, 0.45);
            line-height: 1;
            position: absolute; top: 20px; right: 24px;
            text-shadow: 0 2px 12px rgba(192, 124, 58, 0.15);
        }
        .lp-step-icon {
            width: 48px; height: 48px;
            background: var(--latte);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 22px;
            margin-bottom: 20px;
        }
        .lp-step h3 {
            font-family: 'Playfair Display', serif;
            font-size: 20px; font-weight: 700;
            color: var(--espresso);
            margin-bottom: 12px;
        }
        .lp-step p { font-size: 14px; line-height: 1.7; color: var(--muted); font-weight: 300; }

        /* ‚îÄ‚îÄ FEATURES ‚îÄ‚îÄ */
        .lp-features-inner {
            max-width: 1100px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 80px;
            align-items: center;
        }
        .lp-feature-list { display: flex; flex-direction: column; gap: 28px; }
        .lp-feature-item {
            display: flex; gap: 20px;
            align-items: flex-start;
            padding: 24px; border-radius: 16px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .lp-feature-item:hover, .lp-feature-item.active { background: var(--cream); }
        .lp-feature-icon {
            width: 44px; height: 44px; flex-shrink: 0;
            background: var(--latte);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px;
        }
        .lp-feature-item.active .lp-feature-icon { background: var(--espresso); }
        .lp-feature-item h3 { font-size: 16px; font-weight: 600; color: var(--espresso); margin-bottom: 6px; }
        .lp-feature-item p { font-size: 14px; color: var(--muted); line-height: 1.6; font-weight: 300; }

        /* App mockup */
        .lp-app-mockup {
            background: var(--espresso);
            border-radius: 28px;
            padding: 24px;
            box-shadow: 0 32px 80px rgba(28, 18, 8, 0.20);
            position: relative; overflow: hidden;
        }
        .lp-app-mockup::before {
            content: '';
            position: absolute; top: -60px; right: -60px;
            width: 200px; height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(192, 124, 58, 0.15) 0%, transparent 70%);
        }
        .lp-mockup-bar { display: flex; gap: 6px; margin-bottom: 20px; }
        .lp-mockup-dot { width: 8px; height: 8px; border-radius: 50%; }
        .lp-mockup-dot.r { background: #FF5F57; }
        .lp-mockup-dot.y { background: #FEBC2E; }
        .lp-mockup-dot.g { background: #28C840; }
        .lp-mockup-tabs {
            display: flex; gap: 4px;
            background: rgba(255,255,255,0.07);
            border-radius: 10px; padding: 4px;
            margin-bottom: 20px;
        }
        .lp-mockup-tab {
            flex: 1; text-align: center;
            padding: 8px; border-radius: 8px;
            font-size: 12px; font-weight: 500;
            color: rgba(245, 240, 232, 0.45);
        }
        .lp-mockup-tab.active { background: var(--caramel); color: white; }
        .lp-mockup-card {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 14px; padding: 16px;
            margin-bottom: 10px;
            display: flex; align-items: center; gap: 14px;
        }
        .lp-mc-av {
            width: 42px; height: 42px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 14px; font-weight: 700;
            color: white; flex-shrink: 0;
        }
        .lp-mc-av.a1 { background: linear-gradient(135deg, var(--caramel), #D4964F); }
        .lp-mc-av.a2 { background: linear-gradient(135deg, var(--sage), #6B8566); }
        .lp-mc-av.a3 { background: linear-gradient(135deg, #C4956A, #9E6B3A); }
        .lp-mc-info { flex: 1; }
        .lp-mc-name { font-size: 13px; font-weight: 600; color: rgba(245,240,232,0.9); margin-bottom: 3px; }
        .lp-mc-meta { font-size: 11px; color: rgba(245,240,232,0.45); }
        .lp-mc-btn {
            background: rgba(192, 124, 58, 0.25);
            color: var(--caramel-light);
            font-size: 11px; font-weight: 600;
            padding: 6px 12px; border-radius: 20px;
            border: 1px solid rgba(192, 124, 58, 0.3);
            cursor: pointer; white-space: nowrap;
        }

        /* ‚îÄ‚îÄ MOCKUP PANELS ‚îÄ‚îÄ */
        .lp-mockup-panel {
            display: none;
            animation: lpPanelIn 0.3s ease both;
        }
        .lp-mockup-panel.active { display: block; }
        @keyframes lpPanelIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Match bar */
        .lp-match-bar-wrap {
            display: flex; align-items: center; gap: 6px;
            margin-top: 5px;
        }
        .lp-match-bar {
            height: 4px; border-radius: 4px;
            background: linear-gradient(90deg, var(--caramel), var(--caramel-light));
            flex-shrink: 0;
        }
        .lp-match-pct {
            font-size: 10px; font-weight: 700;
            color: var(--caramel-light); white-space: nowrap;
        }

        /* Icebreaker panel */
        .lp-ice-header {
            display: flex; align-items: center; gap: 10px;
            padding: 12px 14px;
            background: rgba(255,255,255,0.06);
            border-radius: 12px;
            margin-bottom: 14px;
        }
        .lp-ice-label {
            font-size: 10px; font-weight: 700;
            letter-spacing: 0.8px; text-transform: uppercase;
            color: rgba(245,240,232,0.4);
            margin-bottom: 10px;
        }
        .lp-ice-card {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 11px 14px;
            font-size: 12px; line-height: 1.5;
            color: rgba(245,240,232,0.82);
            margin-bottom: 8px;
            cursor: pointer;
            transition: background 0.2s, border-color 0.2s;
        }
        .lp-ice-card:hover {
            background: rgba(192,124,58,0.18);
            border-color: rgba(192,124,58,0.35);
        }

        /* Groups panel */
        .lp-group-card {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 14px; padding: 14px;
            margin-bottom: 10px;
            display: flex; align-items: center; gap: 12px;
        }
        .lp-group-icon {
            width: 38px; height: 38px; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px; flex-shrink: 0;
        }
        .lp-group-badge {
            font-size: 10px; font-weight: 700;
            color: var(--sage);
            background: rgba(138,158,133,0.15);
            border: 1px solid rgba(138,158,133,0.3);
            padding: 4px 8px; border-radius: 20px;
            white-space: nowrap;
        }

        /* Schedule panel */
        .lp-sched-header {
            display: flex; align-items: center; gap: 10px;
            padding: 12px 14px;
            background: rgba(255,255,255,0.06);
            border-radius: 12px;
            margin-bottom: 14px;
        }
        .lp-sched-pill {
            margin-left: auto;
            font-size: 10px; font-weight: 700;
            color: var(--caramel-light);
            background: rgba(192,124,58,0.2);
            border: 1px solid rgba(192,124,58,0.3);
            padding: 4px 9px; border-radius: 20px;
        }
        .lp-sched-slot {
            display: flex; align-items: center; gap: 12px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.07);
            border-radius: 12px; padding: 12px 14px;
            margin-bottom: 8px;
            transition: background 0.2s, border-color 0.2s;
        }
        .lp-sched-slot--active {
            background: rgba(192,124,58,0.12);
            border-color: rgba(192,124,58,0.3);
        }
        .lp-sched-dot {
            width: 8px; height: 8px; border-radius: 50%;
            background: var(--caramel); flex-shrink: 0;
        }

        /* ‚îÄ‚îÄ FOUNDER ‚îÄ‚îÄ */
        .lp-founder { background: var(--cream); }
        .lp-founder-inner {
            max-width: 900px; margin: 0 auto;
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 64px;
            align-items: center;
        }
        .lp-founder-portrait {
            width: 220px; height: 220px;
            border-radius: 50%;
            background: var(--latte);
            display: flex; align-items: center; justify-content: center;
            font-family: 'Playfair Display', serif;
            font-size: 72px; font-weight: 900;
            color: var(--caramel);
            flex-shrink: 0;
            position: relative; overflow: hidden;
            border: 4px solid rgba(192, 124, 58, 0.2);
        }
        .lp-founder-portrait img { width: 100%; height: 100%; object-fit: cover; }
        .lp-founder-quote {
            font-family: 'Playfair Display', serif;
            font-size: clamp(20px, 2.5vw, 28px);
            font-style: italic; font-weight: 700;
            line-height: 1.4;
            color: var(--espresso);
            margin-bottom: 24px;
        }
        .lp-founder-attr {
            font-size: 14px; color: var(--muted);
            display: flex; align-items: center; gap: 12px;
        }
        .lp-founder-attr::before {
            content: '';
            width: 32px; height: 1.5px;
            background: var(--caramel);
        }

        /* ‚îÄ‚îÄ CTA SECTION ‚îÄ‚îÄ */
        .lp-cta-section {
            background: var(--espresso);
            text-align: center;
            padding: 100px 48px;
            position: relative; overflow: hidden;
        }
        .lp-cta-section::before {
            content: '';
            position: absolute;
            top: -100px; left: 50%;
            transform: translateX(-50%);
            width: 600px; height: 600px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(192, 124, 58, 0.12) 0%, transparent 70%);
        }
        .lp-cta-section h2 { color: var(--cream); max-width: 600px; margin: 0 auto 16px; }
        .lp-cta-section .lp-section-sub { color: rgba(245, 240, 232, 0.55); margin: 0 auto 40px; }

        /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
        .lp-footer {
            background: var(--espresso);
            border-top: 1px solid rgba(245, 240, 232, 0.08);
            padding: 32px 48px;
            display: flex; align-items: center;
            justify-content: space-between;
        }
        .lp-footer-logo {
            font-family: 'Playfair Display', serif;
            font-size: 18px; font-weight: 900;
            color: var(--cream);
        }
        .lp-footer-logo span { color: var(--caramel); }
        .lp-footer-text { font-size: 13px; color: rgba(245, 240, 232, 0.35); }
        .lp-footer-links { display: flex; gap: 24px; list-style: none; }
        .lp-footer-links a {
            font-size: 13px; color: rgba(245, 240, 232, 0.45);
            text-decoration: none; transition: color 0.2s;
        }
        .lp-footer-links a:hover { color: var(--caramel-light); }

        /* ‚îÄ‚îÄ SCROLL ANIMATIONS ‚îÄ‚îÄ */
        .reveal {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }
        .reveal.visible { opacity: 1; transform: translateY(0); }

        /* ‚îÄ‚îÄ HAMBURGER (mobile) ‚îÄ‚îÄ */
        .lp-hamburger {
            display: none;
            background: none; border: none;
            cursor: pointer; padding: 8px;
            z-index: 101;
        }
        .lp-hamburger span {
            display: block;
            width: 22px; height: 2px;
            background: var(--espresso);
            margin: 5px 0; border-radius: 2px;
            transition: all 0.3s ease;
        }
        .lp-hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
        .lp-hamburger.active span:nth-child(2) { opacity: 0; }
        .lp-hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(5px, -5px); }

        .lp-mobile-menu {
            display: none;
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(253, 250, 244, 0.97);
            backdrop-filter: blur(20px);
            z-index: 99;
            flex-direction: column;
            justify-content: center; align-items: center;
            gap: 1.5rem;
        }
        .lp-mobile-menu.active { display: flex; }
        .lp-mobile-menu a {
            font-size: 18px; color: var(--muted);
            text-decoration: none; padding: 12px 24px;
            cursor: pointer; transition: color 0.2s;
        }
        .lp-mobile-menu a:hover { color: var(--espresso); }
        .lp-mobile-buttons {
            display: flex; flex-direction: column;
            gap: 0.75rem; margin-top: 1rem;
            width: 100%; max-width: 280px;
        }
        .lp-mobile-buttons .lp-btn-ghost,
        .lp-mobile-buttons .lp-btn-primary {
            width: 100%; min-height: 48px;
            font-size: 15px; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
        }

        /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
        @media (max-width: 900px) {
            .landing-page nav { padding: 16px 24px; }
            .lp-nav-links { display: none; }
            .lp-nav-actions { display: none; }
            .lp-hamburger { display: block; }
            .lp-hero { padding: 100px 24px 60px; }
            .lp-float-card { display: none; }
            .lp-coffee-ring { display: none; }
            .lp-section { padding: 64px 24px; }
            .lp-steps { grid-template-columns: 1fr; }
            .lp-features-inner { grid-template-columns: 1fr; gap: 40px; }
            .lp-founder-inner { grid-template-columns: 1fr; text-align: center; }
            .lp-founder-portrait { margin: 0 auto; }
            .lp-footer { flex-direction: column; gap: 16px; text-align: center; }
            .lp-stats-bar { gap: 40px; padding: 28px 24px; }
            .lp-cta-section { padding: 64px 24px; }
        }
        @media (max-width: 600px) {
            .lp-hero { padding: 90px 20px 48px; }
            .lp-section { padding: 48px 20px; }
            .landing-page h1 { font-size: 36px; }
            .landing-page h2 { font-size: 28px; }
            .lp-stats-bar { gap: 24px; }
            .lp-cta-section { padding: 48px 20px; }
            .lp-footer { padding: 24px 20px; }
        }


        /* Grid */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .grid.two-col {
            grid-template-columns: repeat(2, 1fr);
        }

        /* Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 28px;
            color: var(--accent);
            margin-bottom: 0.5rem;
        }

        .stat-card p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Zero-state CTA Cards */
        .cta-cards-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 14px;
            margin-bottom: 24px;
        }

        .cta-card {
            background: var(--card);
            border: 1.5px dashed rgba(192,124,58,0.25);
            border-radius: 16px;
            padding: 24px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .cta-card:hover {
            border-color: var(--caramel);
            transform: translateY(-3px);
            box-shadow: 0 10px 28px rgba(192,124,58,0.12);
        }

        .cta-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
        }

        .cta-card h3 {
            font-size: 14px;
            font-weight: 600;
            color: var(--espresso);
            margin-bottom: 0.4rem;
        }

        .cta-card p {
            font-size: 12px;
            color: var(--muted);
            line-height: 1.5;
            font-weight: 300;
        }

        /* Hub Tab Bar */
        .hub-tab-bar {
            display: flex;
            gap: 0;
            margin-bottom: 20px;
            background: var(--card);
            border-radius: 12px;
            padding: 4px;
            border: 1px solid var(--border);
        }

        .hub-tab {
            flex: 1;
            padding: 9px 16px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-family: 'DM Sans', sans-serif;
            font-weight: 500;
            font-size: 13.5px;
            cursor: pointer;
            color: var(--muted);
            transition: all 0.15s ease;
        }

        .hub-tab.active {
            background: var(--espresso);
            color: var(--cream);
            font-weight: 600;
        }

        .hub-tab:hover:not(.active) {
            background: var(--latte-soft);
            color: var(--espresso);
        }

        .hub-panel-content {
            display: none;
        }

        .hub-panel-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* My Chats Hub */
        .chats-hub-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
            gap: 1rem;
        }

        .chats-hub-search {
            flex: 1;
            position: relative;
        }

        .chats-hub-search input {
            width: 100%;
            padding: 10px 16px 10px 40px;
            border: 1.5px solid var(--border);
            border-radius: 10px;
            font-family: 'DM Sans', sans-serif;
            font-size: 14px;
            background: white;
            transition: border-color 0.2s ease;
        }

        .chats-hub-search input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .chats-hub-search::before {
            content: 'üîç';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
            pointer-events: none;
        }

        .chats-section-label {
            font-weight: 700;
            font-size: 12px;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            margin-bottom: 0.75rem;
            margin-top: 1.25rem;
        }

        .chat-inbox-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1rem;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s;
            border: 1px solid transparent;
            margin-bottom: 0.25rem;
        }

        .chat-inbox-item:hover {
            background: var(--bg-light);
            border-color: var(--border);
        }

        .chat-inbox-avatar {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 15px;
            flex-shrink: 0;
        }

        .chat-inbox-info {
            flex: 1;
            min-width: 0;
        }

        .chat-inbox-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-dark);
        }

        .chat-inbox-preview {
            font-size: 13px;
            color: #888;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .scheduled-chat-item {
            display: flex;
            align-items: center;
            gap: 0.875rem;
            padding: 0.875rem 1rem;
            border-radius: 10px;
            background: var(--accent-light);
            border: 1px solid var(--border);
            margin-bottom: 0.5rem;
            transition: all 0.2s ease;
        }

        .scheduled-chat-item:hover {
            border-color: var(--accent);
            box-shadow: 0 2px 8px rgba(139,90,60,0.1);
        }

        .scheduled-chat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--accent);
            color: var(--text-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .btn-schedule-chat {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            font-family: 'DM Sans', sans-serif;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .btn-schedule-chat:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139,90,60,0.25);
        }

        /* Connection card in My Network tab */
        .connection-card {
            display: flex;
            align-items: center;
            gap: 0.875rem;
            padding: 0.875rem 1rem;
            border-radius: 12px;
            background: white;
            border: 1px solid var(--border);
            margin-bottom: 0.5rem;
            transition: all 0.2s ease;
        }

        .connection-card:hover {
            border-color: var(--accent);
            box-shadow: 0 2px 8px rgba(139,90,60,0.08);
        }

        .connection-card-avatar {
            width: 46px;
            height: 46px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            flex-shrink: 0;
        }

        .connection-card-info {
            flex: 1;
            min-width: 0;
        }

        .connection-card-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-dark);
        }

        .connection-card-role {
            font-size: 12px;
            color: #888;
            margin-top: 2px;
        }

        .connection-card-actions {
            display: flex;
            gap: 0.5rem;
            flex-shrink: 0;
        }

        /* Group list card in My Groups tab */
        .group-list-card {
            display: flex;
            align-items: center;
            gap: 0.875rem;
            padding: 0.875rem 1rem;
            border-radius: 12px;
            background: white;
            border: 1px solid var(--border);
            margin-bottom: 0.5rem;
            transition: all 0.2s ease;
        }

        .group-list-card:hover {
            border-color: var(--accent);
            box-shadow: 0 2px 8px rgba(139,90,60,0.08);
        }

        .group-list-icon {
            width: 46px;
            height: 46px;
            border-radius: 12px;
            background: var(--accent-light);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        /* Find More banner */
        .find-more-banner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, var(--accent-light), #fff8f0);
            border: 1.5px dashed var(--accent);
            border-radius: 12px;
            padding: 1.25rem 1.5rem;
            margin-top: 1.25rem;
            cursor: pointer;
            transition: all 0.2s ease;
            gap: 1rem;
        }

        .find-more-banner:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139,90,60,0.1);
        }

        /* Feed sub-tabs */
        .feed-subtab-bar {
            display: inline-flex;
            gap: 0.25rem;
            background: white;
            border-radius: 10px;
            padding: 0.3rem;
            border: 1px solid var(--border);
        }

        .feed-subtab {
            padding: 7px 18px;
            border: none;
            background: transparent;
            border-radius: 7px;
            font-family: 'DM Sans', sans-serif;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            color: #888;
            transition: all 0.2s ease;
        }

        .feed-subtab.active {
            background: var(--primary);
            color: white;
        }

        .feed-subtab:hover:not(.active) {
            background: var(--bg-light);
            color: var(--primary);
        }

        /* Schedule chat modal person picker */
        .schedule-modal-person {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            cursor: pointer;
            border: 1.5px solid transparent;
            transition: all 0.2s;
            background: var(--bg-light);
            margin-bottom: 0.35rem;
        }

        .schedule-modal-person:hover {
            border-color: var(--primary);
            background: white;
        }

        /* Availability slots display */
        .avail-slot-btn {
            padding: 6px 14px;
            border: 1.5px solid var(--border);
            border-radius: 8px;
            background: white;
            font-family: 'DM Sans', sans-serif;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-dark);
        }

        .avail-slot-btn:hover, .avail-slot-btn.selected {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        @media (max-width: 600px) {
            .connection-card-actions {
                flex-direction: column;
            }
            .find-more-banner {
                flex-direction: column;
                text-align: center;
            }
        }

        /* Person Card */
        .person-card {
            text-align: center;
        }

        .person-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 20px;
            margin: 0 auto 1rem;
        }

        .person-card h3 {
            text-align: center;
            margin-bottom: 0.25rem;
        }

        .person-card .role {
            font-size: 12px;
            color: #999;
            margin-bottom: 0.5rem;
        }

        .person-card .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .tag {
            background: var(--bg-light);
            color: var(--primary);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        /* Calendar */
        .calendar {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .calendar-header button {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 20px;
            padding: 4px 8px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            color: var(--primary);
            font-size: 12px;
            padding: 0.5rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background: var(--bg-light);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .calendar-day:hover {
            background: var(--primary);
            color: white;
        }

        .calendar-day.today {
            background: var(--primary);
            color: white;
            font-weight: 600;
        }

        .calendar-day.has-event {
            border: 2px solid var(--accent);
            font-weight: 600;
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        /* Time Slots */
        .time-slots {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
        }

        .time-slot {
            padding: 0.75rem;
            background: var(--bg-light);
            border: 1.5px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .time-slot:hover {
            border-color: var(--primary);
            background: white;
        }

        .time-slot.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Video Call */
        .call-container {
            background: black;
            border-radius: 16px;
            padding: 2rem;
            color: white;
            text-align: center;
            min-height: 600px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .video-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            width: 100%;
            max-width: 600px;
            margin-bottom: 2rem;
        }

        .video-box {
            background: #333;
            border-radius: 12px;
            aspect-ratio: 16 / 9;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .video-box.local {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 150px;
            aspect-ratio: 9 / 16;
        }

        .video-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .avatar-large {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: 700;
        }

        .call-info {
            margin-bottom: 2rem;
        }

        .call-info h2 {
            color: white;
            margin-bottom: 0.5rem;
        }

        .call-duration {
            font-size: 14px;
            color: #aaa;
        }

        .call-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn.mic {
            background: var(--primary);
            color: white;
        }

        .control-btn.mic:hover {
            background: var(--primary-dark);
        }

        .control-btn.video {
            background: var(--primary);
            color: white;
        }

        .control-btn.video:hover {
            background: var(--primary-dark);
        }

        .control-btn.end {
            background: var(--danger);
            color: white;
        }

        .control-btn.end:hover {
            background: #e55555;
        }

        .control-btn.muted {
            background: #555;
            color: #aaa;
        }

        /* Messages */
        .messages-wrapper {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 1.5rem;
            height: 600px;
        }

        .conversation-list {
            background: white;
            border-radius: 12px;
            overflow-y: auto;
            border: 1px solid var(--border);
        }

        .conversation-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .conversation-item:hover {
            background: var(--bg-light);
        }

        .conversation-item.active {
            background: linear-gradient(135deg, rgba(111, 78, 55, 0.1), rgba(212, 165, 116, 0.1));
        }

        .chat-window {
            background: white;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border);
        }

        .chat-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h3 {
            margin: 0;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .message {
            margin-bottom: 1rem;
            display: flex;
            gap: 0.75rem;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* === STEAM ANIMATION === */
        .steam-container {
            position: relative;
            display: inline-block;
        }
        .steam {
            position: absolute;
            top: -8px;
            width: 4px;
            height: 10px;
            background: transparent;
            border-radius: 50%;
            opacity: 0;
        }
        .steam::before, .steam::after {
            content: '';
            position: absolute;
            width: 4px;
            height: 10px;
            background: rgba(212, 165, 116, 0.5);
            border-radius: 50%;
            animation: steamRise 2s ease-out infinite;
        }
        .steam:nth-child(2)::before { animation-delay: 0.4s; left: 4px; }
        .steam:nth-child(3)::before { animation-delay: 0.8s; left: 8px; }

        @keyframes steamRise {
            0% { opacity: 0; transform: translateY(0) scaleX(1); }
            15% { opacity: 0.7; }
            50% { opacity: 0.3; transform: translateY(-12px) scaleX(1.5); }
            100% { opacity: 0; transform: translateY(-24px) scaleX(0.5); }
        }

        /* === ENHANCED CARD HOVER === */
        .card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card:hover {
            box-shadow: 0 12px 32px rgba(62, 39, 35, 0.15);
            transform: translateY(-4px);
        }

        /* === ENHANCED BUTTON HOVER === */
        .btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(111, 78, 55, 0.25);
        }
        .btn:active {
            transform: scale(0.98);
        }

        /* === NAV ITEM HOVER INDICATOR === */
        .nav-item {
            position: relative;
            overflow: hidden;
        }
        .nav-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%) scaleY(0);
            width: 3px;
            height: 60%;
            background: var(--accent);
            border-radius: 0 3px 3px 0;
            transition: transform 0.2s ease;
        }
        .nav-item:hover::before {
            transform: translateY(-50%) scaleY(1);
        }
        .nav-item.active::before {
            transform: translateY(-50%) scaleY(1);
            background: var(--primary-dark);
        }

        /* === COFFEE DIVIDER === */
        .coffee-divider {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 2rem 0;
            color: var(--accent);
            font-size: 14px;
        }
        .coffee-divider::before, .coffee-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(to right, transparent, var(--border), transparent);
        }

        /* === TOAST NOTIFICATIONS === */
        .toast-container {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 10001;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .toast {
            padding: 0.75rem 1.25rem;
            border-radius: 10px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            animation: toastIn 0.4s cubic-bezier(0.4, 0, 0.2, 1), toastOut 0.4s ease 2.6s forwards;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            max-width: 360px;
        }
        .toast.success { background: linear-gradient(135deg, #4CAF50, #2E7D32); }
        .toast.info { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); }
        .toast.warning { background: linear-gradient(135deg, #FF9800, #E65100); }
        .toast.error { background: linear-gradient(135deg, #FF6B6B, #D32F2F); }
        .toast.celebration { background: linear-gradient(135deg, var(--accent), #C68B59); }

        @keyframes toastIn {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes toastOut {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(100px); }
        }

        /* === CONFETTI === */
        .confetti-piece {
            position: fixed;
            width: 8px;
            height: 8px;
            z-index: 10002;
            pointer-events: none;
            animation: confettiFall 1.5s ease forwards;
        }
        @keyframes confettiFall {
            0% { opacity: 1; transform: translateY(0) rotate(0deg) scale(1); }
            100% { opacity: 0; transform: translateY(400px) rotate(720deg) scale(0.3); }
        }

        /* === PULSE ANIMATION === */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* === GROUP CARD ENHANCEMENTS === */
        .group-card {
            background: linear-gradient(135deg, white 0%, #FFF8F0 100%);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .group-card:hover {
            box-shadow: 0 12px 32px rgba(62, 39, 35, 0.15);
            transform: translateY(-4px);
        }
        .group-card .group-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }
        .activity-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
            flex-shrink: 0;
        }
        .activity-dot.active {
            background: #4CAF50;
            box-shadow: 0 0 6px rgba(76, 175, 80, 0.5);
            animation: dotPulse 2s ease infinite;
        }
        .activity-dot.inactive {
            background: #ccc;
        }
        @keyframes dotPulse {
            0%, 100% { box-shadow: 0 0 4px rgba(76, 175, 80, 0.3); }
            50% { box-shadow: 0 0 10px rgba(76, 175, 80, 0.6); }
        }
        .member-avatars {
            display: flex;
            margin: 0.75rem 0;
        }
        .member-avatars .mini-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            font-size: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
            margin-left: -8px;
        }
        .member-avatars .mini-avatar:first-child {
            margin-left: 0;
        }
        .member-avatars .mini-avatar.more {
            background: var(--accent);
            color: var(--text-dark);
            font-size: 9px;
        }
        .group-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 12px;
            color: #999;
            margin: 0.5rem 0;
        }
        .industry-pill {
            display: inline-block;
            padding: 2px 10px;
            border-radius: 12px;
            background: rgba(111, 78, 55, 0.1);
            color: var(--primary);
            font-size: 11px;
            font-weight: 600;
        }

        /* === PROFILE COMPLETION === */
        .completion-card {
            background: linear-gradient(135deg, #FFF8F0 0%, #F5E6D3 100%);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }
        .completion-card:hover {
            box-shadow: 0 8px 24px rgba(62, 39, 35, 0.12);
        }
        .progress-ring-container {
            position: relative;
            width: 80px;
            height: 80px;
            flex-shrink: 0;
        }
        .progress-ring-container svg {
            transform: rotate(-90deg);
        }
        .progress-ring-bg {
            fill: none;
            stroke: var(--latte-soft);
            stroke-width: 6;
        }
        .progress-ring-fill {
            fill: none;
            stroke: var(--caramel);
            stroke-width: 6;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 11px;
            font-weight: 700;
            color: var(--espresso);
        }
        .completion-info h3 {
            margin-bottom: 0.25rem;
        }
        .completion-info p {
            font-size: 13px;
            color: #999;
            margin-bottom: 0.5rem;
        }

        /* === GETTING STARTED CHECKLIST === */
        .getting-started {
            /* The dark card style is applied inline in the HTML */
            border-radius: 18px;
            margin-bottom: 1.5rem;
            position: relative;
        }
        .getting-started-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .getting-started-header h3 {
            margin-bottom: 0;
        }
        .dismiss-btn {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 18px;
            padding: 4px;
        }
        .dismiss-btn:hover {
            color: var(--primary);
        }
        .checklist {
            list-style: none;
        }
        .checklist-item {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            border-radius: 10px;
            padding: 10px 14px;
            transition: background 0.15s;
            background: rgba(255,255,255,0.07);
            border: 1px solid rgba(255,255,255,0.08);
            flex: 1;
            min-width: 150px;
        }
        .checklist-item:hover {
            background: rgba(255,255,255,0.11);
        }
        .checklist-item.done {
            opacity: 0.45;
        }
        .checklist-item .check-icon {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: 1.5px solid rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            flex-shrink: 0;
            color: rgba(255,255,255,0.4);
            transition: all 0.2s;
        }
        .checklist-item.done .check-icon {
            background: var(--caramel);
            border-color: var(--caramel);
            color: white;
        }
        .check-label {
            font-size: 12px;
            font-weight: 500;
            color: rgba(245,240,232,0.8);
            line-height: 1.3;
        }
        .checklist-item.done .check-label {
            text-decoration: line-through;
            color: rgba(245,240,232,0.4);
        }

        /* === NOTIFICATION BELL === */
        .notification-bell {
            position: relative;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text-light);
            font-size: 20px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.2s;
        }
        .notification-bell:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .notification-bell .bell-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--danger);
            color: white;
            font-size: 9px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .notification-bell .bell-badge.hidden {
            display: none;
        }
        @keyframes bellShake {
            0%, 100% { transform: rotate(0); }
            25% { transform: rotate(15deg); }
            50% { transform: rotate(-15deg); }
            75% { transform: rotate(10deg); }
        }
        .notification-bell.has-new {
            animation: bellShake 0.6s ease;
        }

        /* === NOTIFICATION PANEL === */
        .notification-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 380px;
            height: 100vh;
            background: white;
            box-shadow: -4px 0 24px rgba(0,0,0,0.15);
            z-index: 9998;
            transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
        }
        .notification-panel.open {
            right: 0;
        }
        .notification-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.3);
            z-index: 9997;
            display: none;
        }
        .notification-panel-overlay.open {
            display: block;
        }
        .notification-panel-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .notification-panel-header h3 {
            margin-bottom: 0;
        }
        .notification-list {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
        }
        .notification-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 1rem;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .notification-item:hover {
            background: #FFF8F0;
        }
        .notification-item.unread {
            background: rgba(212, 165, 116, 0.08);
        }
        .notification-item.notif-clickable:hover {
            background: #FFF3E0;
        }
        .notification-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }
        .notification-icon.meeting { background: rgba(111, 78, 55, 0.1); }
        .notification-icon.connection { background: rgba(76, 175, 80, 0.1); }
        .notification-icon.message { background: rgba(33, 150, 243, 0.1); }
        .notification-icon.event { background: rgba(255, 152, 0, 0.1); }
        .notification-icon.badge { background: rgba(212, 165, 116, 0.15); }
        .notification-text {
            flex: 1;
        }
        .notification-text p {
            font-size: 13px;
            margin-bottom: 2px;
            line-height: 1.4;
        }
        .notification-text .notif-time {
            font-size: 11px;
            color: #999;
        }
        .notification-empty {
            text-align: center;
            padding: 3rem 1rem;
            color: #999;
        }

        /* === BADGES & GAMIFICATION === */
        .badge-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 0.5rem;
        }
        .badge-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.4rem;
            width: 72px;
            text-align: center;
            position: relative;
        }
        .badge-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            background: linear-gradient(135deg, #FFF8F0, #F5E6D3);
            border: 2px solid var(--accent);
            transition: all 0.3s;
        }
        .badge-item.locked .badge-icon {
            filter: grayscale(1);
            opacity: 0.4;
            border-color: #ddd;
        }
        .badge-item:not(.locked) .badge-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 16px rgba(212, 165, 116, 0.4);
        }
        .badge-name {
            font-size: 10px;
            font-weight: 600;
            color: var(--primary);
            line-height: 1.2;
        }
        .badge-item.locked .badge-name {
            color: #ccc;
        }
        .badge-tooltip {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary-dark);
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 11px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }
        .badge-item:hover .badge-tooltip {
            opacity: 1;
        }
        .streak-counter {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, #FF9800, #E65100);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        .badge-toast-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10003;
            background: rgba(0,0,0,0.4);
            animation: fadeIn 0.3s ease;
        }
        .badge-toast-card {
            background: white;
            border-radius: 20px;
            padding: 2.5rem;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            animation: badgePop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 300px;
        }
        .badge-toast-card .big-badge {
            font-size: 64px;
            margin-bottom: 1rem;
        }
        @keyframes badgePop {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }

        .message.sent {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            background: var(--bg-light);
            color: var(--text-dark);
            font-size: 14px;
            word-wrap: break-word;
        }

        .message.sent .message-content {
            background: var(--primary);
            color: white;
        }

        .chat-input {
            padding: 1rem;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 0.75rem;
        }

        .chat-input input {
            flex: 1;
        }

        /* Search Bar */
        .search-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .search-bar input {
            flex: 1;
        }

        .search-bar select {
            min-width: 180px;
        }

        /* Meeting Card */
        .meeting-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            border-left: 4px solid var(--accent);
            margin-bottom: 1rem;
        }

        .meeting-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .meeting-time {
            font-size: 12px;
            color: var(--primary);
            font-weight: 600;
        }

        .meeting-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .meeting-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .meeting-status.confirmed {
            background: #d4edda;
            color: #155724;
        }

        .meeting-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 1rem;
        }

        /* Profile Detail */
        .profile-detail {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid var(--border);
            max-width: 800px;
            margin: 0 auto;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
            position: relative;
        }

        .profile-header .person-avatar {
            width: 120px;
            height: 120px;
            font-size: 48px;
            position: relative;
            cursor: pointer;
            overflow: hidden;
        }

        .profile-header .person-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-header .edit-profile-btn {
            position: absolute;
            top: 0;
            right: 0;
        }

        .profile-info {
            margin-bottom: 1.5rem;
        }

        .profile-info-row {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            margin-bottom: 0.5rem;
            color: #666;
            font-size: 14px;
        }

        .profile-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .profile-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .profile-actions button {
            flex: 1;
        }

        .profile-posts {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
        }

        .post-card {
            background: var(--bg-light);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border);
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .post-meta {
            font-size: 12px;
            color: #999;
        }

        .post-content {
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .post-actions {
            display: flex;
            gap: 1rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border);
        }

        .post-action-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .post-action-btn:hover {
            background: rgba(111, 78, 55, 0.1);
        }

        .resume-section {
            background: var(--bg-light);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
        }

        .resume-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            border: 1px solid var(--border);
            text-decoration: none;
            color: var(--text-dark);
            transition: all 0.3s ease;
        }

        .resume-link:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .resume-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .file-upload-area {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-light);
        }

        .file-upload-area:hover {
            border-color: var(--primary);
            background: white;
        }

        .file-upload-area.drag-over {
            border-color: var(--accent);
            background: rgba(212, 165, 116, 0.1);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex !important;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .avatar-upload-preview {
            width: 150px;
            height: 150px;
            margin: 0 auto 1rem;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            font-size: 60px;
            font-weight: 700;
        }

        .avatar-upload-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .messages-wrapper {
                grid-template-columns: 250px 1fr;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .cta-cards-grid {
                grid-template-columns: 1fr;
            }

            .hub-tab {
                font-size: 12px;
                padding: 8px 10px;
            }

            .grid.two-col {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                padding: 1.5rem;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .sidebar nav {
                display: none;
            }

            .main-content {
                margin-left: 0;
                padding: 1.5rem;
            }

            .messages-wrapper {
                grid-template-columns: 1fr;
                height: auto;
            }

            .search-bar {
                flex-direction: column;
            }

            .search-bar select {
                min-width: unset;
            }

            .auth-container {
                margin: 1.5rem auto;
                padding: 1.5rem;
                max-width: 100%;
                box-sizing: border-box;
            }

            .auth-container h1 {
                font-size: 24px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--latte); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--caramel); }

        /* Floating schedule chat button */
        .btn-schedule-chat {
            background: var(--caramel) !important;
            color: white !important;
            border: none !important;
            border-radius: 20px !important;
            font-weight: 600 !important;
            box-shadow: 0 4px 16px rgba(192,124,58,0.3) !important;
        }
        .btn-schedule-chat:hover {
            background: var(--caramel-light) !important;
            transform: translateY(-2px) !important;
        }
    </style>
</head>
<body>
    <!-- Top Bar (shown only when logged in via app-mode class on body) -->
    <div class="topbar" id="appTopbar">
        <div class="topbar-logo">
            <svg width="22" height="24" viewBox="0 0 72 80" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M24 18 Q27 12 24 6" stroke="#e8944a" stroke-width="2" stroke-linecap="round" fill="none"/><path d="M36 18 Q39 12 36 6" stroke="#e8944a" stroke-width="2" stroke-linecap="round" fill="none"/><path d="M48 18 Q51 12 48 6" stroke="#e8944a" stroke-width="2" stroke-linecap="round" fill="none"/><path d="M14 22 L20 66 H52 L58 22 Z" fill="#c17d3c"/><path d="M18 22 L23 58 H28 L23.5 22 Z" fill="rgba(255,255,255,0.07)"/><ellipse cx="36" cy="27" rx="20" ry="4" fill="#9a5f28"/><ellipse cx="36" cy="68" rx="24" ry="5" fill="#9a5f28"/><ellipse cx="36" cy="68" rx="20" ry="3.5" fill="#c17d3c"/><path d="M58 30 Q72 30 72 44 Q72 58 58 58" stroke="#c17d3c" stroke-width="4.5" stroke-linecap="round" fill="none"/><path d="M58 30 Q68 30 68 44 Q68 58 58 58" stroke="#9a5f28" stroke-width="2" stroke-linecap="round" fill="none"/></svg>
            <span>First</span><span style="color:var(--caramel)">Sip</span>
        </div>
        <div class="topbar-search">
            <input class="topbar-search-input" placeholder="Search people, groups..." />
        </div>
        <div class="topbar-right">
            <div id="notifBellContainer" style="display:none;">
                <button class="icon-btn" onclick="toggleNotifications()" id="notifBell" title="Notifications">
                    üîî
                    <div class="notif-dot" id="notifDot" style="display:none;"></div>
                </button>
            </div>
            <div class="user-chip" onclick="switchView('myProfileView')" id="topbarUserChip" style="display:none;">
                <div class="user-chip-av" id="topbarUserAv">?</div>
                <div class="user-chip-name" id="topbarUserName">You</div>
            </div>
        </div>
    </div>

    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="appSidebar">
            <div class="sidebar-label" style="margin-top:0;">Main</div>
            <nav id="navMenu"></nav>
            <div class="sidebar-bottom">
                <div class="sidebar-divider"></div>
                <button class="logout-btn" onclick="handleLogout()">
                    <span class="nav-icon">üö™</span> Sign Out
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">

            <!-- Landing Page -->
            <div id="landingView" class="content-view">
                <div class="landing-page">

                    <!-- Nav -->
                    <nav>
                        <div class="lp-nav-logo">First<span>Sip</span></div>
                        <ul class="lp-nav-links">
                            <li><a onclick="document.getElementById('lpHow').scrollIntoView({behavior:'smooth'})">How It Works</a></li>
                            <li><a onclick="document.getElementById('lpFeatures').scrollIntoView({behavior:'smooth'})">Features</a></li>
                            <li><a onclick="document.getElementById('lpFounder').scrollIntoView({behavior:'smooth'})">Our Story</a></li>
                            <li><a onclick="document.getElementById('lpContact').scrollIntoView({behavior:'smooth'})">Contact</a></li>
                        </ul>
                        <div class="lp-nav-actions">
                            <button class="lp-btn-ghost" onclick="showLandingLogin()">Sign In</button>
                            <button class="lp-btn-primary" onclick="showLandingSignup()">Join Rowan&#39;s Cohort &rarr;</button>
                        </div>
                        <button class="lp-hamburger" id="lpHamburger" onclick="toggleLpMenu()" aria-label="Menu">
                            <span></span><span></span><span></span>
                        </button>
                    </nav>

                    <!-- Mobile Menu -->
                    <div class="lp-mobile-menu" id="lpMobileMenu">
                        <a onclick="closeLpMenu(); document.getElementById('lpHow').scrollIntoView({behavior:'smooth'})">How It Works</a>
                        <a onclick="closeLpMenu(); document.getElementById('lpFeatures').scrollIntoView({behavior:'smooth'})">Features</a>
                        <a onclick="closeLpMenu(); document.getElementById('lpFounder').scrollIntoView({behavior:'smooth'})">Our Story</a>
                        <a onclick="closeLpMenu(); document.getElementById('lpContact').scrollIntoView({behavior:'smooth'})">Contact</a>
                        <div class="lp-mobile-buttons">
                            <button class="lp-btn-ghost" onclick="closeLpMenu(); showLandingLogin()">Sign In</button>
                            <button class="lp-btn-primary" onclick="closeLpMenu(); showLandingSignup()">Join Rowan&#39;s Cohort</button>
                        </div>
                    </div>

                    <!-- Hero -->
                    <section class="lp-hero">
                        <div class="lp-hero-bg"></div>
                        <div class="lp-coffee-ring"></div>

                        <div class="lp-float-card lp-card-1">
                            <div class="lp-avatar a">JT</div>
                            <div>
                                <div class="lp-float-name">Jordan Torres</div>
                                <div class="lp-float-meta">Finance Junior &middot; Rowan</div>
                            </div>
                            <div class="lp-match-badge">92% match</div>
                        </div>
                        <div class="lp-float-card lp-card-2">
                            <div class="lp-avatar b">AP</div>
                            <div>
                                <div class="lp-float-name">Anika Patel</div>
                                <div class="lp-float-meta">CS Senior &middot; Rowan</div>
                            </div>
                            <div class="lp-match-badge">Same goals</div>
                        </div>
                        <div class="lp-float-card lp-card-3">
                            <div class="lp-avatar c">MR</div>
                            <div>
                                <div class="lp-float-name">Mike Reyes</div>
                                <div class="lp-float-meta">Engineering &middot; Rowan</div>
                            </div>
                            <div class="lp-match-badge">Wants to chat</div>
                        </div>

                        <div class="lp-hero-content">
                            <div class="lp-hero-tag">Now at Rowan University</div>
                            <h1>Networking that<br/>feels <em>human</em><br/>for once.</h1>
                            <p class="lp-hero-sub">Meet fellow Profs and Rowan alumni who actually want to help. Skip the LinkedIn grind &mdash; book a real 30-minute conversation instead.</p>
                            <div class="lp-hero-cta">
                                <button class="lp-btn-cta" onclick="showLandingSignup()">&#9749; Join the Founding Cohort</button>
                                <button class="lp-btn-outline" onclick="document.getElementById('lpHow').scrollIntoView({behavior:'smooth'})">See How It Works &darr;</button>
                            </div>
                            <div class="lp-social-proof">
                                <div class="lp-avatars-row">
                                    <div class="lp-mini-av m1">S</div>
                                    <div class="lp-mini-av m2">J</div>
                                    <div class="lp-mini-av m3">A</div>
                                    <div class="lp-mini-av m4">M</div>
                                </div>
                                <div class="lp-proof-text">
                                    <strong>Rowan students</strong> are already connecting.<br>
                                    Be part of the founding cohort &mdash; it&apos;s free.
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Stats Bar -->
                    <div class="lp-stats-bar">
                        <div class="lp-stat-item">
                            <div class="lp-stat-num">30 min</div>
                            <div class="lp-stat-label">Average chat length</div>
                        </div>
                        <div class="lp-stat-item">
                            <div class="lp-stat-num">100%</div>
                            <div class="lp-stat-label">Rowan-only community</div>
                        </div>
                        <div class="lp-stat-item">
                            <div class="lp-stat-num">Free</div>
                            <div class="lp-stat-label">Always, for students</div>
                        </div>
                        <div class="lp-stat-item">
                            <div class="lp-stat-num">Real</div>
                            <div class="lp-stat-label">Conversations, not cold messages</div>
                        </div>
                    </div>

                    <!-- How It Works -->
                    <section class="lp-section lp-how" id="lpHow">
                        <div class="lp-how-inner">
                            <div class="lp-how-header reveal">
                                <div class="lp-section-tag">How It Works</div>
                                <h2>Three steps to a<br/><em>real</em> connection.</h2>
                                <p class="lp-section-sub">No algorithm feeding you strangers. No cold messages disappearing into the void. Just a simple path to a genuine conversation.</p>
                            </div>
                            <div class="lp-steps">
                                <div class="lp-step reveal">
                                    <div class="lp-step-num">01</div>
                                    <div class="lp-step-icon">&#128100;</div>
                                    <h3>Build Your Profile</h3>
                                    <p>Tell us what you&apos;re studying, where you&apos;re headed, and what you&apos;re curious about. The more real you are, the better your matches.</p>
                                </div>
                                <div class="lp-step reveal">
                                    <div class="lp-step-num">02</div>
                                    <div class="lp-step-icon">&#128269;</div>
                                    <h3>Discover &amp; Connect</h3>
                                    <p>Browse students and Rowan alumni who recently broke into your target field. Send a connection request when someone catches your eye.</p>
                                </div>
                                <div class="lp-step reveal">
                                    <div class="lp-step-num">03</div>
                                    <div class="lp-step-icon">&#9749;</div>
                                    <h3>Schedule a First Sip</h3>
                                    <p>Book a 15&ndash;30 minute chat, virtual or in-person. We give you conversation starters so it never feels awkward.</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Features -->
                    <section class="lp-section" id="lpFeatures" style="background: var(--warm-white);">
                        <div class="lp-features-inner">
                            <div class="lp-feature-list reveal">
                                <div class="lp-section-tag">What Makes Us Different</div>
                                <h2>Built for students,<br/>not recruiters.</h2>
                                <div class="lp-feature-item active" data-feature="matching">
                                    <div class="lp-feature-icon">&#127919;</div>
                                    <div>
                                        <h3>Smart Matching</h3>
                                        <p>Matched by major, career goals, and genuine interests &mdash; not just who you already know.</p>
                                    </div>
                                </div>
                                <div class="lp-feature-item" data-feature="icebreakers">
                                    <div class="lp-feature-icon">&#128172;</div>
                                    <div>
                                        <h3>Built-In Icebreakers</h3>
                                        <p>Every chat comes with conversation starters based on your shared interests. No awkward silences.</p>
                                    </div>
                                </div>
                                <div class="lp-feature-item" data-feature="groups">
                                    <div class="lp-feature-icon">&#128101;</div>
                                    <div>
                                        <h3>Community Groups</h3>
                                        <p>Join groups for your major or career interest. Share advice, ask questions, find your people.</p>
                                    </div>
                                </div>
                                <div class="lp-feature-item" data-feature="schedule">
                                    <div class="lp-feature-icon">&#9201;&#65039;</div>
                                    <div>
                                        <h3>Fits Your Schedule</h3>
                                        <p>15&ndash;30 minute chats that fit between classes. Virtual or at the campus caf&eacute;.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Mockup shell ‚Äî panels swap inside -->
                            <div class="lp-app-mockup reveal">
                                <div class="lp-mockup-bar">
                                    <div class="lp-mockup-dot r"></div>
                                    <div class="lp-mockup-dot y"></div>
                                    <div class="lp-mockup-dot g"></div>
                                </div>

                                <!-- PANEL 1: Smart Matching -->
                                <div class="lp-mockup-panel active" id="lp-panel-matching">
                                    <div class="lp-mockup-tabs">
                                        <div class="lp-mockup-tab active">My Network</div>
                                        <div class="lp-mockup-tab">Discover</div>
                                        <div class="lp-mockup-tab">Requests</div>
                                    </div>
                                    <div class="lp-mockup-card">
                                        <div class="lp-mc-av a1">JT</div>
                                        <div class="lp-mc-info">
                                            <div class="lp-mc-name">Jordan Torres</div>
                                            <div class="lp-mc-meta">Finance Junior</div>
                                            <div class="lp-match-bar-wrap">
                                                <div class="lp-match-bar" style="width:92%"></div>
                                                <span class="lp-match-pct">92%</span>
                                            </div>
                                        </div>
                                        <div class="lp-mc-btn">&#9749; Chat</div>
                                    </div>
                                    <div class="lp-mockup-card">
                                        <div class="lp-mc-av a2">AP</div>
                                        <div class="lp-mc-info">
                                            <div class="lp-mc-name">Anika Patel</div>
                                            <div class="lp-mc-meta">CS Senior</div>
                                            <div class="lp-match-bar-wrap">
                                                <div class="lp-match-bar" style="width:88%"></div>
                                                <span class="lp-match-pct">88%</span>
                                            </div>
                                        </div>
                                        <div class="lp-mc-btn">&#9749; Chat</div>
                                    </div>
                                    <div class="lp-mockup-card">
                                        <div class="lp-mc-av a3">MR</div>
                                        <div class="lp-mc-info">
                                            <div class="lp-mc-name">Mike Reyes</div>
                                            <div class="lp-mc-meta">Engineering Soph.</div>
                                            <div class="lp-match-bar-wrap">
                                                <div class="lp-match-bar" style="width:76%"></div>
                                                <span class="lp-match-pct">76%</span>
                                            </div>
                                        </div>
                                        <div class="lp-mc-btn">&#9749; Chat</div>
                                    </div>
                                </div>

                                <!-- PANEL 2: Icebreakers -->
                                <div class="lp-mockup-panel" id="lp-panel-icebreakers">
                                    <div class="lp-ice-header">
                                        <div class="lp-mc-av a1" style="width:32px;height:32px;font-size:12px;">JT</div>
                                        <div>
                                            <div style="font-size:12px;font-weight:600;color:rgba(245,240,232,0.9);">Chat with Jordan T.</div>
                                            <div style="font-size:10px;color:rgba(245,240,232,0.4);">Conversation starters ready</div>
                                        </div>
                                    </div>
                                    <div class="lp-ice-label">&#127775; Try one of these</div>
                                    <div class="lp-ice-card">&#128188; &ldquo;What was your very first internship like ‚Äî and what surprised you most?&rdquo;</div>
                                    <div class="lp-ice-card">&#127919; &ldquo;What&apos;s your biggest career goal before you graduate?&rdquo;</div>
                                    <div class="lp-ice-card">&#127979; &ldquo;Which Rowan class actually changed how you think?&rdquo;</div>
                                    <div class="lp-ice-card">&#9749; &ldquo;Virtual or grab coffee on campus ‚Äî your pick!&rdquo;</div>
                                </div>

                                <!-- PANEL 3: Community Groups -->
                                <div class="lp-mockup-panel" id="lp-panel-groups">
                                    <div class="lp-mockup-tabs">
                                        <div class="lp-mockup-tab active">My Groups</div>
                                        <div class="lp-mockup-tab">Explore</div>
                                    </div>
                                    <div class="lp-group-card">
                                        <div class="lp-group-icon" style="background:linear-gradient(135deg,#C07C3A,#D4964F);">&#128200;</div>
                                        <div class="lp-mc-info">
                                            <div class="lp-mc-name">Rowan Finance Society</div>
                                            <div class="lp-mc-meta">48 members &middot; Active now</div>
                                        </div>
                                        <div class="lp-group-badge">Joined</div>
                                    </div>
                                    <div class="lp-group-card">
                                        <div class="lp-group-icon" style="background:linear-gradient(135deg,#8A9E85,#6B8566);">&#128187;</div>
                                        <div class="lp-mc-info">
                                            <div class="lp-mc-name">CS Entrepreneurs</div>
                                            <div class="lp-mc-meta">112 members &middot; 3 new posts</div>
                                        </div>
                                        <div class="lp-group-badge">Joined</div>
                                    </div>
                                    <div class="lp-group-card">
                                        <div class="lp-group-icon" style="background:linear-gradient(135deg,#3D2B1A,#6B4A2E);">&#9878;&#65039;</div>
                                        <div class="lp-mc-info">
                                            <div class="lp-mc-name">Pre-Law Network</div>
                                            <div class="lp-mc-meta">67 members &middot; Join to see posts</div>
                                        </div>
                                        <div class="lp-mc-btn" style="font-size:10px;padding:5px 10px;">+ Join</div>
                                    </div>
                                </div>

                                <!-- PANEL 4: Schedule -->
                                <div class="lp-mockup-panel" id="lp-panel-schedule">
                                    <div class="lp-sched-header">
                                        <div class="lp-mc-av a1" style="width:32px;height:32px;font-size:12px;">JT</div>
                                        <div>
                                            <div style="font-size:12px;font-weight:600;color:rgba(245,240,232,0.9);">Chat with Jordan T.</div>
                                            <div style="font-size:10px;color:rgba(245,240,232,0.4);">30 min &middot; Virtual</div>
                                        </div>
                                        <div class="lp-sched-pill">30 min</div>
                                    </div>
                                    <div class="lp-ice-label">&#128197; Pick a time that works</div>
                                    <div class="lp-sched-slot lp-sched-slot--active">
                                        <div class="lp-sched-dot"></div>
                                        <div>
                                            <div style="font-size:12px;font-weight:600;color:rgba(245,240,232,0.9);">Tomorrow &mdash; 2:00 PM</div>
                                            <div style="font-size:10px;color:rgba(245,240,232,0.45);">30 min &middot; Virtual</div>
                                        </div>
                                        <div class="lp-mc-btn" style="font-size:10px;padding:5px 10px;">Select</div>
                                    </div>
                                    <div class="lp-sched-slot">
                                        <div class="lp-sched-dot"></div>
                                        <div>
                                            <div style="font-size:12px;font-weight:600;color:rgba(245,240,232,0.9);">Friday &mdash; 11:30 AM</div>
                                            <div style="font-size:10px;color:rgba(245,240,232,0.45);">30 min &middot; Campus Caf&eacute;</div>
                                        </div>
                                        <div class="lp-mc-btn" style="font-size:10px;padding:5px 10px;">Select</div>
                                    </div>
                                    <div class="lp-sched-slot">
                                        <div class="lp-sched-dot"></div>
                                        <div>
                                            <div style="font-size:12px;font-weight:600;color:rgba(245,240,232,0.9);">Monday &mdash; 4:00 PM</div>
                                            <div style="font-size:10px;color:rgba(245,240,232,0.45);">30 min &middot; Virtual</div>
                                        </div>
                                        <div class="lp-mc-btn" style="font-size:10px;padding:5px 10px;">Select</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Founder -->
                    <section class="lp-section lp-founder" id="lpFounder">
                        <div class="lp-founder-inner reveal">
                            <div class="lp-founder-portrait">
                                <img src="images/sal.jpg" alt="Sal Altadonna" onerror="this.style.display='none'" />
                                S
                            </div>
                            <div>
                                <div class="lp-section-tag">Our Story</div>
                                <p class="lp-founder-quote">&ldquo;I wanted a way to build genuine relationships with people who share my curiosity &mdash; not just my industry.&rdquo;</p>
                                <div class="lp-founder-attr">Sal Altadonna, Founder &middot; Rowan University Junior</div>
                                <p style="margin-top:20px; font-size:15px; color:var(--muted); line-height:1.7; font-weight:300;">First Sip was born out of frustration with stiff career fairs, cold LinkedIn messages, and events where everyone just exchanges business cards they&apos;ll never look at again. It&apos;s a more human, more efficient way to network.</p>
                            </div>
                        </div>
                    </section>

                    <!-- CTA -->
                    <section class="lp-cta-section" id="lpContact">
                        <div class="lp-section-tag" style="color:var(--caramel-light);">Join Now</div>
                        <h2>Ready to build your<br/><em>real</em> network?</h2>
                        <p class="lp-section-sub" style="margin: 0 auto 40px;">Be part of Rowan&apos;s founding cohort. No fluff, no cold messages. Just real conversations with people who actually want to connect.</p>
                        <button class="lp-btn-cta" onclick="showLandingSignup()">&#9749; Join Rowan&apos;s Founding Cohort &mdash; It&apos;s Free</button>
                        <p style="margin-top:24px; font-size:13px; color:rgba(245,240,232,0.35);">Questions? <a href="mailto:Sal.FirstSip@Outlook.com" style="color:var(--caramel-light);text-decoration:none;">Sal.FirstSip@Outlook.com</a></p>
                    </section>

                    <!-- Footer -->
                    <footer class="lp-footer">
                        <div class="lp-footer-logo">First<span>Sip</span></div>
                        <div class="lp-footer-text">&copy; 2026 First Sip. Starting at Rowan University.</div>
                        <ul class="lp-footer-links">
                            <li><a onclick="document.getElementById('lpFounder').scrollIntoView({behavior:'smooth'})">About</a></li>
                            <li><a onclick="document.getElementById('lpHow').scrollIntoView({behavior:'smooth'})">How It Works</a></li>
                            <li><a href="mailto:Sal.FirstSip@Outlook.com">Contact</a></li>
                        </ul>
                    </footer>

                </div>
            </div>

            <!-- Auth Screens -->
            <div id="loginView" class="content-view">
                <div class="auth-container">
                    <h1>Welcome Back</h1>
                    <p class="auth-subtitle">Connect and grow with Rowan students who share your goals</p>
                    
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="loginEmail" placeholder="you@example.com">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    
                    <button class="btn btn-primary" onclick="handleLogin()" style="width: 100%;">Sign In</button>
                    
                    <div class="toggle-auth">
                        New to First Sip? <button onclick="switchView('signupView')">Create Account</button>
                    </div>
                </div>
            </div>

            <div id="signupView" class="content-view">
                <div class="auth-container">
                    <h1>Join First Sip</h1>
                    <p class="auth-subtitle">Join Rowan's founding cohort &mdash; start building real connections</p>

                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" id="signupFirstName" placeholder="Jane">
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" id="signupLastName" placeholder="Smith">
                    </div>
                    <div class="form-group">
                        <label>Current Status</label>
                        <select id="signupStatus">
                            <option value="">Select your year</option>
                            <option value="Freshman">Freshman</option>
                            <option value="Sophomore">Sophomore</option>
                            <option value="Junior">Junior</option>
                            <option value="Senior">Senior</option>
                            <option value="Recent Grad">Recent Grad</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Graduation Year</label>
                        <select id="signupGradYear">
                            <option value="">Select year</option>
                            <option value="2030">2030</option>
                            <option value="2029">2029</option>
                            <option value="2028">2028</option>
                            <option value="2027">2027</option>
                            <option value="2026">2026</option>
                            <option value="2025">2025</option>
                            <option value="2024">2024 (Recent Grad)</option>
                            <option value="2023">2023 (Recent Grad)</option>
                            <option value="2022">2022 (Recent Grad)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>What are you studying / interested in?</label>
                        <select id="signupIndustry">
                            <option value="">Select your major or interest</option>
                            <option value="Business/Finance">Business / Finance</option>
                            <option value="Computer Science/Tech">Computer Science / Tech</option>
                            <option value="Engineering">Engineering</option>
                            <option value="Pre-Med/Healthcare">Pre-Med / Healthcare</option>
                            <option value="Liberal Arts/Humanities">Liberal Arts / Humanities</option>
                            <option value="Undecided/Exploring">Undecided / Exploring</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Interests &amp; Passions</label>
                        <textarea id="signupInterests" placeholder="e.g., investment banking, product management, startups, pre-law..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Career Goals</label>
                        <textarea id="signupGoals" placeholder="e.g., break into consulting, land a tech internship, get into med school..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="signupEmail" placeholder="you@university.edu">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="signupPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>

                    <button class="btn btn-primary" onclick="handleSignup()" style="width: 100%;">Join Rowan's Founding Cohort</button>

                    <div class="toggle-auth">
                        Already have an account? <button onclick="switchView('loginView')">Sign In</button>
                    </div>
                </div>
            </div>

            <!-- Dashboard -->
            <div id="dashboardView" class="content-view">

                <!-- Greeting -->
                <div style="margin-bottom: 24px;">
                    <h2 style="font-family:'Playfair Display',serif; font-size:26px; font-weight:700; color:var(--espresso); margin-bottom:4px;">Good morning, <span id="userName"></span> ‚òï</h2>
                    <p style="font-size:14px; color:var(--muted); font-weight:300;">Here's what's happening in your network today.</p>
                </div>

                <!-- Streak badge (subtle, top right) -->
                <div id="streakBadge" style="display:none; text-align: right; margin-bottom: 0.75rem;">
                    <span class="streak-counter" id="streakDisplay">0</span>
                </div>

                <!-- Getting Started card (dark) ‚Äî hidden after dismissed -->
                <div class="getting-started" id="gettingStarted" style="background:var(--espresso); border-radius:18px; padding:28px 32px; margin-bottom:24px; position:relative; overflow:hidden; display:none;">
                    <div style="position:absolute; right:28px; top:50%; transform:translateY(-50%); font-size:72px; opacity:0.07; pointer-events:none;">‚òï</div>
                    <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:6px;">
                        <div style="font-family:'Playfair Display',serif; font-size:18px; font-weight:700; color:var(--cream);">Your First Sip journey starts here</div>
                        <button class="dismiss-btn" onclick="dismissGettingStarted()" title="Dismiss" style="background:none;border:none;color:rgba(245,240,232,0.4);font-size:20px;cursor:pointer;line-height:1;padding:0;flex-shrink:0;">&times;</button>
                    </div>
                    <div style="font-size:13px; color:rgba(245,240,232,0.55); margin-bottom:20px; font-weight:300;">Complete these steps to get the most out of First Sip</div>
                    <ul class="checklist" id="checklistItems" style="list-style:none; display:flex; gap:12px; flex-wrap:wrap; margin:0; padding:0;"></ul>
                </div>

                <!-- Welcome Empty State (shown on very first login) -->
                <div id="welcomeEmptyState" style="display: none; background: var(--card); border-radius: 16px; padding: 2.5rem; border: 1px solid var(--border); margin-bottom: 2rem; text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 1rem;">&#9749;</div>
                    <h2 style="font-size: 22px; margin-bottom: 0.5rem; color: var(--espresso);">Welcome to First Sip!</h2>
                    <p style="color: var(--muted); margin-bottom: 2rem; max-width: 460px; margin-left: auto; margin-right: auto;">You're part of Rowan's founding cohort. Let's get you set up so you can start making real connections.</p>
                    <div style="max-width: 360px; margin: 0 auto; text-align: left;">
                        <div id="onboardStep1" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; border-radius: 10px; margin-bottom: 0.5rem; background: var(--latte-soft); cursor: pointer;" onclick="editMyProfile()">
                            <span style="width: 28px; height: 28px; border-radius: 50%; background: var(--caramel); color: white; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700; flex-shrink: 0;">1</span>
                            <div><strong style="font-size: 14px; color:var(--espresso);">Complete your profile</strong><br><span style="font-size: 12px; color: var(--muted);">Takes about 5 minutes</span></div>
                        </div>
                        <div id="onboardStep2" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; border-radius: 10px; margin-bottom: 0.5rem; background: var(--latte-soft); cursor: pointer;" onclick="switchView('discoverView')">
                            <span style="width: 28px; height: 28px; border-radius: 50%; background: var(--latte); color: var(--caramel); display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700; flex-shrink: 0;">2</span>
                            <div><strong style="font-size: 14px; color:var(--espresso);">Discover your first connection</strong><br><span style="font-size: 12px; color: var(--muted);">Browse students who share your interests</span></div>
                        </div>
                        <div id="onboardStep3" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; border-radius: 10px; margin-bottom: 0.5rem; background: var(--latte-soft); cursor: pointer;" onclick="switchView('groupsView')">
                            <span style="width: 28px; height: 28px; border-radius: 50%; background: var(--latte); color: var(--caramel); display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700; flex-shrink: 0;">3</span>
                            <div><strong style="font-size: 14px; color:var(--espresso);">Join a community group</strong><br><span style="font-size: 12px; color: var(--muted);">Find your people by major or interest</span></div>
                        </div>
                        <div id="onboardStep4" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; border-radius: 10px; background: var(--latte-soft); cursor: pointer;" onclick="switchView('scheduleView')">
                            <span style="width: 28px; height: 28px; border-radius: 50%; background: var(--latte); color: var(--caramel); display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700; flex-shrink: 0;">4</span>
                            <div><strong style="font-size: 14px; color:var(--espresso);">Schedule your first coffee chat</strong><br><span style="font-size: 12px; color: var(--muted);">15-30 min, virtual or in-person</span></div>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="editMyProfile()" style="margin-top: 1.5rem;">Complete Your Profile</button>
                </div>

                <!-- Profile Completion Bar -->
                <div class="completion-card" id="completionCard" style="background:var(--card); border:1px solid var(--border); border-radius:12px; padding:14px 18px; margin-bottom:20px; display:flex; align-items:center; gap:16px;">
                    <div class="progress-ring-container" style="position:relative; flex-shrink:0; width:56px; height:56px;">
                        <svg width="56" height="56" viewBox="0 0 80 80">
                            <circle class="progress-ring-bg" cx="40" cy="40" r="34"></circle>
                            <circle class="progress-ring-fill" id="progressRing" cx="40" cy="40" r="34" stroke-dasharray="213.6" stroke-dashoffset="213.6"></circle>
                        </svg>
                        <span class="progress-text" id="progressPercent" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:11px;font-weight:700;color:var(--espresso);">0%</span>
                    </div>
                    <div class="completion-info" style="flex:1;">
                        <div style="font-size:13px; font-weight:600; color:var(--espresso); margin-bottom:2px;">Profile Completion</div>
                        <div id="completionMsg" style="font-size:12px; color:var(--muted); font-weight:300; margin-bottom:8px;">Complete your profile to get better matches</div>
                        <button class="btn btn-accent btn-sm" onclick="editMyProfile()" style="font-size:12px; padding:6px 14px;">Complete Profile</button>
                    </div>
                </div>

                <!-- Stats Row -->
                <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:14px; margin-bottom:24px;" id="dashboardStats">
                    <div style="background:var(--card); border:1px solid var(--border); border-radius:14px; padding:18px 20px;">
                        <div style="font-size:10px; font-weight:700; letter-spacing:0.8px; text-transform:uppercase; color:var(--muted); margin-bottom:6px;">Connections</div>
                        <div id="statConnections" style="font-family:'Playfair Display',serif; font-size:28px; font-weight:700; color:var(--espresso); margin-bottom:4px;">0</div>
                        <div style="font-size:12px; color:var(--muted); font-weight:300; cursor:pointer;" onclick="switchView('discoverView')">Discover people to connect ‚Üí</div>
                    </div>
                    <div style="background:var(--card); border:1px solid var(--border); border-radius:14px; padding:18px 20px;">
                        <div style="font-size:10px; font-weight:700; letter-spacing:0.8px; text-transform:uppercase; color:var(--muted); margin-bottom:6px;">Chats Completed</div>
                        <div id="statChats" style="font-family:'Playfair Display',serif; font-size:28px; font-weight:700; color:var(--espresso); margin-bottom:4px;">0</div>
                        <div style="font-size:12px; color:var(--muted); font-weight:300; cursor:pointer;" onclick="openScheduleModal()">Schedule your first sip ‚Üí</div>
                    </div>
                    <div style="background:var(--card); border:1px solid var(--border); border-radius:14px; padding:18px 20px;">
                        <div style="font-size:10px; font-weight:700; letter-spacing:0.8px; text-transform:uppercase; color:var(--muted); margin-bottom:6px;">Groups Joined</div>
                        <div id="statGroups" style="font-family:'Playfair Display',serif; font-size:28px; font-weight:700; color:var(--espresso); margin-bottom:4px;">0</div>
                        <div style="font-size:12px; color:var(--muted); font-weight:300; cursor:pointer;" onclick="switchView('groupsView')">Browse communities ‚Üí</div>
                    </div>
                </div>

                <!-- Zero-state CTA cards (shown when no activity) -->
                <div id="zeroCTAs" style="display:none;">
                    <div class="cta-cards-grid">
                        <div class="cta-card" onclick="switchView('discoverView')">
                            <div class="cta-icon">ü§ù</div>
                            <h3>Meet your first connection</h3>
                            <p>Browse Rowan students who share your interests and goals</p>
                        </div>
                        <div class="cta-card" onclick="switchView('groupsView')">
                            <div class="cta-icon">üë•</div>
                            <h3>Find your people</h3>
                            <p>Join groups for your major, career path, or campus interests</p>
                        </div>
                        <div class="cta-card" onclick="openScheduleModal()">
                            <div class="cta-icon">‚òï</div>
                            <h3>Schedule your first chat</h3>
                            <p>Find someone to connect with, then kick off a 30-min coffee chat</p>
                        </div>
                    </div>
                </div>

                <!-- Hub Tabs (shown when user has any activity) -->
                <div id="hubPanel" style="display:none;">
                    <div class="hub-tab-bar">
                        <button id="tabNetwork" class="hub-tab active" onclick="switchHubTab('network')">My Network</button>
                        <button id="tabGroups" class="hub-tab" onclick="switchHubTab('groups')">My Groups</button>
                        <button id="tabChats" class="hub-tab" onclick="switchHubTab('chats')">My Chats</button>
                    </div>
                    <div id="hubNetworkPanel" class="hub-panel-content active">
                        <div id="hubNetworkFeed"></div>
                    </div>
                    <div id="hubGroupsPanel" class="hub-panel-content">
                        <div id="hubGroupsFeed"></div>
                    </div>
                    <div id="hubChatsPanel" class="hub-panel-content">
                        <div id="hubChatsContent"></div>
                    </div>
                </div>

                <!-- Badges Section -->
                <div style="background: var(--card); border-radius: 14px; padding: 1.5rem; border: 1px solid var(--border); margin-bottom: 1.5rem;">
                    <h3 style="margin-bottom: 0.75rem; font-size:14px; font-weight:600; color:var(--espresso);">Your Badges</h3>
                    <div class="badge-grid" id="dashboardBadges"></div>
                </div>

            </div>

            <!-- Discover View -->
            <div id="discoverView" class="content-view">
                <h1>Discover People</h1>
                <p style="color: #999; margin-bottom: 1.5rem;">Find Rowan students and alumni who share your interests</p>

                <div style="background: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; border: 1px solid var(--border);">
                    <h3 style="margin-bottom: 1rem; font-size: 16px;">Find People</h3>
                    <div style="position: relative; margin-bottom: 1rem;">
                        <input type="text" id="searchName" placeholder="Search by name..." onkeyup="filterDiscovery()" style="width: 100%; padding: 12px 16px; font-size: 16px; border-radius: 10px; border: 2px solid var(--border); box-sizing: border-box;">
                    </div>
                    <p style="font-size: 13px; color: #999; margin-bottom: 0.75rem;">Filter by:</p>
                    <div class="search-bar" style="margin-bottom: 0;">
                        <select id="filterIndustry" onchange="filterDiscovery()">
                            <option value="">All Majors</option>
                            <option value="Business/Finance">Business / Finance</option>
                            <option value="Computer Science/Tech">Computer Science / Tech</option>
                            <option value="Engineering">Engineering</option>
                            <option value="Pre-Med/Healthcare">Pre-Med / Healthcare</option>
                            <option value="Liberal Arts/Humanities">Liberal Arts / Humanities</option>
                            <option value="Undecided/Exploring">Undecided / Exploring</option>
                        </select>
                        <input type="text" id="searchLocation" placeholder="Grad year..." onkeyup="filterDiscovery()">
                    </div>
                    <div class="search-bar" style="margin-top: 0.75rem; margin-bottom: 0;">
                        <input type="text" id="searchInterests" placeholder="Interests (e.g., AI, Startups)..." onkeyup="filterDiscovery()">
                        <input type="text" id="searchCompany" placeholder="School..." onkeyup="filterDiscovery()">
                    </div>
                    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                        <button class="btn btn-primary btn-sm" onclick="filterDiscovery()">Search</button>
                        <button class="btn btn-secondary btn-sm" onclick="clearFilters()">Clear All Filters</button>
                    </div>
                </div>

                <div id="recommendationsSection"></div>
                <div id="discoverGrid" class="grid"></div>
            </div>

            <!-- Profile Detail View -->
            <div id="profileDetailView" class="content-view">
                <button class="btn btn-secondary btn-sm" onclick="goBack()" style="margin-bottom: 1.5rem;">‚Üê Back</button>
                <div id="profileDetailContent" class="profile-detail"></div>
            </div>

            <!-- My Profile View (LinkedIn-style) -->
            <div id="myProfileView" class="content-view">
                <div id="myProfileContent"></div>
            </div>

            <!-- Modals moved to end of body -->

            <!-- Groups View -->
            <div id="groupsView" class="content-view">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                    <h1 style="margin: 0;">Communities & Groups</h1>
                    <button class="btn btn-primary btn-sm" onclick="openModal('createGroupModal')" style="margin-top: 0.25rem; white-space: nowrap;">+ Create Group</button>
                </div>
                <p style="color: #999; margin-bottom: 2rem;">Join groups aligned with your industry and interests</p>

                <h2 style="margin-top: 2rem;">Featured Groups</h2>
                <div id="groupsList" class="grid"></div>

                <h2 style="margin-top: 2rem;">Your Groups</h2>
                <div id="myGroupsList"></div>
            </div>

            <!-- Group Detail View -->
            <div id="groupDetailView" class="content-view">
                <button class="btn btn-secondary btn-sm" onclick="switchView('groupsView')" style="margin-bottom: 1.5rem;">&larr; Back to Groups</button>
                <div id="groupDetailContent"></div>
            </div>

            <!-- Calendar View -->
            <div id="calendarView" class="content-view">
                <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:2rem; gap:1rem; flex-wrap:wrap;">
                    <div>
                        <h1 style="margin-bottom:0.25rem;">Your Schedule</h1>
                        <p style="color:#999;">View and manage your coffee chats</p>
                    </div>
                    <button class="btn btn-secondary" onclick="switchView('availabilityView')" style="flex-shrink:0;">üïí Set Availability</button>
                </div>

                <div class="grid two-col">
                    <div>
                        <h2 style="margin-bottom: 1rem;">Calendar</h2>
                        <div class="calendar">
                            <div class="calendar-header">
                                <button onclick="previousMonth()">‚Üê</button>
                                <h3 style="margin: 0;" id="currentMonth"></h3>
                                <button onclick="nextMonth()">‚Üí</button>
                            </div>
                            <div class="calendar-grid" id="calendarGrid"></div>
                        </div>
                    </div>

                    <div>
                        <h2 style="margin-bottom: 1rem;">Upcoming Meetings</h2>
                        <div id="meetingsList"></div>
                    </div>
                </div>
            </div>

            <!-- Messages View -->
            <div id="messagesView" class="content-view">
                <h1>Messages</h1>
                <p style="color: #999; margin-bottom: 1.5rem;">Connect with your network</p>
                <div class="messages-wrapper">
                    <div id="conversationList" class="conversation-list"></div>
                    <div id="chatWindow" class="chat-window">
                        <div class="chat-header">
                            <h3>Select a conversation</h3>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Video Call View -->
            <div id="callView" class="content-view">
                <button class="btn btn-secondary btn-sm" onclick="endCall()" style="margin-bottom: 1.5rem;">‚Üê End Call</button>
                <div class="call-container">
                    <div class="video-box local">
                        <div class="video-placeholder">
                            <div class="avatar-large">üë§</div>
                        </div>
                    </div>
                    <div class="video-grid">
                        <div class="video-box">
                            <div class="video-placeholder">
                                <div class="avatar-large" id="remoteName"></div>
                                <p id="remotePerson"></p>
                            </div>
                        </div>
                    </div>
                    <div class="call-info">
                        <h2 id="callPersonName"></h2>
                        <p class="call-duration"><span id="callTimer">00:00</span></p>
                    </div>
                    <div class="call-controls">
                        <button class="control-btn mic" id="micBtn" onclick="toggleMic()">üé§</button>
                        <button class="control-btn video" id="videoBtn" onclick="toggleVideo()">üìπ</button>
                        <button class="control-btn end" onclick="endCall()">‚òéÔ∏è</button>
                    </div>
                </div>
            </div>

            <!-- Schedule Meeting View -->
            <div id="scheduleView" class="content-view">
                <button class="btn btn-secondary btn-sm" onclick="goBack()" style="margin-bottom: 1.5rem;">‚Üê Back</button>
                <div class="profile-detail">
                    <h1 style="text-align: center; margin-bottom: 2rem;">Schedule a Coffee Chat</h1>
                    
                    <div class="form-group">
                        <label>With: <strong id="scheduleName"></strong></label>
                    </div>

                    <div class="form-group">
                        <label>Select Date</label>
                        <input type="date" id="scheduleDate">
                    </div>

                    <div class="form-group">
                        <label>Select Time</label>
                        <div class="time-slots" id="timeSlots"></div>
                    </div>

                    <div class="form-group">
                        <label>Duration</label>
                        <select id="scheduleDuration">
                            <option value="15">15 minutes</option>
                            <option value="30" selected>30 minutes</option>
                            <option value="60">1 hour</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Topic/Purpose</label>
                        <textarea id="scheduleTopic" placeholder="What would you like to discuss?"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Meeting Type</label>
                        <select id="scheduleType" onchange="updateMeetingDetails()">
                            <option value="video">Video Call</option>
                            <option value="zoom">Zoom Meeting</option>
                            <option value="facetime">FaceTime</option>
                            <option value="phone">Phone Call</option>
                            <option value="coffee">First Sip (In-person)</option>
                        </select>
                    </div>

                    <div id="meetingDetailsSection">
                        <div class="form-group" id="meetingLinkGroup">
                            <label id="meetingDetailLabel">Video Call Link</label>
                            <input type="text" id="meetingDetailInput" placeholder="Paste your video call link here">
                            <p style="font-size: 12px; color: #999; margin-top: 0.25rem;" id="meetingDetailHint">e.g., Google Meet, Teams, or other video call link</p>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="sendMeetingRequest()" style="width: 100%;">Send Meeting Request</button>
                </div>
            </div>

            <!-- Feed View -->
            <div id="feedView" class="content-view">
                <h1>Feed</h1>
                <p style="color: #999; margin-bottom: 1.25rem;">See what's happening in your world</p>

                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem; flex-wrap:wrap; gap:0.75rem;">
                    <div class="feed-subtab-bar">
                        <button id="feedTabConnections" class="feed-subtab active" onclick="switchFeedTab('connections')">Connections</button>
                        <button id="feedTabGroups" class="feed-subtab" onclick="switchFeedTab('groups')">Groups</button>
                    </div>
                    <button class="btn btn-primary btn-sm" onclick="createPost()">‚úçÔ∏è Create Post</button>
                </div>

                <div id="feedPosts"></div>
            </div>

            <!-- Availability View -->
            <div id="availabilityView" class="content-view">
                <h1>Set Your Availability</h1>
                <p style="color: #999; margin-bottom: 2rem;">Let people know when you're available for coffee chats</p>

                <div class="card" style="max-width: 800px; margin: 0 auto;">
                    <h3 style="margin-bottom: 1.5rem;">Weekly Availability</h3>

                    <div id="availabilitySlots">
                        <!-- Availability slots will be rendered here -->
                    </div>

                    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border);">
                        <h3 style="margin-bottom: 1rem;">Add Time Slot</h3>
                        <div class="form-group">
                            <label>Day of Week</label>
                            <select id="availabilityDay">
                                <option value="0">Sunday</option>
                                <option value="1">Monday</option>
                                <option value="2">Tuesday</option>
                                <option value="3">Wednesday</option>
                                <option value="4">Thursday</option>
                                <option value="5">Friday</option>
                                <option value="6">Saturday</option>
                            </select>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label>Start Time</label>
                                <input type="time" id="availabilityStartTime" value="09:00">
                            </div>
                            <div class="form-group">
                                <label>End Time</label>
                                <input type="time" id="availabilityEndTime" value="17:00">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="addAvailabilitySlot()">Add Availability</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Schedule Chat Modal -->
    <div id="scheduleChatModal" class="modal">
        <div class="modal-content" style="max-width:560px;">
            <div class="modal-header">
                <h2 style="margin:0;">‚òï Schedule a Coffee Chat</h2>
                <button class="modal-close" onclick="closeModal('scheduleChatModal')">√ó</button>
            </div>

            <!-- Step 1: Pick a person -->
            <div id="scheduleStep1">
                <p style="color:#888;margin-bottom:1rem;font-size:14px;">Who do you want to have a coffee chat with?</p>
                <div id="schedulePersonList" style="max-height:320px;overflow-y:auto;"></div>
            </div>

            <!-- Step 2: Pick date / time / details -->
            <div id="scheduleStep2" style="display:none;">
                <div style="display:flex;align-items:center;gap:0.75rem;margin-bottom:1.25rem;padding:0.875rem;background:var(--bg-light);border-radius:10px;">
                    <div class="chat-inbox-avatar" id="schedulePickedAvatar" style="font-size:16px;"></div>
                    <div style="flex:1;">
                        <div style="font-weight:600;font-size:14px;" id="schedulePickedName"></div>
                        <button style="background:none;border:none;color:var(--primary);font-size:12px;cursor:pointer;padding:0;margin-top:2px;" onclick="resetScheduleStep()">‚Üê Change person</button>
                    </div>
                </div>

                <!-- Availability display -->
                <div id="schedulePickedAvailability" style="margin-bottom:1.25rem;"></div>

                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="modalScheduleDate" onchange="renderModalTimeSlots()">
                </div>
                <div class="form-group">
                    <label>Time</label>
                    <div class="time-slots" id="modalTimeSlots"></div>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
                    <div class="form-group">
                        <label>Duration</label>
                        <select id="modalScheduleDuration">
                            <option value="15">15 minutes</option>
                            <option value="30" selected>30 minutes</option>
                            <option value="60">1 hour</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Meeting Type</label>
                        <select id="modalScheduleType">
                            <option value="video">Video Call</option>
                            <option value="zoom">Zoom</option>
                            <option value="phone">Phone Call</option>
                            <option value="coffee">In-Person ‚òï</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>What would you like to talk about?</label>
                    <textarea id="modalScheduleTopic" placeholder="Share a topic, ask for advice, or just say you'd love to connect!" style="min-height:80px;"></textarea>
                </div>
                <button class="btn btn-primary" onclick="sendModalMeetingRequest()" style="width:100%;padding:13px;">Send Chat Request ‚òï</button>
            </div>
        </div>
    </div>

    <!-- Modals (outside main-content to avoid overflow clipping) -->
    <div id="editProfileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="margin: 0;">Edit Profile</h2>
                <button class="modal-close" onclick="closeModal('editProfileModal')">√ó</button>
            </div>

            <div class="avatar-upload-preview" id="avatarPreview">
                <span id="avatarInitials"></span>
            </div>

            <div class="form-group">
                <label>Profile Picture</label>
                <div class="file-upload-area" onclick="document.getElementById('avatarInput').click()">
                    <p>Click or drag to upload profile picture</p>
                    <p style="font-size: 12px; color: #999;">JPG, PNG (Max 5MB)</p>
                </div>
                <input type="file" id="avatarInput" accept="image/*" style="display: none;" onchange="handleAvatarUpload(event)">
            </div>

            <div class="form-group">
                <label>First Name</label>
                <input type="text" id="editFirstName">
            </div>
            <div class="form-group">
                <label>Last Name</label>
                <input type="text" id="editLastName">
            </div>
            <div class="form-group">
                <label>Current Status</label>
                <input type="text" id="editRole" placeholder="e.g., Junior, Senior, Recent Grad">
            </div>
            <div class="form-group">
                <label>School</label>
                <input type="text" id="editCompany" placeholder="e.g., Rowan University">
            </div>
            <div class="form-group">
                <label>Graduation Year</label>
                <input type="text" id="editLocation" placeholder="e.g., 2027">
            </div>
            <div class="form-group">
                <label>Bio</label>
                <textarea id="editBio" placeholder="Tell others about yourself..." rows="4"></textarea>
            </div>
            <div class="form-group">
                <label>What are you studying / interested in?</label>
                <select id="editIndustry">
                    <option value="Business/Finance">Business / Finance</option>
                    <option value="Computer Science/Tech">Computer Science / Tech</option>
                    <option value="Engineering">Engineering</option>
                    <option value="Pre-Med/Healthcare">Pre-Med / Healthcare</option>
                    <option value="Liberal Arts/Humanities">Liberal Arts / Humanities</option>
                    <option value="Undecided/Exploring">Undecided / Exploring</option>
                </select>
            </div>
            <div class="form-group">
                <label>Interests & Passions (comma-separated)</label>
                <input type="text" id="editInterests" placeholder="AI, Product Management, Startups">
            </div>
            <div class="form-group">
                <label>Hobbies (comma-separated)</label>
                <input type="text" id="editHobbies" placeholder="Working out, Reading, Hiking, Photography">
            </div>
            <div class="form-group">
                <label>Career Goals</label>
                <textarea id="editGoals" placeholder="What are you looking to achieve?" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>Resume</label>
                <div class="file-upload-area" onclick="document.getElementById('resumeInput').click()">
                    <p>Click or drag to upload resume</p>
                    <p style="font-size: 12px; color: #999;">PDF (Max 10MB)</p>
                </div>
                <input type="file" id="resumeInput" accept=".pdf" style="display: none;" onchange="handleResumeUpload(event)">
                <div id="resumePreview"></div>
            </div>

            <div style="display: flex; gap: 1rem;">
                <button class="btn btn-secondary" onclick="closeModal('editProfileModal')" style="flex: 1;">Cancel</button>
                <button class="btn btn-primary" onclick="saveProfile()" style="flex: 1;">Save Changes</button>
            </div>
        </div>
    </div>

    <div id="createPostModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="margin: 0;">Create Post</h2>
                <button class="modal-close" onclick="closeModal('createPostModal')">√ó</button>
            </div>
            <div class="form-group">
                <label>What's on your mind?</label>
                <textarea id="postContent" placeholder="Share your thoughts, insights, or experiences..." rows="6"></textarea>
            </div>
            <div style="display: flex; gap: 1rem;">
                <button class="btn btn-secondary" onclick="closeModal('createPostModal')" style="flex: 1;">Cancel</button>
                <button class="btn btn-primary" onclick="publishPost()" style="flex: 1;">Publish</button>
            </div>
        </div>
    </div>

    <!-- Create Group Modal -->
    <div id="createGroupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="margin: 0;">Create a Group</h2>
                <button class="modal-close" onclick="closeModal('createGroupModal')">√ó</button>
            </div>
            <div class="form-group">
                <label>Group Name <span style="color: var(--accent);">*</span></label>
                <input type="text" id="newGroupName" placeholder="e.g. Product Managers at Big Tech" maxlength="80">
            </div>
            <div class="form-group">
                <label>Industry / Focus Area <span style="color: var(--accent);">*</span></label>
                <select id="newGroupIndustry">
                    <option value="" disabled selected>Select a category‚Ä¶</option>
                    <option>Technology</option>
                    <option>Business/Finance</option>
                    <option>Engineering</option>
                    <option>Product Management</option>
                    <option>Design/Creative</option>
                    <option>Marketing</option>
                    <option>Healthcare</option>
                    <option>Law/Legal</option>
                    <option>Education</option>
                    <option>Research/Academia</option>
                    <option>Entrepreneurship/Startups</option>
                    <option>Data Science/AI</option>
                    <option>Other</option>
                </select>
            </div>
            <div class="form-group">
                <label>Description <span style="color: var(--accent);">*</span></label>
                <textarea id="newGroupDescription" placeholder="What is this group about? Who should join?" rows="4" maxlength="300" oninput="document.getElementById('newGroupDescCount').textContent = this.value.length + ' / 300'"></textarea>
                <div id="newGroupDescCount" style="font-size: 11px; color: #aaa; text-align: right; margin-top: 4px;">0 / 300</div>
            </div>
            <div id="createGroupError" style="display: none; color: #e53935; font-size: 13px; margin-bottom: 0.75rem;"></div>
            <div style="display: flex; gap: 1rem;">
                <button class="btn btn-secondary" onclick="closeModal('createGroupModal')" style="flex: 1;">Cancel</button>
                <button class="btn btn-primary" onclick="createGroup()" style="flex: 1;" id="createGroupBtn">Create Group</button>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://vmrmkkngjlicuvrpejxx.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_UZ6aNCU1qZ5TfGCHXdPz4w_ferczbVL';

        // Initialize Supabase client
        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // State
        let currentUser = null;
        let users = [];
        let groups = [];
        let myGroupIds = new Set();
        let sentMessageCount = 0;
        let messages = [];
        let meetings = [];
        let connections = [];
        let pendingRequests = []; // incoming: connected_user_id === currentUser.id, status === 'pending'
        let sentRequests = [];    // outgoing: user_id === currentUser.id, status === 'pending'
        let posts = [];
        let selectedConversation = null;
        let selectedPerson = null;
        let previousView = 'dashboardView';
        let callDuration = 0;
        let callInterval = null;
        let currentMonth = new Date();
        let selectedTime = null;

        const mockUsers = [
            {
                id: '00000000-0000-0000-0000-000000000002',
                firstName: 'Jordan',
                lastName: 'Torres',
                industry: 'Business/Finance',
                interests: ['Fintech', 'Investing', 'Entrepreneurship'],
                hobbies: ['Working out', 'Basketball', 'Traveling'],
                goals: 'Land an investment banking internship and eventually start a fintech company',
                email: 'torresj@rowan.edu',
                bio: 'Finance major in the Rohrer College of Business and president of the Investing Club. Interned at a boutique advisory firm last summer. Always down to talk markets over coffee.',
                role: 'Junior',
                company: 'Rowan University',
                location: '2027',
                profilePicture: null,
                resume: null,
                posts: [
                    { id: 'mock-post-001', content: 'Just got my summer internship offer! Happy to share tips on the recruiting process with anyone at Rowan who\'s going through it.', date: '2 days ago', likes_count: 24 }
                ]
            },
            {
                id: '00000000-0000-0000-0000-000000000003',
                firstName: 'Anika',
                lastName: 'Patel',
                industry: 'Computer Science/Tech',
                interests: ['AI', 'Product Management', 'Startups'],
                hobbies: ['Reading', 'Hiking', 'Photography'],
                goals: 'Break into product management at a top tech company',
                email: 'patela@rowan.edu',
                bio: 'CS major with a passion for AI and product design. Working on a campus app for Rowan students to find study groups. Looking for mentors in PM and anyone building cool side projects.',
                role: 'Senior',
                company: 'Rowan University',
                location: '2026',
                profilePicture: null,
                resume: null,
                posts: [
                    { id: 'mock-post-002', content: 'Just finished my first ML project for class and it actually works! Anyone else at Rowan diving into AI this semester?', date: '1 week ago', likes_count: 42 }
                ]
            },
            {
                id: '00000000-0000-0000-0000-000000000004',
                firstName: 'Mike',
                lastName: 'Reyes',
                industry: 'Engineering',
                interests: ['Mechanical Engineering', 'Research', 'Robotics'],
                goals: 'Get into a top engineering grad program or land a role at a defense contractor',
                email: 'reyesm@rowan.edu',
                bio: 'Mechanical Engineering sophomore in the Henry M. Rowan College of Engineering. Doing research in the robotics lab and looking for other engineering students to connect with.',
                role: 'Sophomore',
                company: 'Rowan University',
                location: '2028',
                profilePicture: null,
                resume: null,
                posts: []
            },
            {
                id: '00000000-0000-0000-0000-000000000005',
                firstName: 'Taylor',
                lastName: 'Brooks',
                industry: 'Computer Science/Tech',
                interests: ['Backend Engineering', 'Open Source', 'Web Dev'],
                goals: 'Land a software engineering role at a startup or big tech',
                email: 'brookst@rowan.edu',
                bio: 'CS sophomore who loves building things. Contributing to open source projects and working on a campus events app. Looking for hackathon teammates and study buddies at Rowan.',
                role: 'Sophomore',
                company: 'Rowan University',
                location: '2028',
                profilePicture: null,
                resume: null,
                posts: [
                    { id: 'mock-post-003', content: 'Our ProfHacks team just won first place! Here\'s what we built in 36 hours and what I learned about working under pressure.', date: '3 days ago', likes_count: 67 }
                ]
            },
            {
                id: '00000000-0000-0000-0000-000000000006',
                firstName: 'Brianna',
                lastName: 'Mitchell',
                industry: 'Business/Finance',
                interests: ['Marketing', 'Content Creation', 'Brand Strategy'],
                goals: 'Break into marketing at a tech startup after graduation',
                email: 'mitchellb@rowan.edu',
                bio: 'Marketing major in Rohrer College of Business and social media manager for three campus orgs. Ran a freelance content business since freshman year. Always excited to talk branding and side hustles.',
                role: 'Recent Grad',
                company: 'Rowan University',
                location: '2025',
                profilePicture: null,
                resume: null,
                posts: []
            }
        ];

        const mockGroups = [
            {
                id: 1,
                name: 'Rowan University CS & Tech',
                industry: 'Computer Science/Tech',
                description: 'For Rowan University CS students, aspiring engineers, and anyone building cool stuff',
                members: 87,
                lastActivity: new Date(Date.now() - 2 * 60 * 60 * 1000),
                memberList: ['AP', 'TB', 'JT', 'MR', 'BM'],
                posts: [
                    { author: 'Anika Patel', content: 'Anyone working on AI projects this semester? Would love to connect and share notes!', time: new Date(Date.now() - 2 * 60 * 60 * 1000) },
                    { author: 'Taylor Brooks', content: 'Just won ProfHacks! Here are the resources that helped us build in 36 hours.', time: new Date(Date.now() - 8 * 60 * 60 * 1000) }
                ]
            },
            {
                id: 2,
                name: 'Rohrer Business & Finance',
                industry: 'Business/Finance',
                description: 'Rohrer College of Business students ‚Äî recruiting tips, prep, and support',
                members: 64,
                lastActivity: new Date(Date.now() - 18 * 60 * 60 * 1000),
                memberList: ['JT', 'AP', 'BM'],
                posts: [
                    { author: 'Jordan Torres', content: 'Just finished recruiting season \u2014 happy to share what worked for me and what I\'d do differently!', time: new Date(Date.now() - 18 * 60 * 60 * 1000) }
                ]
            },
            {
                id: 3,
                name: 'Rowan University Engineering',
                industry: 'Engineering',
                description: 'Henry M. Rowan College of Engineering students and alumni',
                members: 72,
                lastActivity: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000),
                memberList: ['MR', 'TB'],
                posts: [
                    { author: 'Mike Reyes', content: 'Anyone else doing undergrad research in the robotics lab? Looking for partners for the spring showcase.', time: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000) }
                ]
            },
            {
                id: 4,
                name: 'Rowan University Side Hustles & Startups',
                industry: 'Business/Finance',
                description: 'Rowan University student entrepreneurs, freelancers, and side project builders',
                members: 53,
                lastActivity: new Date(Date.now() - 6 * 60 * 60 * 1000),
                memberList: ['BM', 'JT', 'AP', 'TB'],
                posts: [
                    { author: 'Brianna Mitchell', content: 'Started freelancing as a content creator freshman year \u2014 here\'s how I landed my first 5 clients on campus.', time: new Date(Date.now() - 6 * 60 * 60 * 1000) }
                ]
            }
        ];

        // Map initials to mock user IDs for group member display
        const initialsToUserId = {
            'JT': '00000000-0000-0000-0000-000000000002',
            'AP': '00000000-0000-0000-0000-000000000003',
            'MR': '00000000-0000-0000-0000-000000000004',
            'TB': '00000000-0000-0000-0000-000000000005',
            'BM': '00000000-0000-0000-0000-000000000006'
        };

        // Group post interactions (local storage)
        const groupPostLikes = {};
        const groupPostComments = {};

        // Initialize
        async function init() {

            // Check for existing Supabase session
            const { data: { session } } = await supabaseClient.auth.getSession();

            if (session) {
                // User is logged in, load their profile
                await loadUserProfile(session.user.id);
                recordLogin();
                renderNav();
                switchView('dashboardView');
                await updateDashboard();
                checkBadgesWithCelebration();
            } else {
                // No session, show landing page
                document.querySelector('.app-container').classList.add('sidebar-hidden');
                switchView('landingView');
            }

            renderCalendar();
        }

        function showLandingSignup() {
            switchView('signupView');
        }

        function showLandingLogin() {
            switchView('loginView');
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const hamburger = document.querySelector('.hamburger');
            if (menu) { menu.classList.toggle('active'); hamburger && hamburger.classList.toggle('active'); document.body.style.overflow = menu.classList.contains('active') ? 'hidden' : ''; }
        }
        function closeMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const hamburger = document.querySelector('.hamburger');
            if (menu) { menu.classList.remove('active'); hamburger && hamburger.classList.remove('active'); document.body.style.overflow = ''; }
        }

        // New landing page mobile menu
        function toggleLpMenu() {
            const menu = document.getElementById('lpMobileMenu');
            const btn = document.getElementById('lpHamburger');
            if (!menu) return;
            menu.classList.toggle('active');
            btn && btn.classList.toggle('active');
            document.body.style.overflow = menu.classList.contains('active') ? 'hidden' : '';
        }
        function closeLpMenu() {
            const menu = document.getElementById('lpMobileMenu');
            const btn = document.getElementById('lpHamburger');
            if (!menu) return;
            menu.classList.remove('active');
            btn && btn.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Scroll reveal for landing page
        function initLandingReveal() {
            const reveals = document.querySelectorAll('#landingView .reveal');
            if (!reveals.length) return;
            const obs = new IntersectionObserver((entries) => {
                entries.forEach((entry, i) => {
                    if (entry.isIntersecting) {
                        setTimeout(() => entry.target.classList.add('visible'), i * 80);
                        obs.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });
            reveals.forEach(el => { el.classList.remove('visible'); obs.observe(el); });

            // Feature item toggle + panel swap
            document.querySelectorAll('#landingView .lp-feature-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('#landingView .lp-feature-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    const feature = item.dataset.feature;
                    document.querySelectorAll('#landingView .lp-mockup-panel').forEach(p => p.classList.remove('active'));
                    const panel = document.getElementById('lp-panel-' + feature);
                    if (panel) panel.classList.add('active');
                });
            });
        }

        async function loadUserProfile(userId) {
            try {
                const { data: profile, error } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .eq('id', userId)
                    .single();

                if (error) throw error;

                currentUser = {
                    id: profile.id,
                    firstName: profile.first_name,
                    lastName: profile.last_name,
                    email: profile.email,
                    industry: profile.industry,
                    interests: profile.interests || [],
                    hobbies: profile.hobbies || [],
                    goals: profile.goals,
                    bio: profile.bio,
                    role: profile.role,
                    company: profile.company,
                    location: profile.location,
                    profilePicture: profile.profile_picture || null,
                    resume: profile.resume_url || null
                };

                // Load user's data
                await loadUserData();
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }

        async function loadUserData() {
            if (!currentUser) return;

            // Each section is independent ‚Äî a failure in one never blocks the others

            // Load all connections (accepted + pending)
            try {
                const { data: connectionsData } = await supabaseClient
                    .from('connections')
                    .select('*')
                    .or(`user_id.eq.${currentUser.id},connected_user_id.eq.${currentUser.id}`);
                const allConns = connectionsData || [];
                connections = allConns.filter(c => c.status === 'accepted');
                pendingRequests = allConns.filter(c => c.status === 'pending' && c.connected_user_id === currentUser.id);
                sentRequests = allConns.filter(c => c.status === 'pending' && c.user_id === currentUser.id);
            } catch (e) { console.error('loadUserData connections:', e); }

            // Load posts for feed
            try {
                const { data: postsData } = await supabaseClient
                    .from('posts')
                    .select('*')
                    .is('group_id', null)
                    .order('created_at', { ascending: false });
                posts = postsData || [];
            } catch (e) { console.error('loadUserData posts:', e); }

            // Load meetings
            try {
                const { data: meetingsData } = await supabaseClient
                    .from('meetings')
                    .select('*')
                    .or(`organizer_id.eq.${currentUser.id},participant_id.eq.${currentUser.id}`)
                    .order('start_time', { ascending: true });
                meetings = meetingsData || [];
            } catch (e) { console.error('loadUserData meetings:', e); }

            // Load all other profiles for discovery ‚Äî most critical
            try {
                const { data: profilesData, error: profilesError } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .neq('id', currentUser.id);
                if (profilesError) console.error('Profiles query error:', profilesError);
                users = (profilesData || []).map(p => ({
                    id: p.id,
                    firstName: p.first_name || '',
                    lastName: p.last_name || '',
                    email: p.email || '',
                    industry: p.industry || '',
                    interests: Array.isArray(p.interests) ? p.interests : [],
                    hobbies: Array.isArray(p.hobbies) ? p.hobbies : [],
                    goals: p.goals || '',
                    bio: p.bio || '',
                    role: p.role || '',
                    company: p.company || '',
                    location: p.location || '',
                    profilePicture: p.profile_picture || null,
                    resume: p.resume_url || null,
                    posts: []
                }));
                console.log(`Loaded ${users.length} profiles for discovery`);
            } catch (e) { console.error('loadUserData profiles:', e); }

            // Load groups
            try {
                const { data: groupsData } = await supabaseClient
                    .from('groups')
                    .select('*')
                    .order('member_count', { ascending: false });
                groups = groupsData || [];
            } catch (e) { console.error('loadUserData groups:', e); }

            // Load user's group memberships
            try {
                const { data: membershipsData } = await supabaseClient
                    .from('group_members')
                    .select('group_id')
                    .eq('user_id', currentUser.id);
                myGroupIds = new Set((membershipsData || []).map(m => m.group_id));
            } catch (e) { console.error('loadUserData memberships:', e); }

            // Count sent messages for checklist / badges
            try {
                const { count } = await supabaseClient
                    .from('messages')
                    .select('id', { count: 'exact', head: true })
                    .eq('sender_id', currentUser.id);
                sentMessageCount = count || 0;
            } catch (e) { console.error('loadUserData messages:', e); }

        }

        function saveToStorage() {
            // Deprecated - keeping for backwards compatibility
            // Data is now saved directly to Supabase
        }

        // Auth
        async function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                alert('Please fill in all fields');
                return;
            }

            try {
                // Sign in with Supabase
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email,
                    password
                });

                if (error) throw error;

                // Fetch user profile from database
                const { data: profile, error: profileError } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .eq('id', data.user.id)
                    .maybeSingle();

                if (profileError) throw profileError;

                if (!profile) {
                    alert('No profile found for this account. Please sign up first.');
                    await supabaseClient.auth.signOut();
                    return;
                }

                currentUser = {
                    id: profile.id,
                    firstName: profile.first_name,
                    lastName: profile.last_name,
                    email: profile.email,
                    industry: profile.industry,
                    interests: profile.interests || [],
                    hobbies: profile.hobbies || [],
                    goals: profile.goals,
                    bio: profile.bio,
                    role: profile.role,
                    company: profile.company,
                    location: profile.location,
                    profilePicture: profile.profile_picture || null,
                    resume: profile.resume_url || null
                };

                document.querySelector('.app-container').classList.remove('sidebar-hidden');
                recordLogin();
                renderNav();
                switchView('dashboardView');
                await updateDashboard();
                checkBadgesWithCelebration();
                showToast('Welcome back!', 'success');
            } catch (error) {
                console.error('Login error:', error);
                alert('Login failed: ' + error.message);
            }
        }

        async function handleSignup() {
            const firstName = document.getElementById('signupFirstName').value;
            const lastName = document.getElementById('signupLastName').value;
            const school = 'Rowan University';
            const industry = document.getElementById('signupIndustry').value;
            const status = document.getElementById('signupStatus').value;
            const gradYear = document.getElementById('signupGradYear').value;
            const interests = document.getElementById('signupInterests').value.split(',').map(i => i.trim()).filter(Boolean);
            const goals = document.getElementById('signupGoals').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;

            if (!firstName || !lastName || !industry || !email || !password || !goals) {
                alert('Please fill in all required fields');
                return;
            }

            if (password.length < 6) {
                alert('Password must be at least 6 characters');
                return;
            }

            try {
                // Sign up with Supabase (profile is auto-created by database trigger)
                const { data, error } = await supabaseClient.auth.signUp({
                    email,
                    password,
                    options: {
                        data: {
                            first_name: firstName,
                            last_name: lastName,
                            industry: industry,
                            interests: interests,
                            hobbies: [],
                            goals: goals,
                            company: school,
                            role: status,
                            location: gradYear
                        }
                    }
                });

                if (error) throw error;

                currentUser = {
                    id: data.user.id,
                    firstName,
                    lastName,
                    email,
                    industry,
                    interests,
                    hobbies: [],
                    goals,
                    bio: '',
                    role: status,
                    company: school,
                    location: gradYear,
                    profilePicture: null,
                    resume: null
                };

                document.querySelector('.app-container').classList.remove('sidebar-hidden');
                recordLogin();
                renderNav();
                switchView('dashboardView');
                await updateDashboard();
                showToast('Account created! Check your email to verify.', 'success');
            } catch (error) {
                console.error('Signup error:', error);
                alert('Signup failed: ' + error.message);
            }
        }

        async function handleLogout() {
            try {
                const { error } = await supabaseClient.auth.signOut();
                if (error) throw error;

                currentUser = null;
                connections = [];
                messages = [];
                meetings = [];
                posts = [];
                document.querySelector('.app-container').classList.add('sidebar-hidden');
                switchView('landingView');
                renderNav();
            } catch (error) {
                console.error('Logout error:', error);
                alert('Logout failed: ' + error.message);
            }
        }

        // Navigation
        function renderNav() {
            const navMenu = document.getElementById('navMenu');
            navMenu.innerHTML = '';

            // Topbar + sidebar visibility
            const topbar = document.getElementById('appTopbar');
            const bellContainer = document.getElementById('notifBellContainer');
            const userChip = document.getElementById('topbarUserChip');

            if (currentUser) {
                // Show topbar, sidebar, bell, user chip
                document.body.classList.add('app-mode');
                if (topbar) topbar.classList.add('visible');
                if (bellContainer) bellContainer.style.display = 'flex';
                if (userChip) {
                    userChip.style.display = 'flex';
                    const initials = (currentUser.firstName[0] || '') + (currentUser.lastName ? currentUser.lastName[0] : '');
                    document.getElementById('topbarUserAv').textContent = initials.toUpperCase();
                    document.getElementById('topbarUserName').textContent = currentUser.firstName + ' ' + (currentUser.lastName ? currentUser.lastName[0] + '.' : '');
                }

                // Build nav items with icons and labels
                const mainItems = [
                    { id: 'dashboardView', icon: 'üè†', label: 'Dashboard' },
                    { id: 'discoverView', icon: 'üîç', label: 'Discover' },
                ];
                const communityItems = [
                    { id: 'feedView', icon: 'üì∞', label: 'Feed' },
                    { id: 'groupsView', icon: 'üë•', label: 'Communities' },
                    { id: 'messagesView', icon: '‚òï', label: 'My Chats' },
                    { id: 'calendarView', icon: 'üìÖ', label: 'Calendar' },
                ];

                // Label: Main
                mainItems.forEach(item => {
                    const btn = document.createElement('button');
                    btn.className = 'nav-item';
                    btn.innerHTML = `<span class="nav-icon">${item.icon}</span>${item.label}`;
                    btn.onclick = () => switchView(item.id);
                    navMenu.appendChild(btn);
                });

                // Label: Community
                const communityLabel = document.createElement('div');
                communityLabel.className = 'sidebar-label';
                communityLabel.textContent = 'Community';
                navMenu.appendChild(communityLabel);

                communityItems.forEach(item => {
                    const btn = document.createElement('button');
                    btn.className = 'nav-item';
                    btn.innerHTML = `<span class="nav-icon">${item.icon}</span>${item.label}`;
                    btn.onclick = () => switchView(item.id);
                    navMenu.appendChild(btn);
                });

                // Divider + My Profile
                const divider = document.createElement('div');
                divider.className = 'sidebar-divider';
                navMenu.appendChild(divider);

                const profileBtn = document.createElement('button');
                profileBtn.className = 'nav-item';
                profileBtn.innerHTML = `<span class="nav-icon">üë§</span>My Profile`;
                profileBtn.onclick = () => switchView('myProfileView');
                navMenu.appendChild(profileBtn);
            } else {
                // Hide topbar, sidebar, bell
                document.body.classList.remove('app-mode');
                if (topbar) topbar.classList.remove('visible');
                if (bellContainer) bellContainer.style.display = 'none';
                if (userChip) userChip.style.display = 'none';
            }
        }

        function updateNavActive(viewId) {
            document.querySelectorAll('#navMenu .nav-item').forEach(btn => {
                btn.classList.remove('active');
            });
            // Match by onclick reference
            document.querySelectorAll('#navMenu .nav-item').forEach(btn => {
                if (btn.onclick && btn.onclick.toString().includes(viewId)) {
                    btn.classList.add('active');
                }
            });
        }

        function switchView(viewId) {
            document.querySelectorAll('.content-view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');

            if (viewId === 'discoverView') {
                // Always re-fetch profiles so newly created accounts appear immediately
                renderDiscovery(); // render with current data right away
                if (currentUser) {
                    supabaseClient.from('profiles').select('*').neq('id', currentUser.id)
                        .then(({ data, error }) => {
                            if (error) { console.error('Discover profile refresh:', error); return; }
                            if (data) {
                                users = data.map(p => ({
                                    id: p.id,
                                    firstName: p.first_name || '',
                                    lastName: p.last_name || '',
                                    email: p.email || '',
                                    industry: p.industry || '',
                                    interests: Array.isArray(p.interests) ? p.interests : [],
                                    hobbies: Array.isArray(p.hobbies) ? p.hobbies : [],
                                    goals: p.goals || '',
                                    bio: p.bio || '',
                                    role: p.role || '',
                                    company: p.company || '',
                                    location: p.location || '',
                                    profilePicture: p.profile_picture || null,
                                    resume: p.resume_url || null,
                                    posts: []
                                }));
                                renderDiscovery(); // re-render with fresh data
                            }
                        });
                }
            }
            if (viewId === 'feedView') renderFeed();
            if (viewId === 'groupsView') renderGroups();
            if (viewId === 'messagesView') renderMessages();
            if (viewId === 'dashboardView') updateDashboard();
            if (viewId === 'calendarView') renderCalendarView();
            if (viewId === 'availabilityView') renderAvailability();
            if (viewId === 'myProfileView') renderMyProfile();
            if (viewId === 'landingView') setTimeout(initLandingReveal, 50);

            updateNavActive(viewId);

            if (viewId !== 'scheduleView' && viewId !== 'profileDetailView' && viewId !== 'callView' && viewId !== 'groupDetailView') {
                previousView = viewId;
            }
        }

        function goBack() {
            switchView(previousView);
        }

        // Dashboard
        function updateDashboard() {
            document.getElementById('userName').textContent = currentUser.firstName;

            const connectionCount = connections.length;
            const groupCount = myGroupIds.size;
            const completedMeetings = meetings.filter(m => m.status === 'completed').length;
            const meetingCount = meetings.filter(m => m.status !== 'completed').length;
            const totalActivity = connectionCount + groupCount + meetingCount;

            // Update stat counters
            const statConnections = document.getElementById('statConnections');
            const statChats = document.getElementById('statChats');
            const statGroups = document.getElementById('statGroups');
            if (statConnections) statConnections.textContent = connectionCount;
            if (statChats) statChats.textContent = completedMeetings;
            if (statGroups) statGroups.textContent = groupCount;

            // Show welcome empty state only when no activity
            const welcomeEl = document.getElementById('welcomeEmptyState');
            if (welcomeEl) {
                welcomeEl.style.display = totalActivity === 0 ? 'block' : 'none';
            }

            // Show zero CTAs or hub tabs
            const zeroCTAs = document.getElementById('zeroCTAs');
            const hubPanel = document.getElementById('hubPanel');
            if (totalActivity === 0) {
                if (zeroCTAs) zeroCTAs.style.display = 'block';
                if (hubPanel) hubPanel.style.display = 'none';
            } else {
                if (zeroCTAs) zeroCTAs.style.display = 'none';
                if (hubPanel) hubPanel.style.display = 'block';
                renderActiveHubTab();
            }

            // Streak badge
            const streak = getLoginStreak();
            const streakBadge = document.getElementById('streakBadge');
            const streakDisplay = document.getElementById('streakDisplay');
            if (streakDisplay) streakDisplay.innerHTML = `&#128293; ${streak} day streak`;
            if (streakBadge) streakBadge.style.display = streak > 1 ? 'block' : 'none';

            // Profile completion
            renderProfileCompletion();

            // Getting started checklist
            renderGettingStarted();

            // Badges
            renderDashboardBadges();

            // Notifications
            generateNotifications();
        }

        // ===== HUB TABS =====
        let activeHubTab = 'network';

        function switchHubTab(tab) {
            activeHubTab = tab;
            ['network', 'groups', 'chats'].forEach(t => {
                const btn = document.getElementById(`tab${t.charAt(0).toUpperCase() + t.slice(1)}`);
                const panel = document.getElementById(`hub${t.charAt(0).toUpperCase() + t.slice(1)}Panel`);
                if (btn) btn.classList.toggle('active', t === tab);
                if (panel) panel.classList.toggle('active', t === tab);
            });
            renderActiveHubTab();
        }

        function renderActiveHubTab() {
            if (activeHubTab === 'network') renderHubNetworkFeed();
            if (activeHubTab === 'groups') renderHubGroupsFeed();
            if (activeHubTab === 'chats') renderHubChats();
        }

        function renderHubNetworkFeed() {
            const container = document.getElementById('hubNetworkFeed');
            if (!container) return;

            // Pending incoming requests section
            const pendingHTML = pendingRequests.length > 0 ? `
                <div style="background: #FFF8F0; border: 1px solid var(--accent); border-radius: 12px; padding: 1rem; margin-bottom: 1.25rem;">
                    <p style="font-weight: 700; font-size: 14px; color: var(--primary); margin-bottom: 0.75rem;">
                        ü§ù ${pendingRequests.length} Connection Request${pendingRequests.length > 1 ? 's' : ''}
                    </p>
                    ${pendingRequests.map(req => {
                        const requester = users.find(u => u.id === req.user_id);
                        if (!requester) return '';
                        const fn = requester.firstName || '?';
                        const ln = requester.lastName || '?';
                        return `
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                                <div class="person-avatar" style="width: 40px; height: 40px; font-size: 15px; flex-shrink: 0;" onclick="viewProfile('${requester.id}')" style="cursor:pointer;">${fn[0]}${ln[0]}</div>
                                <div style="flex: 1; min-width: 0;">
                                    <strong style="font-size: 13px;">${fn} ${ln}</strong>
                                    <p style="font-size: 11px; color: #888; margin: 0;">${requester.role || requester.industry || ''}</p>
                                </div>
                                <div style="display: flex; gap: 0.4rem; flex-shrink: 0;">
                                    <button class="btn btn-primary btn-sm" onclick="acceptConnection('${req.id}')" style="font-size: 11px; padding: 4px 10px;">Accept</button>
                                    <button class="btn btn-secondary btn-sm" onclick="rejectConnection('${req.id}')" style="font-size: 11px; padding: 4px 10px;">Decline</button>
                                </div>
                            </div>`;
                    }).join('')}
                </div>` : '';

            const connectedIds = new Set();
            connections.forEach(c => {
                if (c.user_id === currentUser.id) connectedIds.add(c.connected_user_id);
                if (c.connected_user_id === currentUser.id) connectedIds.add(c.user_id);
            });

            const connectedUsers = users.filter(u => connectedIds.has(u.id));
            const count = connectedUsers.length;

            if (count === 0 && pendingRequests.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ü§ù</div>
                        <p>You haven't connected with anyone yet.</p>
                        <button class="btn btn-primary" onclick="switchView('discoverView')" style="margin-top:1rem;">Find Your People</button>
                    </div>`;
                return;
            }

            container.innerHTML = pendingHTML + (count > 0 ? `
                <p style="font-weight:600;font-size:15px;color:var(--text-dark);margin-bottom:1rem;">
                    ${count} connection${count !== 1 ? 's' : ''}
                </p>
                ${connectedUsers.map(u => {
                    const fn = u.firstName || '?';
                    const ln = u.lastName || '?';
                    const initials = `${fn[0]}${ln[0]}`;
                    const roleLine = [u.role, u.industry].filter(Boolean).join(' ¬∑ ');
                    return `
                        <div class="connection-card">
                            <div class="connection-card-avatar" onclick="viewProfile('${u.id}')" style="cursor:pointer;" title="View profile">${initials}</div>
                            <div class="connection-card-info">
                                <div class="connection-card-name" onclick="viewProfile('${u.id}')" style="cursor:pointer;">${fn} ${ln}</div>
                                ${roleLine ? `<div class="connection-card-role">${roleLine}</div>` : ''}
                            </div>
                            <div class="connection-card-actions">
                                <button class="btn btn-secondary btn-sm" onclick="openChatWith('${u.id}')">üí¨ Message</button>
                                <button class="btn btn-accent btn-sm" onclick="openScheduleForUser('${u.id}')">‚òï Schedule Chat</button>
                            </div>
                        </div>`;
                }).join('')}
                <div class="find-more-banner" onclick="switchView('discoverView')">
                    <div>
                        <div style="font-weight:700;font-size:14px;color:var(--primary);">Looking to expand your network?</div>
                        <div style="font-size:13px;color:#888;margin-top:3px;">Discover Rowan students who share your interests ‚ú®</div>
                    </div>
                    <button class="btn btn-primary btn-sm" style="pointer-events:none;">Find Students ‚Üí</button>
                </div>` : '');
        }

        function renderHubGroupsFeed() {
            const container = document.getElementById('hubGroupsFeed');
            if (!container) return;

            const joinedGroups = groups.filter(g => myGroupIds.has(g.id));
            const count = joinedGroups.length;

            if (count === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üë•</div>
                        <p>You haven't joined any groups yet.</p>
                        <button class="btn btn-primary" onclick="switchView('groupsView')" style="margin-top:1rem;">Browse Communities</button>
                    </div>`;
                return;
            }

            container.innerHTML = `
                <p style="font-weight:600;font-size:15px;color:var(--text-dark);margin-bottom:1rem;">
                    ${count} group${count !== 1 ? 's' : ''}
                </p>
                ${joinedGroups.map(g => `
                    <div class="group-list-card">
                        <div class="group-list-icon">üë•</div>
                        <div style="flex:1;min-width:0;">
                            <div style="font-weight:600;font-size:14px;color:var(--text-dark);">${g.name}</div>
                            <div style="font-size:12px;color:#888;margin-top:2px;">${g.member_count || 0} members${g.description ? ' ¬∑ ' + g.description.substring(0, 60) + '‚Ä¶' : ''}</div>
                        </div>
                        <button class="btn btn-secondary btn-sm" onclick="viewGroup('${g.id}')">View Group</button>
                    </div>`).join('')}
                <div class="find-more-banner" onclick="switchView('groupsView')">
                    <div>
                        <div style="font-weight:700;font-size:14px;color:var(--primary);">Find more communities to join!</div>
                        <div style="font-size:13px;color:#888;margin-top:3px;">There are groups for every major, interest, and goal üéì</div>
                    </div>
                    <button class="btn btn-primary btn-sm" style="pointer-events:none;">Browse Groups ‚Üí</button>
                </div>`;
        }

        async function renderHubChats() {
            const container = document.getElementById('hubChatsContent');
            if (!container) return;

            // Build connections list for search
            const connectedIds = new Set();
            connections.forEach(c => {
                if (c.user_id === currentUser.id) connectedIds.add(c.connected_user_id);
                if (c.connected_user_id === currentUser.id) connectedIds.add(c.user_id);
            });

            // Get upcoming scheduled meetings
            const upcomingMeetings = meetings
                .filter(m => m.status !== 'completed' && new Date(m.start_time || m.date) >= new Date())
                .sort((a, b) => new Date(a.start_time || a.date) - new Date(b.start_time || b.date))
                .slice(0, 5);

            const meetingsHTML = upcomingMeetings.length > 0
                ? upcomingMeetings.map(m => {
                    const partnerUser = users.find(u => u.id === m.organizer_id || u.id === m.participant_id);
                    const partnerName = partnerUser ? `${partnerUser.firstName} ${partnerUser.lastName}` : (m.participant_name || m.organizer_name || 'Someone');
                    const dateStr = m.start_time ? new Date(m.start_time).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) : (m.date || 'TBD');
                    return `
                        <div class="scheduled-chat-item">
                            <div class="scheduled-chat-icon">‚òï</div>
                            <div style="flex:1;min-width:0;">
                                <div style="font-weight:600;font-size:14px;color:var(--text-dark);">${partnerName}</div>
                                <div style="font-size:12px;color:#888;">${dateStr}${m.duration ? ` ¬∑ ${m.duration} min` : ''}</div>
                            </div>
                        </div>`;
                }).join('')
                : `<div style="color:#888;font-size:13px;padding:1rem 0;">No upcoming chats scheduled.</div>`;

            // Get conversation list from connected mock users (and real messages via supabase)
            const connectedUsers = users.filter(u => connectedIds.has(u.id));

            let conversationsHTML = '';
            if (connectedUsers.length > 0) {
                conversationsHTML = connectedUsers.map(u => {
                    const initials = `${u.firstName[0]}${u.lastName[0]}`;
                    return `
                        <div class="chat-inbox-item" onclick="openChatWith('${u.id}')">
                            <div class="chat-inbox-avatar">${initials}</div>
                            <div class="chat-inbox-info">
                                <div class="chat-inbox-name">${u.firstName} ${u.lastName}</div>
                                <div class="chat-inbox-preview">Say hello! ‚òï</div>
                            </div>
                        </div>`;
                }).join('');
            } else {
                // Try to load real conversations from Supabase
                try {
                    const { data: msgsData } = await supabaseClient
                        .from('messages')
                        .select('*')
                        .or(`sender_id.eq.${currentUser.id},receiver_id.eq.${currentUser.id}`)
                        .order('created_at', { ascending: false });

                    if (msgsData && msgsData.length > 0) {
                        const partnerIds = [...new Set(msgsData.map(m => m.sender_id === currentUser.id ? m.receiver_id : m.sender_id))];
                        const partnerProfiles = await Promise.all(partnerIds.map(pid =>
                            supabaseClient.from('profiles').select('id,first_name,last_name').eq('id', pid).maybeSingle().then(r => r.data)
                        ));
                        conversationsHTML = partnerProfiles.filter(Boolean).map(p => {
                            const lastMessage = msgsData.find(m => m.sender_id === p.id || m.receiver_id === p.id);
                            const preview = lastMessage ? lastMessage.content.substring(0, 45) : 'Start a conversation';
                            return `
                                <div class="chat-inbox-item" onclick="openChatWith('${p.id}')">
                                    <div class="chat-inbox-avatar">${p.first_name[0]}${p.last_name[0]}</div>
                                    <div class="chat-inbox-info">
                                        <div class="chat-inbox-name">${p.first_name} ${p.last_name}</div>
                                        <div class="chat-inbox-preview">${preview}${preview.length >= 45 ? '‚Ä¶' : ''}</div>
                                    </div>
                                </div>`;
                        }).join('');
                    }
                } catch (e) { /* silent */ }
            }

            if (!conversationsHTML) {
                conversationsHTML = `<div style="color:#888;font-size:13px;padding:1rem 0;">No conversations yet. Connect with someone and start chatting!</div>`;
            }

            container.innerHTML = `
                <div style="background:white;border-radius:12px;padding:1.5rem;border:1px solid var(--border);">
                    <div class="chats-hub-header">
                        <div class="chats-hub-search">
                            <input type="text" id="chatsSearchInput" placeholder="Search your connections‚Ä¶" oninput="filterChatsSearch(this.value)">
                        </div>
                        <button class="btn-schedule-chat" onclick="openScheduleModal()">
                            ‚òï Schedule a Chat
                        </button>
                    </div>

                    <div class="chats-section-label">Upcoming Chats</div>
                    <div id="upcomingChatsList">${meetingsHTML}</div>

                    <div class="chats-section-label">Messages</div>
                    <div id="chatsInboxList">${conversationsHTML}</div>
                </div>`;
        }

        function filterChatsSearch(query) {
            const q = query.toLowerCase().trim();
            const items = document.querySelectorAll('#chatsInboxList .chat-inbox-item');
            items.forEach(item => {
                const name = item.querySelector('.chat-inbox-name')?.textContent.toLowerCase() || '';
                item.style.display = !q || name.includes(q) ? '' : 'none';
            });
        }

        function openChatWith(userId) {
            switchView('messagesView');
            selectConversation(userId);
        }

        // ===== SCHEDULE CHAT MODAL =====
        let scheduleModalUserId = null;
        let selectedModalTime = null;

        // Mock availability for demo users
        const mockUserAvailability = {
            '00000000-0000-0000-0000-000000000002': [
                { day: 1, start: '10:00', end: '12:00' },
                { day: 3, start: '14:00', end: '17:00' },
                { day: 5, start: '09:00', end: '11:00' }
            ],
            '00000000-0000-0000-0000-000000000003': [
                { day: 2, start: '11:00', end: '13:00' },
                { day: 4, start: '15:00', end: '18:00' }
            ],
            '00000000-0000-0000-0000-000000000004': [
                { day: 1, start: '09:00', end: '11:00' },
                { day: 2, start: '14:00', end: '16:00' },
                { day: 5, start: '13:00', end: '15:00' }
            ],
            '00000000-0000-0000-0000-000000000005': [
                { day: 3, start: '10:00', end: '12:00' },
                { day: 4, start: '13:00', end: '15:00' }
            ],
            '00000000-0000-0000-0000-000000000006': [
                { day: 1, start: '14:00', end: '16:00' },
                { day: 5, start: '10:00', end: '12:00' }
            ]
        };
        const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

        function openScheduleModal() {
            const connectedIds = new Set();
            connections.forEach(c => {
                if (c.user_id === currentUser.id) connectedIds.add(c.connected_user_id);
                if (c.connected_user_id === currentUser.id) connectedIds.add(c.user_id);
            });
            const connectedUsers = users.filter(u => connectedIds.has(u.id));

            if (connectedUsers.length === 0) {
                alert("Connect with someone first before scheduling a chat!");
                closeModal('scheduleChatModal');
                switchView('discoverView');
                return;
            }

            const list = document.getElementById('schedulePersonList');
            list.innerHTML = connectedUsers.map(u => `
                <div class="schedule-modal-person" onclick="selectSchedulePerson('${u.id}')">
                    <div class="chat-inbox-avatar" style="font-size:15px;">${u.firstName[0]}${u.lastName[0]}</div>
                    <div style="flex:1;">
                        <div style="font-weight:600;font-size:14px;">${u.firstName} ${u.lastName}</div>
                        <div style="font-size:12px;color:#888;">${[u.role, u.industry].filter(Boolean).join(' ¬∑ ')}</div>
                    </div>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
                </div>`).join('');

            document.getElementById('scheduleStep1').style.display = 'block';
            document.getElementById('scheduleStep2').style.display = 'none';
            selectedModalTime = null;
            openModal('scheduleChatModal');
        }

        function openScheduleForUser(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;
            // Show modal directly at step 2
            document.getElementById('scheduleStep1').style.display = 'none';
            document.getElementById('scheduleStep2').style.display = 'block';
            selectedModalTime = null;
            openModal('scheduleChatModal');
            _populateScheduleStep2(user);
        }

        function selectSchedulePerson(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;
            document.getElementById('scheduleStep1').style.display = 'none';
            document.getElementById('scheduleStep2').style.display = 'block';
            selectedModalTime = null;
            _populateScheduleStep2(user);
        }

        function _populateScheduleStep2(user) {
            scheduleModalUserId = user.id;
            selectedPerson = user;

            document.getElementById('schedulePickedAvatar').textContent = `${user.firstName[0]}${user.lastName[0]}`;
            document.getElementById('schedulePickedName').textContent = `${user.firstName} ${user.lastName}`;
            document.getElementById('modalScheduleTopic').value = '';

            // Show availability
            const avail = mockUserAvailability[user.id] || [];
            const availContainer = document.getElementById('schedulePickedAvailability');
            if (avail.length > 0) {
                availContainer.innerHTML = `
                    <div style="background:var(--accent-light);border-radius:10px;padding:0.875rem 1rem;border:1px solid var(--border);">
                        <div style="font-weight:600;font-size:13px;color:var(--primary);margin-bottom:0.5rem;">
                            ‚òï ${user.firstName}'s typical availability
                        </div>
                        <div style="display:flex;flex-wrap:wrap;gap:0.5rem;">
                            ${avail.map(a => `
                                <span style="background:white;border:1px solid var(--border);border-radius:8px;padding:4px 10px;font-size:12px;font-weight:600;color:var(--text-dark);">
                                    ${dayNames[a.day]} ${a.start}‚Äì${a.end}
                                </span>`).join('')}
                        </div>
                        <p style="font-size:11px;color:#aaa;margin-top:0.5rem;">Pick a date and time that works for both of you ‚Äî they'll confirm the request.</p>
                    </div>`;
            } else {
                availContainer.innerHTML = `
                    <div style="font-size:13px;color:#888;padding:0.5rem 0;">
                        No set availability yet ‚Äî feel free to request any time that works for you!
                    </div>`;
            }

            // Set default date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('modalScheduleDate').value = tomorrow.toISOString().split('T')[0];
            renderModalTimeSlots();
        }

        function resetScheduleStep() {
            document.getElementById('scheduleStep1').style.display = 'block';
            document.getElementById('scheduleStep2').style.display = 'none';
            scheduleModalUserId = null;
            selectedModalTime = null;
        }

        function renderModalTimeSlots() {
            const times = [];
            for (let hour = 8; hour < 20; hour++) {
                for (let min of [0, 30]) {
                    times.push(`${String(hour).padStart(2, '0')}:${String(min).padStart(2, '0')}`);
                }
            }
            selectedModalTime = null;
            document.getElementById('modalTimeSlots').innerHTML = times.map(t =>
                `<div class="time-slot" onclick="selectModalTime('${t}', this)">${t}</div>`
            ).join('');
        }

        function selectModalTime(time, el) {
            document.querySelectorAll('#modalTimeSlots .time-slot').forEach(e => e.classList.remove('selected'));
            el.classList.add('selected');
            selectedModalTime = time;
        }

        function sendModalMeetingRequest() {
            const date = document.getElementById('modalScheduleDate').value;
            const duration = document.getElementById('modalScheduleDuration').value;
            const topic = document.getElementById('modalScheduleTopic').value.trim();
            const type = document.getElementById('modalScheduleType').value;

            if (!date) { alert('Please select a date'); return; }
            if (!selectedModalTime) { alert('Please select a time slot'); return; }
            if (!topic) { alert('Please add a note about what you\'d like to discuss'); return; }
            if (!selectedPerson) { alert('Please select a person to chat with'); return; }

            const meeting = {
                id: meetings.length + 1,
                personId: selectedPerson.id,
                personName: `${selectedPerson.firstName} ${selectedPerson.lastName}`,
                date,
                time: selectedModalTime,
                duration,
                topic,
                type,
                status: 'pending',
                createdAt: new Date()
            };

            meetings.push(meeting);
            closeModal('scheduleChatModal');
            selectedModalTime = null;
            alert(`Chat request sent to ${selectedPerson.firstName}! üéâ They'll confirm a time that works.`);
            updateDashboard();
        }

        function formatTimeAgo(date) {
            const diff = Date.now() - date.getTime();
            const hours = Math.floor(diff / 3600000);
            if (hours < 1) return 'Just now';
            if (hours < 24) return `${hours}h ago`;
            const days = Math.floor(hours / 24);
            if (days === 1) return 'Yesterday';
            return `${days}d ago`;
        }

        // Discovery
        function renderDiscovery() {
            // Render smart recommendations (isolated ‚Äî never blocks main grid)
            const recSection = document.getElementById('recommendationsSection');
            if (recSection) {
                try {
                    recSection.innerHTML = renderRecommendations();
                } catch (e) {
                    console.warn('Recommendations render error:', e);
                    recSection.innerHTML = '';
                }
            }

            const searchName = document.getElementById('searchName')?.value.toLowerCase() || '';
            const filterIndustry = document.getElementById('filterIndustry')?.value || '';
            const searchLocation = document.getElementById('searchLocation')?.value.toLowerCase() || '';
            const searchInterests = document.getElementById('searchInterests')?.value.toLowerCase() || '';
            const searchCompany = document.getElementById('searchCompany')?.value.toLowerCase() || '';

            let filtered = users.filter(u => {
                // Never show self
                if (u.id === currentUser.id) return false;

                // Name match
                const matchName = !searchName ||
                    (u.firstName || '').toLowerCase().includes(searchName) ||
                    (u.lastName || '').toLowerCase().includes(searchName);

                // Industry match
                const matchIndustry = !filterIndustry || u.industry === filterIndustry;

                // Location match
                const matchLocation = !searchLocation ||
                    (u.location && u.location.toLowerCase().includes(searchLocation));

                // Interests match
                const matchInterests = !searchInterests ||
                    (u.interests && u.interests.some(interest =>
                        interest.toLowerCase().includes(searchInterests)
                    )) ||
                    (u.hobbies && u.hobbies.some(hobby =>
                        hobby.toLowerCase().includes(searchInterests)
                    ));

                // Company match
                const matchCompany = !searchCompany ||
                    (u.company && u.company.toLowerCase().includes(searchCompany));

                return matchName && matchIndustry && matchLocation && matchInterests && matchCompany;
            });

            const grid = document.getElementById('discoverGrid');
            try {
            grid.innerHTML = filtered.map(user => {
                const fn = user.firstName || '?';
                const ln = user.lastName || '?';
                const isConnected = connections.find(c =>
                    (c.user_id === currentUser.id && c.connected_user_id === user.id) ||
                    (c.connected_user_id === currentUser.id && c.user_id === user.id));
                const isPending = sentRequests.find(c => c.connected_user_id === user.id);
                const hasRequestedMe = pendingRequests.find(c => c.user_id === user.id);
                const avatarHTML = user.profilePicture ?
                    `<div class="person-avatar" style="width: 70px; height: 70px; font-size: 28px; margin: 0 auto 1rem;"><img src="${user.profilePicture}" alt="${fn}"></div>` :
                    `<div class="person-avatar" style="width: 70px; height: 70px; font-size: 28px; margin: 0 auto 1rem;">${fn[0]}${ln[0]}</div>`;

                let actionBtn;
                if (isConnected) {
                    actionBtn = `<button class="btn btn-secondary btn-sm" onclick="startMessage('${user.id}')" style="flex: 1; justify-content: center;">Message</button>`;
                } else if (hasRequestedMe) {
                    actionBtn = `<button class="btn btn-accent btn-sm" onclick="acceptConnection('${hasRequestedMe.id}')" style="flex: 1; justify-content: center;">Accept Request</button>`;
                } else if (isPending) {
                    actionBtn = `<button class="btn btn-secondary btn-sm" disabled style="flex: 1; justify-content: center; opacity: 0.6;">Request Sent</button>`;
                } else {
                    actionBtn = `<button class="btn btn-accent btn-sm" onclick="connectUser('${user.id}')" style="flex: 1; justify-content: center;">Connect</button>`;
                }

                return `
                    <div class="card person-card">
                        ${avatarHTML}
                        <h3>${fn} ${ln}</h3>
                        ${user.role ? `<p class="role">${user.role}</p>` : `<p class="role">${user.industry || ''}</p>`}
                        ${user.company ? `<p style="font-size: 12px; color: #999; margin-top: -0.25rem;">${user.company}</p>` : ''}
                        <div class="tags">
                            ${(user.interests || []).slice(0, 3).map(i => `<span class="tag">${i}</span>`).join('')}
                        </div>
                        <div class="profile-actions">
                            <button class="btn btn-primary btn-sm" onclick="viewProfile('${user.id}')" style="flex: 1; justify-content: center;">View Profile</button>
                            ${actionBtn}
                        </div>
                    </div>
                `;
            }).join('') || '<div class="empty-state"><p>No people found matching your filters.</p></div>';
            } catch (e) {
                console.error('Discover grid render error:', e);
                grid.innerHTML = '<div class="empty-state"><p>Could not load profiles. Please refresh.</p></div>';
            }
        }

        function filterDiscovery() {
            renderDiscovery();
        }

        function clearFilters() {
            document.getElementById('searchName').value = '';
            document.getElementById('filterIndustry').value = '';
            document.getElementById('searchLocation').value = '';
            document.getElementById('searchInterests').value = '';
            document.getElementById('searchCompany').value = '';
            renderDiscovery();
        }

        function viewProfile(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;

            selectedPerson = user;

            const isConnected = connections.find(c => c.user_id === currentUser.id && c.connected_user_id === userId || c.connected_user_id === currentUser.id && c.user_id === userId);
            const isOwnProfile = currentUser && currentUser.id === userId;

            const avatarHTML = user.profilePicture ? 
                `<div class="person-avatar" style="width: 120px; height: 120px; font-size: 48px;"><img src="${user.profilePicture}" alt="${user.firstName}"></div>` :
                `<div class="person-avatar" style="width: 120px; height: 120px; font-size: 48px;">${user.firstName[0]}${user.lastName[0]}</div>`;

            const content = document.getElementById('profileDetailContent');
            content.innerHTML = `
                <div class="profile-header">
                    ${avatarHTML}
                    ${isOwnProfile ? '<button class="btn btn-secondary btn-sm edit-profile-btn" onclick="editMyProfile()">‚úèÔ∏è Edit Profile</button>' : ''}
                    <h1 style="margin-bottom: 0.5rem;">${user.firstName} ${user.lastName}</h1>
                    ${user.role ? `<p style="font-weight: 600; color: var(--primary); margin-bottom: 0.25rem;">${user.role}${user.company ? ` at ${user.company}` : ''}</p>` : (user.company ? `<p style="color: #666; font-size: 14px; margin-bottom: 0.25rem;">${user.company}</p>` : '')}
                    ${user.location ? `<p style="color: #999; font-size: 13px;">üéì Class of ${user.location}</p>` : ''}
                    <p class="role" style="margin-top: 0.5rem;">${user.industry}</p>
                </div>

                ${user.bio ? `
                    <div class="profile-info">
                        <h3>About</h3>
                        <p style="line-height: 1.6;">${user.bio}</p>
                    </div>
                ` : ''}

                ${user.resume ? `
                    <div class="resume-section">
                        <h3 style="margin-bottom: 1rem;">Resume</h3>
                        <a href="${user.resume}" class="resume-link" download>
                            <div class="resume-icon">üìÑ</div>
                            <div>
                                <p style="font-weight: 600; margin: 0;">${user.firstName}'s Resume</p>
                                <p style="font-size: 12px; color: #999; margin: 0;">Click to download PDF</p>
                            </div>
                        </a>
                    </div>
                ` : ''}

                <div class="profile-info">
                    <h3>Career Goals</h3>
                    <p>${user.goals}</p>
                </div>

                <div class="profile-info">
                    <h3>Interests & Passions</h3>
                    <div class="profile-tags">
                        ${user.interests.map(i => `<span class="tag">${i}</span>`).join('')}
                    </div>
                </div>

                ${!isOwnProfile ? `
                    <div class="profile-actions">
                        ${isConnected ? `
                            <button class="btn btn-primary" onclick="startMessage('${user.id}')">üí¨ Send Message</button>
                            <button class="btn btn-accent" onclick="scheduleWith('${user.id}')">üìÖ Schedule Chat</button>
                        ` : `
                            <button class="btn btn-primary" onclick="connectUser('${user.id}')">Add Connection</button>
                            <button class="btn btn-secondary" onclick="switchView('discoverView')">Back</button>
                        `}
                    </div>
                ` : ''}

                ${isOwnProfile ? `
                    <div class="profile-info">
                        <h3>Your Badges</h3>
                        <div class="badge-grid" id="profileBadges"></div>
                    </div>
                ` : ''}

                ${user.posts && user.posts.length > 0 ? `
                    <div class="profile-posts">
                        <h3 style="margin-bottom: 1rem;">Recent Posts</h3>
                        ${user.posts.map(post => `
                            <div class="post-card">
                                <div class="post-header">
                                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                                        ${user.profilePicture ? 
                                            `<div class="person-avatar" style="width: 40px; height: 40px; font-size: 16px;"><img src="${user.profilePicture}"></div>` :
                                            `<div class="person-avatar" style="width: 40px; height: 40px; font-size: 16px;">${user.firstName[0]}${user.lastName[0]}</div>`
                                        }
                                        <div>
                                            <h4 style="margin: 0; font-size: 14px;">${user.firstName} ${user.lastName}</h4>
                                            <p class="post-meta">${post.date}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="post-content">${post.content}</div>
                                <div class="post-actions">
                                    <button class="post-action-btn" onclick="likePost(${post.id})">üëç ${post.likes} Likes</button>
                                    <button class="post-action-btn">üí¨ Comment</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
            `;

            switchView('profileDetailView');

            // Render badges on own profile
            if (isOwnProfile) {
                setTimeout(() => renderBadges('profileBadges'), 50);
            }
        }

        async function connectUser(userId) {
            if (!currentUser) return;
            if (userId === currentUser.id) return; // never connect with self

            const user = users.find(u => u.id === userId);

            // Already connected?
            const alreadyConnected = connections.find(c =>
                (c.user_id === currentUser.id && c.connected_user_id === userId) ||
                (c.user_id === userId && c.connected_user_id === currentUser.id)
            );
            if (alreadyConnected) { showToast('Already connected!', 'info'); return; }

            // Already sent a request?
            const alreadySent = sentRequests.find(c => c.connected_user_id === userId);
            if (alreadySent) { showToast('Request already sent!', 'info'); return; }

            try {
                const { data, error } = await supabaseClient
                    .from('connections')
                    .insert([{
                        user_id: currentUser.id,
                        connected_user_id: userId,
                        status: 'pending'
                    }])
                    .select()
                    .single();

                if (error) throw error;

                sentRequests.push(data);
                showToast(`Request sent to ${user ? user.firstName : 'user'}!`, 'success');

                if (document.getElementById('profileDetailView').classList.contains('active')) {
                    viewProfile(userId);
                } else {
                    renderDiscovery();
                }
            } catch (err) {
                console.error('Error sending request:', err);
                showToast('Failed to send request: ' + err.message, 'error');
            }
        }

        async function acceptConnection(connectionId) {
            try {
                const { error } = await supabaseClient
                    .from('connections')
                    .update({ status: 'accepted' })
                    .eq('id', connectionId);

                if (error) throw error;

                const req = pendingRequests.find(r => r.id === connectionId);
                if (req) {
                    connections.push({ ...req, status: 'accepted' });
                    pendingRequests = pendingRequests.filter(r => r.id !== connectionId);
                }
                showToast('Connection accepted!', 'success');
                checkBadgesWithCelebration();
                renderHubNetworkFeed();
                generateNotifications();
                renderDiscovery();
            } catch (err) {
                console.error('Error accepting connection:', err);
                showToast('Failed to accept: ' + err.message, 'error');
            }
        }

        async function rejectConnection(connectionId) {
            try {
                const { error } = await supabaseClient
                    .from('connections')
                    .delete()
                    .eq('id', connectionId);

                if (error) throw error;

                pendingRequests = pendingRequests.filter(r => r.id !== connectionId);
                showToast('Request declined.', 'info');
                renderHubNetworkFeed();
                generateNotifications();
            } catch (err) {
                console.error('Error rejecting connection:', err);
                showToast('Failed to decline: ' + err.message, 'error');
            }
        }

        // Messages
        async function startMessage(userId) {
            switchView('messagesView');
            await renderMessages();
            await selectConversation(userId);
        }

        async function renderMessages() {
            if (!currentUser) return;

            try {
                // Get all conversations (messages where user is sender or receiver)
                const { data: messagesData, error } = await supabaseClient
                    .from('messages')
                    .select('*')
                    .or(`sender_id.eq.${currentUser.id},receiver_id.eq.${currentUser.id}`)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                // Group messages by conversation partner
                const conversations = {};
                messagesData.forEach(msg => {
                    const partnerId = msg.sender_id === currentUser.id ? msg.receiver_id : msg.sender_id;
                    if (!conversations[partnerId]) {
                        conversations[partnerId] = [];
                    }
                    conversations[partnerId].push(msg);
                });

                const list = document.getElementById('conversationList');

                if (Object.keys(conversations).length === 0) {
                    list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üí¨</div><p>No conversations yet</p></div>';
                    document.getElementById('chatWindow').innerHTML = '<div class="chat-header"><h3>Start a conversation</h3></div>';
                    return;
                }

                // Render conversation list
                const conversationHTML = await Promise.all(
                    Object.entries(conversations).map(async ([partnerId, msgs]) => {
                        // Get partner profile
                        const { data: profile } = await supabaseClient
                            .from('profiles')
                            .select('first_name, last_name')
                            .eq('id', partnerId)
                            .single();

                        const partnerName = profile ? `${profile.first_name} ${profile.last_name}` : 'User';
                        const lastMessage = msgs[0].content.substring(0, 50);

                        return `
                            <div class="conversation-item ${selectedConversation === partnerId ? 'active' : ''}" onclick="selectConversation('${partnerId}')">
                                <h4>${partnerName}</h4>
                                <p style="font-size: 12px; color: #999;">${lastMessage}${msgs[0].content.length > 50 ? '...' : ''}</p>
                            </div>
                        `;
                    })
                );

                list.innerHTML = conversationHTML.join('');
            } catch (error) {
                console.error('Error rendering messages:', error);
            }
        }

        async function selectConversation(userId) {
            if (!currentUser) return;

            selectedConversation = userId;

            try {
                let messagesData = [];
                let partnerName = 'User';

                const { data, error } = await supabaseClient
                    .from('messages')
                    .select('*')
                    .or(`and(sender_id.eq.${currentUser.id},receiver_id.eq.${userId}),and(sender_id.eq.${userId},receiver_id.eq.${currentUser.id})`)
                    .order('created_at', { ascending: true });

                if (error) throw error;
                messagesData = data || [];

                const { data: profile } = await supabaseClient
                    .from('profiles')
                    .select('first_name, last_name')
                    .eq('id', userId)
                    .maybeSingle();

                partnerName = profile ? `${profile.first_name} ${profile.last_name}` : 'User';

                const icebreakers = getConversationStarters(userId);
                const icebreakerHTML = (!messagesData || messagesData.length === 0) ? `
                    <div style="text-align: center; padding: 2rem;">
                        <p style="font-size: 14px; color: #999; margin-bottom: 1rem;">Start a conversation with ${partnerName}!</p>
                        <p style="font-size: 13px; color: var(--primary); font-weight: 600; margin-bottom: 0.75rem;">Try one of these icebreakers:</p>
                        ${icebreakers.map(starter => `
                            <button class="btn btn-secondary btn-sm"
                                onclick="useIcebreaker('${userId}', this.textContent.trim())"
                                style="margin: 0.25rem; font-size: 12px; text-align: left;">
                                ${starter}
                            </button>
                        `).join('')}
                    </div>
                ` : '';

                const chatWindow = document.getElementById('chatWindow');
                chatWindow.innerHTML = `
                    <div class="chat-header">
                        <div>
                            <h3 style="margin: 0;">${partnerName}</h3>
                        </div>
                        <button class="btn btn-accent btn-sm" onclick="scheduleWith('${userId}')">Schedule Chat</button>
                    </div>
                    <div class="chat-messages" id="chatMessagesContainer">
                        ${icebreakerHTML}
                        ${messagesData.map(m => `
                            <div class="message ${m.sender_id === currentUser.id ? 'sent' : 'received'}">
                                <div class="message-content">${m.content}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="chat-input">
                        <input type="text" id="messageInput" placeholder="Type a message..." onkeypress="if(event.key==='Enter') sendMessage('${userId}')">
                        <button class="btn btn-primary btn-sm" onclick="sendMessage('${userId}')">Send</button>
                    </div>
                `;

                // Scroll to bottom
                const container = document.getElementById('chatMessagesContainer');
                if (container) {
                    container.scrollTop = container.scrollHeight;
                }

                // Mark messages as read
                await supabaseClient
                    .from('messages')
                    .update({ read: true })
                    .eq('receiver_id', currentUser.id)
                    .eq('sender_id', userId);

            } catch (error) {
                console.error('Error selecting conversation:', error);
            }
        }

        async function sendMessage(userId) {
            if (!currentUser) return;

            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            if (!text) return;

            try {
                const { error } = await supabaseClient
                    .from('messages')
                    .insert([{
                        sender_id: currentUser.id,
                        receiver_id: userId,
                        content: text
                    }]);

                if (error) throw error;

                sentMessageCount++;
                input.value = '';
                await selectConversation(userId);
            } catch (error) {
                console.error('Error sending message:', error);
                showToast('Failed to send message: ' + error.message, 'error');
            }
        }

        function getConversationStarters(userId) {
            const partner = users.find(u => u.id === userId);
            const starters = [];

            if (partner) {
                if (partner.industry) {
                    starters.push(`What got you interested in ${partner.industry}?`);
                }
                if (partner.role && partner.company) {
                    starters.push(`How's ${partner.role} year going at ${partner.company}?`);
                } else if (partner.company) {
                    starters.push(`How do you like it at ${partner.company}?`);
                }
                if (partner.interests && partner.interests.length > 0) {
                    starters.push(`I noticed we share an interest in ${partner.interests[0]}!`);
                }
                if (partner.goals) {
                    starters.push(`What's your game plan for breaking into the industry after graduation?`);
                }
            }

            const generic = [
                "What's been the highlight of your semester so far?",
                "Any good books, podcasts, or classes you'd recommend?",
                "What project or internship are you most excited about right now?"
            ];

            return [...starters, ...generic].slice(0, 4);
        }

        function useIcebreaker(userId, text) {
            const input = document.getElementById('messageInput');
            if (input) {
                input.value = text;
                input.focus();
                localStorage.setItem('usedIcebreaker', 'true');
            }
        }

        // Groups
        function renderGroups() {
            const list = document.getElementById('groupsList');
            list.innerHTML = groups.map(group => {
                const joined = myGroupIds.has(group.id);
                return `
                <div class="group-card">
                    <div class="group-header">
                        <div>
                            <h3 style="margin-bottom: 0.25rem;">${group.name}</h3>
                            <span class="industry-pill">${group.industry || ''}</span>
                        </div>
                    </div>
                    <p style="font-size: 13px; color: #666; margin: 0.5rem 0;">${group.description || ''}</p>
                    <div class="group-meta">
                        <span>&#128101; ${group.member_count || 0} members</span>
                    </div>
                    ${joined ?
                        `<button class="btn btn-accent" onclick="viewGroup('${group.id}')" style="width: 100%; margin-top: 0.75rem;">View Group</button>` :
                        `<button class="btn btn-primary" onclick="joinGroup('${group.id}')" style="width: 100%; margin-top: 0.75rem;">Join Group</button>`
                    }
                </div>`;
            }).join('') || '<div class="empty-state"><p>No groups available yet</p></div>';

            const myGroups = groups.filter(g => myGroupIds.has(g.id));
            const myList = document.getElementById('myGroupsList');
            if (myGroups.length === 0) {
                myList.innerHTML = '<div class="empty-state"><p>Join groups to connect with your community</p></div>';
            } else {
                myList.innerHTML = myGroups.map(group => `
                    <div class="group-card" onclick="viewGroup('${group.id}')" style="cursor: pointer; margin-bottom: 0.75rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3 style="color: var(--primary); margin-bottom: 0.25rem;">&#10003; ${group.name}</h3>
                                <div class="group-meta" style="margin: 0;">
                                    <span>&#128101; ${group.member_count || 0} members</span>
                                </div>
                            </div>
                            <span style="color: var(--accent); font-size: 18px;">&rarr;</span>
                        </div>
                    </div>`
                ).join('');
            }
        }

        async function viewGroup(groupId) {
            const group = groups.find(g => g.id === groupId);
            if (!group) return;

            switchView('groupDetailView');
            const content = document.getElementById('groupDetailContent');
            content.innerHTML = '<div class="empty-state"><p>Loading group...</p></div>';

            try {
                // Load group posts with author profiles
                const { data: postsData } = await supabaseClient
                    .from('posts')
                    .select('*, profiles!posts_author_id_fkey(first_name, last_name)')
                    .eq('group_id', groupId)
                    .order('created_at', { ascending: false });

                // Load group members with profiles
                const { data: membersData } = await supabaseClient
                    .from('group_members')
                    .select('user_id, profiles!group_members_user_id_fkey(id, first_name, last_name, industry, role, company)')
                    .eq('group_id', groupId);

                const memberCards = (membersData || []).map(m => {
                    const p = m.profiles;
                    if (!p) return '';
                    const isConnected = connections.find(c =>
                        (c.user_id === currentUser.id && c.connected_user_id === p.id) ||
                        (c.connected_user_id === currentUser.id && c.user_id === p.id)
                    );
                    return `
                        <div class="card compact" style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                            <div class="person-avatar" style="width: 44px; height: 44px; font-size: 16px; flex-shrink: 0;">${p.first_name[0]}${p.last_name[0]}</div>
                            <div style="flex: 1; min-width: 0;">
                                <strong style="font-size: 14px;">${p.first_name} ${p.last_name}</strong>
                                <p style="font-size: 12px; color: #999; margin: 0;">${p.role || p.industry || ''}</p>
                            </div>
                            <div style="display: flex; gap: 0.5rem; flex-shrink: 0;">
                                <button class="btn btn-secondary btn-sm" onclick="viewProfile('${p.id}')" style="font-size: 11px; padding: 4px 10px;">View</button>
                                ${p.id !== currentUser.id ? (isConnected ? `<span style="font-size: 11px; color: var(--success);">&#10003; Connected</span>` : `<button class="btn btn-primary btn-sm" onclick="connectUser('${p.id}')" style="font-size: 11px; padding: 4px 10px;">Connect</button>`) : ''}
                            </div>
                        </div>`;
                }).join('');

                const postsHTML = (postsData || []).map(post => {
                    const authorName = post.profiles ? `${post.profiles.first_name} ${post.profiles.last_name}` : 'Member';
                    const timeAgo = post.created_at ? getTimeAgo(post.created_at) : '';
                    return `
                        <div style="padding: 1rem; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <strong>${authorName}</strong>
                                <span style="font-size: 11px; color: #999;">${timeAgo}</span>
                            </div>
                            <p style="color: #444; margin-bottom: 0.75rem;">${post.content}</p>
                            <div class="post-actions" style="padding-top: 0.5rem; border-top: 1px solid var(--border);">
                                <button class="post-action-btn" onclick="likeGroupPost('${post.id}', '${groupId}')">&#128077; ${post.likes_count || 0} Likes</button>
                                <button class="post-action-btn" onclick="toggleGroupDetailComments('${post.id}')">&#128172; Comment</button>
                            </div>
                            <div id="gd-comments-${post.id}" style="display: none; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border);">
                                <div id="gd-comments-list-${post.id}" style="margin-bottom: 0.5rem;"></div>
                                <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                                    <input type="text" id="gci-${post.id}" placeholder="Write a comment..." style="flex: 1; padding: 6px 10px; border-radius: 6px; border: 1px solid var(--border); font-size: 13px;" onkeypress="if(event.key==='Enter') submitGroupComment('${post.id}', '${groupId}')">
                                    <button class="btn btn-primary btn-sm" onclick="submitGroupComment('${post.id}', '${groupId}')" style="font-size: 12px; padding: 4px 10px;">Post</button>
                                </div>
                            </div>
                        </div>`;
                }).join('') || '<p style="color: #999;">No posts yet. Start the conversation!</p>';

                content.innerHTML = `
                    <div style="background: white; border-radius: 12px; padding: 2rem; border: 1px solid var(--border); margin-bottom: 2rem;">
                        <h1 style="margin-bottom: 0.5rem;">${group.name}</h1>
                        <p style="color: #666; margin-bottom: 0.5rem;">${group.description || ''}</p>
                        <div class="group-meta">
                            <span>&#128101; ${group.member_count || 0} members</span>
                            <span class="industry-pill">${group.industry || ''}</span>
                        </div>
                    </div>

                    <div style="background: white; border-radius: 12px; padding: 2rem; border: 1px solid var(--border); margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem;">Group Discussion</h3>
                        <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem;">
                            <input type="text" id="groupPostInput" placeholder="Share something with the group..." style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid var(--border);" onkeypress="if(event.key==='Enter') postToGroup('${groupId}')">
                            <button class="btn btn-primary btn-sm" onclick="postToGroup('${groupId}')">Post</button>
                        </div>
                        <div id="groupPosts-${groupId}">${postsHTML}</div>
                    </div>

                    <div style="background: white; border-radius: 12px; padding: 2rem; border: 1px solid var(--border);">
                        <h3 style="margin-bottom: 1rem;">Members (${(membersData || []).length})</h3>
                        ${memberCards || '<p style="color: #999;">No members yet</p>'}
                    </div>
                `;
            } catch (err) {
                console.error('Error loading group:', err);
                content.innerHTML = '<div class="empty-state"><p>Failed to load group. Please try again.</p></div>';
            }
        }

        function toggleGroupDetailComments(postId) {
            const el = document.getElementById(`gd-comments-${postId}`);
            if (el) el.style.display = el.style.display === 'none' ? 'block' : 'none';
        }

        async function postToGroup(groupId) {
            const input = document.getElementById('groupPostInput');
            const text = input.value.trim();
            if (!text || !currentUser) return;

            try {
                const { error } = await supabaseClient
                    .from('posts')
                    .insert([{
                        author_id: currentUser.id,
                        content: text,
                        group_id: groupId
                    }]);

                if (error) throw error;

                input.value = '';
                await viewGroup(groupId);
                showToast('Posted to group!', 'success');
            } catch (err) {
                console.error('Error posting to group:', err);
                showToast('Failed to post: ' + err.message, 'error');
            }
        }

        async function likeGroupPost(postId, groupId) {
            if (!currentUser) return;
            try {
                const { data: existing } = await supabaseClient
                    .from('post_likes')
                    .select('id')
                    .eq('post_id', postId)
                    .eq('user_id', currentUser.id)
                    .maybeSingle();

                if (existing) {
                    await supabaseClient.from('post_likes').delete().eq('id', existing.id);
                } else {
                    await supabaseClient.from('post_likes').insert([{ post_id: postId, user_id: currentUser.id }]);
                }
                await viewGroup(groupId);
            } catch (err) {
                console.error('Error liking post:', err);
            }
        }

        async function submitGroupComment(postId, groupId) {
            const input = document.getElementById(`gci-${postId}`);
            if (!input) return;
            const text = input.value.trim();
            if (!text || !currentUser) return;

            try {
                const { error } = await supabaseClient
                    .from('post_comments')
                    .insert([{ post_id: postId, user_id: currentUser.id, content: text }]);

                if (error) throw error;
                await viewGroup(groupId);
            } catch (err) {
                console.error('Error submitting comment:', err);
                showToast('Failed to submit comment', 'error');
            }
        }

        function shareGroupPost(postId, content) {
            if (navigator.share) {
                navigator.share({ title: 'First Sip Group Post', text: content });
            } else {
                navigator.clipboard.writeText(content).then(() => {
                    showToast('Post copied to clipboard!', 'info');
                });
            }
        }

        async function joinGroup(groupId) {
            const group = groups.find(g => g.id === groupId);
            if (!group || myGroupIds.has(groupId)) return;

            try {
                const { error } = await supabaseClient
                    .from('group_members')
                    .insert([{ group_id: groupId, user_id: currentUser.id }]);

                if (error) throw error;

                myGroupIds.add(groupId);
                group.member_count = (group.member_count || 0) + 1; // optimistic local update (DB trigger handles the real count)

                renderGroups();
                showToast(`Joined ${group.name}!`, 'success');
                checkBadgesWithCelebration();
            } catch (err) {
                console.error('Error joining group:', err);
                showToast('Failed to join group: ' + err.message, 'error');
            }
        }

        async function createGroup() {
            const name = document.getElementById('newGroupName').value.trim();
            const industry = document.getElementById('newGroupIndustry').value;
            const description = document.getElementById('newGroupDescription').value.trim();
            const errEl = document.getElementById('createGroupError');
            const btn = document.getElementById('createGroupBtn');

            errEl.style.display = 'none';

            if (!name) { errEl.textContent = 'Please enter a group name.'; errEl.style.display = 'block'; return; }
            if (!industry) { errEl.textContent = 'Please select an industry/focus area.'; errEl.style.display = 'block'; return; }
            if (!description) { errEl.textContent = 'Please add a short description.'; errEl.style.display = 'block'; return; }

            btn.disabled = true;
            btn.textContent = 'Creating‚Ä¶';

            try {
                const { data: newGroup, error } = await supabaseClient
                    .from('groups')
                    .insert([{ name, industry, description, creator_id: currentUser.id, member_count: 1 }])
                    .select()
                    .single();

                if (error) throw error;

                // Auto-join the creator as admin
                await supabaseClient
                    .from('group_members')
                    .insert([{ group_id: newGroup.id, user_id: currentUser.id, role: 'admin' }]);

                groups.unshift(newGroup);
                myGroupIds.add(newGroup.id);

                // Reset form
                document.getElementById('newGroupName').value = '';
                document.getElementById('newGroupIndustry').value = '';
                document.getElementById('newGroupDescription').value = '';
                document.getElementById('newGroupDescCount').textContent = '0 / 300';

                closeModal('createGroupModal');
                renderGroups();
                showToast(`"${newGroup.name}" created!`, 'success');
            } catch (err) {
                console.error('Error creating group:', err);
                errEl.textContent = 'Failed to create group: ' + err.message;
                errEl.style.display = 'block';
            } finally {
                btn.disabled = false;
                btn.textContent = 'Create Group';
            }
        }

        // Calendar
        function renderCalendar() {
            renderCalendarGrid();
        }

        function renderCalendarView() {
            renderCalendarGrid();
            renderMeetingsList();
        }

        function renderCalendarGrid() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            
            document.getElementById('currentMonth').textContent = `${monthNames[currentMonth.getMonth()]} ${currentMonth.getFullYear()}`;

            const firstDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1);
            const lastDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();

            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            let html = days.map(day => `<div class="calendar-day-header">${day}</div>`).join('');

            for (let i = 0; i < startingDayOfWeek; i++) {
                html += '<div class="calendar-day other-month"></div>';
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), day);
                const isToday = new Date().toDateString() === date.toDateString();
                const hasEvent = meetings.some(m => new Date(m.date).toDateString() === date.toDateString());
                
                html += `<div class="calendar-day ${isToday ? 'today' : ''} ${hasEvent ? 'has-event' : ''}">${day}</div>`;
            }

            document.getElementById('calendarGrid').innerHTML = html;
        }

        function renderMeetingsList() {
            const list = document.getElementById('meetingsList');
            const upcomingMeetings = meetings.filter(m => m.status !== 'completed').sort((a, b) => new Date(a.date) - new Date(b.date));

            if (upcomingMeetings.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>No upcoming meetings</p></div>';
                return;
            }

            list.innerHTML = upcomingMeetings.map(meeting => `
                <div class="meeting-card">
                    <div class="meeting-header">
                        <div>
                            <p class="meeting-time">${new Date(meeting.date).toLocaleDateString()} at ${meeting.time}</p>
                            <h3 style="margin: 0.5rem 0 0.25rem;">${meeting.personName}</h3>
                            <p style="font-size: 13px; color: #999; margin: 0;">${meeting.topic}</p>
                            <p style="font-size: 12px; color: #666; margin-top: 0.25rem;">Type: ${meeting.type}</p>
                        </div>
                        <span class="meeting-status ${meeting.status}">${meeting.status.charAt(0).toUpperCase() + meeting.status.slice(1)}</span>
                    </div>
                    <div class="meeting-actions">
                        <button class="btn btn-primary btn-sm" onclick="startCall('${meeting.personName}', '${meeting.personName[0]}')">Start Call</button>
                        <button class="btn btn-secondary btn-sm">Reschedule</button>
                    </div>
                </div>
            `).join('');
        }

        function previousMonth() {
            currentMonth.setMonth(currentMonth.getMonth() - 1);
            renderCalendarGrid();
        }

        function nextMonth() {
            currentMonth.setMonth(currentMonth.getMonth() + 1);
            renderCalendarGrid();
        }

        // Schedule Meeting
        function scheduleWith(userId) {
            const user = users.find(u => u.id === userId);
            selectedPerson = user;
            previousView = 'profileDetailView';

            document.getElementById('scheduleName').textContent = `${user.firstName} ${user.lastName}`;
            
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('scheduleDate').value = tomorrow.toISOString().split('T')[0];

            renderTimeSlots();
            document.getElementById('scheduleDate').onchange = renderTimeSlots;

            switchView('scheduleView');
        }

        function renderTimeSlots() {
            const times = [];
            for (let hour = 9; hour < 17; hour++) {
                for (let min of [0, 30]) {
                    const time = `${String(hour).padStart(2, '0')}:${String(min).padStart(2, '0')}`;
                    times.push(time);
                }
            }

            const html = times.map(time => `
                <div class="time-slot" onclick="selectTime('${time}', this)">${time}</div>
            `).join('');

            document.getElementById('timeSlots').innerHTML = html;
        }

        function selectTime(time, element) {
            document.querySelectorAll('.time-slot').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selectedTime = time;
        }

        function updateMeetingDetails() {
            const type = document.getElementById('scheduleType').value;
            const label = document.getElementById('meetingDetailLabel');
            const input = document.getElementById('meetingDetailInput');
            const hint = document.getElementById('meetingDetailHint');

            switch (type) {
                case 'video':
                    label.textContent = 'Video Call Link';
                    input.placeholder = 'Paste your video call link here';
                    input.type = 'text';
                    hint.textContent = 'e.g., Google Meet, Teams, or other video call link';
                    break;
                case 'zoom':
                    label.textContent = 'Zoom Meeting Link';
                    input.placeholder = 'https://zoom.us/j/...';
                    input.type = 'text';
                    hint.textContent = 'Paste your Zoom meeting link or meeting ID';
                    break;
                case 'facetime':
                    label.textContent = 'FaceTime Number or Email';
                    input.placeholder = '+1 (555) 123-4567 or email@icloud.com';
                    input.type = 'text';
                    hint.textContent = 'Phone number or Apple ID for FaceTime';
                    break;
                case 'phone':
                    label.textContent = 'Phone Number';
                    input.placeholder = '+1 (555) 123-4567';
                    input.type = 'tel';
                    hint.textContent = 'Enter the phone number to call';
                    break;
                case 'coffee':
                    label.textContent = 'Meeting Location';
                    input.placeholder = 'e.g., Blue Bottle Coffee, 123 Main St';
                    input.type = 'text';
                    hint.textContent = 'Name and address of the coffee shop or meeting spot';
                    break;
            }
        }

        function sendMeetingRequest() {
            const date = document.getElementById('scheduleDate').value;
            const time = selectedTime;
            const duration = document.getElementById('scheduleDuration').value;
            const topic = document.getElementById('scheduleTopic').value;
            const type = document.getElementById('scheduleType').value;
            const meetingDetail = document.getElementById('meetingDetailInput').value.trim();

            if (!date || !time || !topic) {
                alert('Please fill in all fields');
                return;
            }

            if (!meetingDetail) {
                const detailNames = { video: 'video call link', zoom: 'Zoom link', facetime: 'FaceTime contact', phone: 'phone number', coffee: 'meeting location' };
                alert(`Please enter the ${detailNames[type] || 'meeting details'}`);
                return;
            }

            const meeting = {
                id: meetings.length + 1,
                personId: selectedPerson.id,
                personName: `${selectedPerson.firstName} ${selectedPerson.lastName}`,
                date,
                time,
                duration,
                topic,
                type,
                meetingDetail,
                status: 'pending',
                createdAt: new Date()
            };

            meetings.push(meeting);
            saveToStorage();
            alert('Meeting request sent!');
            switchView('dashboardView');
            updateDashboard();
        }

        // Calling
        function startCall(personName, initials) {
            document.getElementById('callPersonName').textContent = personName;
            document.getElementById('remoteName').textContent = initials;
            document.getElementById('remotePerson').textContent = personName;
            
            callDuration = 0;
            callInterval = setInterval(() => {
                callDuration++;
                const mins = Math.floor(callDuration / 60);
                const secs = callDuration % 60;
                document.getElementById('callTimer').textContent = 
                    `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            }, 1000);

            switchView('callView');
        }

        function endCall() {
            if (callInterval) clearInterval(callInterval);
            switchView('calendarView');
            renderMeetingsList();
        }

        function toggleMic() {
            const btn = document.getElementById('micBtn');
            btn.classList.toggle('muted');
        }

        function toggleVideo() {
            const btn = document.getElementById('videoBtn');
            btn.classList.toggle('muted');
        }

        // Modals
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Profile Management
        function editMyProfile() {
            document.getElementById('avatarInitials').textContent = currentUser.firstName[0] + currentUser.lastName[0];
            document.getElementById('editFirstName').value = currentUser.firstName;
            document.getElementById('editLastName').value = currentUser.lastName;
            document.getElementById('editRole').value = currentUser.role || '';
            document.getElementById('editCompany').value = currentUser.company || '';
            document.getElementById('editLocation').value = currentUser.location || '';
            document.getElementById('editBio').value = currentUser.bio || '';
            document.getElementById('editIndustry').value = currentUser.industry;
            document.getElementById('editInterests').value = (currentUser.interests || []).join(', ');
            document.getElementById('editHobbies').value = (currentUser.hobbies || []).join(', ');
            document.getElementById('editGoals').value = currentUser.goals || '';
            openModal('editProfileModal');
        }

        async function saveProfile() {
            if (!currentUser) return;

            // Get all form values
            const firstName = document.getElementById('editFirstName').value;
            const lastName = document.getElementById('editLastName').value;
            const role = document.getElementById('editRole').value;
            const company = document.getElementById('editCompany').value;
            const location = document.getElementById('editLocation').value;
            const bio = document.getElementById('editBio').value;
            const industry = document.getElementById('editIndustry').value;
            const interests = document.getElementById('editInterests').value.split(',').map(i => i.trim()).filter(Boolean);
            const hobbies = document.getElementById('editHobbies').value.split(',').map(h => h.trim()).filter(Boolean);
            const goals = document.getElementById('editGoals').value;

            try {
                // Update profile in Supabase
                const { error } = await supabaseClient
                    .from('profiles')
                    .update({
                        first_name: firstName,
                        last_name: lastName,
                        role,
                        company,
                        location,
                        bio,
                        industry,
                        interests,
                        hobbies,
                        goals,
                        profile_picture: currentUser.profilePicture || null,
                        resume_url: currentUser.resume || null,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', currentUser.id);

                if (error) throw error;

                // Update local currentUser object
                currentUser.firstName = firstName;
                currentUser.lastName = lastName;
                currentUser.role = role;
                currentUser.company = company;
                currentUser.location = location;
                currentUser.bio = bio;
                currentUser.industry = industry;
                currentUser.interests = interests;
                currentUser.hobbies = hobbies;
                currentUser.goals = goals;

                alert('Profile updated successfully!');
                closeModal('editProfileModal');
                await updateDashboard();
            } catch (error) {
                console.error('Error saving profile:', error);
                alert('Failed to update profile: ' + error.message);
            }
        }

        function handleAvatarUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const MAX = 300;
                    let w = img.width, h = img.height;
                    if (w > h) { if (w > MAX) { h = Math.round(h * MAX / w); w = MAX; } }
                    else       { if (h > MAX) { w = Math.round(w * MAX / h); h = MAX; } }
                    canvas.width = w; canvas.height = h;
                    canvas.getContext('2d').drawImage(img, 0, 0, w, h);
                    const compressed = canvas.toDataURL('image/jpeg', 0.82);
                    currentUser.profilePicture = compressed;
                    document.getElementById('avatarPreview').innerHTML = `<img src="${compressed}" alt="Profile Picture">`;
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function handleResumeUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentUser.resume = e.target.result;
                    document.getElementById('resumePreview').innerHTML = `
                        <div style="margin-top: 1rem; padding: 1rem; background: #d4edda; border-radius: 8px; color: #155724; font-size: 14px;">
                            ‚úì Resume uploaded successfully
                        </div>
                    `;
                };
                reader.readAsDataURL(file);
            }
        }

        // Posts
        function createPost() {
            openModal('createPostModal');
        }

        async function publishPost() {
            if (!currentUser) {
                alert('Please log in to create a post');
                return;
            }

            const content = document.getElementById('postContent').value.trim();
            if (!content) {
                alert('Please write something!');
                return;
            }

            try {
                const { data, error } = await supabaseClient
                    .from('posts')
                    .insert([{
                        author_id: currentUser.id,
                        content
                    }])
                    .select()
                    .single();

                if (error) throw error;

                // Add to local posts array
                posts.unshift({
                    ...data,
                    author: `${currentUser.firstName} ${currentUser.lastName}`,
                    date: 'Just now'
                });

                document.getElementById('postContent').value = '';
                closeModal('createPostModal');
                alert('Post published successfully!');

                // Refresh feed if we're on it
                if (document.getElementById('feedView').classList.contains('active')) {
                    await renderFeed();
                }
            } catch (error) {
                console.error('Error publishing post:', error);
                alert('Failed to publish post: ' + error.message);
            }
        }

        async function likePost(postId) {
            if (!currentUser) {
                alert('Please log in to like posts');
                return;
            }

            // Handle mock posts locally
            if (String(postId).startsWith('mock-')) {
                const post = posts.find(p => String(p.id) === String(postId));
                if (post) {
                    post.likes_count = (post.likes_count || 0) + 1;
                    await renderFeed();
                }
                return;
            }

            try {
                const { data: existing } = await supabaseClient
                    .from('post_likes')
                    .select('id')
                    .eq('post_id', postId)
                    .eq('user_id', currentUser.id)
                    .maybeSingle();

                if (existing) {
                    await supabaseClient
                        .from('post_likes')
                        .delete()
                        .eq('id', existing.id);
                } else {
                    await supabaseClient
                        .from('post_likes')
                        .insert([{
                            post_id: postId,
                            user_id: currentUser.id
                        }]);
                }

                await renderFeed();
            } catch (error) {
                console.error('Error liking post:', error);
                alert('Failed to like post: ' + error.message);
            }
        }

        function toggleComments(postId) {
            const section = document.getElementById(`comments-${postId}`);
            if (!section) return;
            if (section.style.display === 'none') {
                section.style.display = 'block';
                loadComments(postId);
            } else {
                section.style.display = 'none';
            }
        }

        // Store mock comments locally
        const mockComments = {};

        async function loadComments(postId) {
            const container = document.getElementById(`comments-list-${postId}`);
            if (!container) return;

            // Handle mock posts locally
            if (String(postId).startsWith('mock-')) {
                const comments = mockComments[postId] || [];
                container.innerHTML = comments.map(c => `
                    <div style="padding: 0.5rem 0; border-bottom: 1px solid var(--border); font-size: 13px;">
                        <strong>${c.author}</strong>
                        <p style="margin: 0.25rem 0;">${c.content}</p>
                    </div>
                `).join('') || '<p style="font-size: 13px; color: #999;">No comments yet. Be the first!</p>';
                return;
            }

            try {
                const { data: comments, error } = await supabaseClient
                    .from('post_comments')
                    .select('*, profiles(first_name, last_name)')
                    .eq('post_id', postId)
                    .order('created_at', { ascending: true });

                if (error) throw error;

                container.innerHTML = (comments || []).map(c => `
                    <div style="padding: 0.5rem 0; border-bottom: 1px solid var(--border); font-size: 13px;">
                        <strong>${c.profiles.first_name} ${c.profiles.last_name}</strong>
                        <p style="margin: 0.25rem 0;">${c.content}</p>
                    </div>
                `).join('') || '<p style="font-size: 13px; color: #999;">No comments yet. Be the first!</p>';
            } catch (error) {
                console.error('Error loading comments:', error);
            }
        }

        async function submitComment(postId) {
            if (!currentUser) return;
            const input = document.getElementById(`comment-input-${postId}`);
            const text = input.value.trim();
            if (!text) return;

            // Handle mock posts locally
            if (String(postId).startsWith('mock-')) {
                if (!mockComments[postId]) mockComments[postId] = [];
                mockComments[postId].push({
                    author: `${currentUser.firstName} ${currentUser.lastName}`,
                    content: text
                });
                input.value = '';
                await loadComments(postId);
                return;
            }

            try {
                const { error } = await supabaseClient
                    .from('post_comments')
                    .insert([{ post_id: postId, user_id: currentUser.id, content: text }]);

                if (error) throw error;
                input.value = '';
                await loadComments(postId);
            } catch (error) {
                console.error('Error posting comment:', error);
                alert('Failed to post comment: ' + error.message);
            }
        }

        function sharePost(postId) {
            const post = posts.find(p => String(p.id) === String(postId));
            if (!post) return;

            if (navigator.share) {
                navigator.share({
                    title: 'First Sip Post',
                    text: post.content.substring(0, 100),
                    url: window.location.href
                }).catch(() => {});
            } else {
                navigator.clipboard.writeText(post.content).then(() => {
                    alert('Post content copied to clipboard!');
                }).catch(() => {
                    alert('Unable to share.');
                });
            }
        }

        // ===== FEED FUNCTIONS =====
        let activeFeedTab = 'connections';

        function switchFeedTab(tab) {
            activeFeedTab = tab;
            document.getElementById('feedTabConnections').classList.toggle('active', tab === 'connections');
            document.getElementById('feedTabGroups').classList.toggle('active', tab === 'groups');
            renderFeed();
        }

        async function renderFeed() {
            const feedPosts = document.getElementById('feedPosts');

            if (activeFeedTab === 'groups') {
                await renderGroupsFeedTab(feedPosts);
                return;
            }

            // --- Connections feed ---
            const connectedIds = new Set();
            connections.forEach(c => {
                if (c.user_id === currentUser.id) connectedIds.add(c.connected_user_id);
                if (c.connected_user_id === currentUser.id) connectedIds.add(c.user_id);
            });

            let allPosts = [...posts];
            users.forEach(u => {
                if (connectedIds.has(u.id) && u.posts && u.posts.length > 0) {
                    u.posts.forEach(p => {
                        if (!allPosts.find(ep => ep.id === p.id)) {
                            allPosts.push({ ...p, author_id: u.id, author: `${u.firstName} ${u.lastName}` });
                        }
                    });
                }
            });

            const feedItems = allPosts.filter(p => p.author_id !== currentUser.id && connectedIds.has(p.author_id));

            if (feedItems.length === 0) {
                feedPosts.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ü§ù</div>
                        <p>Connect with people to see their posts here!</p>
                        <button class="btn btn-primary" onclick="switchView('discoverView')" style="margin-top:1rem;">Discover People</button>
                    </div>`;
                return;
            }

            feedPosts.innerHTML = feedItems
                .sort((a, b) => new Date(b.created_at || b.date) - new Date(a.created_at || a.date))
                .map(post => {
                    const author = users.find(u => u.id === post.author_id) || currentUser;
                    const authorName = author ? `${author.firstName} ${author.lastName}` : post.author;
                    const avatarContent = author && author.profilePicture
                        ? `<img src="${author.profilePicture}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">`
                        : author ? `${author.firstName[0]}${author.lastName[0]}` : '?';
                    return `
                        <div class="post-card">
                            <div class="post-header">
                                <div style="display:flex;align-items:center;gap:1rem;cursor:pointer;" onclick="viewProfile('${post.author_id}')">
                                    <div class="person-avatar" style="width:48px;height:48px;font-size:20px;">${avatarContent}</div>
                                    <div><strong>${authorName}</strong><p class="post-meta">${post.date || 'Just now'}</p></div>
                                </div>
                            </div>
                            <div class="post-content">${post.content}</div>
                            <div class="post-actions">
                                <button class="post-action-btn" onclick="likePost('${post.id}')">üëç ${post.likes_count || 0} Likes</button>
                                <button class="post-action-btn" onclick="toggleComments('${post.id}')">üí¨ Comment</button>
                                <button class="post-action-btn" onclick="sharePost('${post.id}')">üîÑ Share</button>
                            </div>
                            <div id="comments-${post.id}" style="display:none;margin-top:1rem;padding-top:1rem;border-top:1px solid var(--border);">
                                <div id="comments-list-${post.id}" style="margin-bottom:0.75rem;"></div>
                                <div style="display:flex;gap:0.5rem;">
                                    <input type="text" id="comment-input-${post.id}" placeholder="Write a comment..." style="flex:1;padding:8px;border-radius:8px;border:1px solid var(--border);" onkeypress="if(event.key==='Enter') submitComment('${post.id}')">
                                    <button class="btn btn-primary btn-sm" onclick="submitComment('${post.id}')">Post</button>
                                </div>
                            </div>
                        </div>`;
                }).join('');
        }

        async function renderGroupsFeedTab(container) {
            if (myGroupIds.size === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üë•</div>
                        <p>Join a group to see posts from your communities here!</p>
                        <button class="btn btn-primary" onclick="switchView('groupsView')" style="margin-top:1rem;">Browse Communities</button>
                    </div>`;
                return;
            }

            try {
                const groupIdsList = Array.from(myGroupIds);
                const { data: postsData, error } = await supabaseClient
                    .from('posts')
                    .select('*, profiles!posts_author_id_fkey(id, first_name, last_name), groups!posts_group_id_fkey(name)')
                    .in('group_id', groupIdsList)
                    .order('created_at', { ascending: false })
                    .limit(50);

                if (error) throw error;

                if (!postsData || postsData.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">‚úçÔ∏è</div>
                            <p>No posts in your groups yet ‚Äî be the first to share something!</p>
                        </div>`;
                    return;
                }

                container.innerHTML = postsData.map(post => {
                    const authorName = post.profiles ? `${post.profiles.first_name} ${post.profiles.last_name}` : 'Member';
                    const groupName = post.groups ? post.groups.name : '';
                    const timeAgo = post.created_at ? getTimeAgo(post.created_at) : 'Recently';
                    const authorId = post.profiles ? post.profiles.id : null;
                    return `
                        <div class="post-card">
                            <div class="post-header">
                                <div style="display:flex;align-items:center;gap:1rem;" ${authorId ? `onclick="viewProfile('${authorId}')" style="cursor:pointer;"` : ''}>
                                    <div class="person-avatar" style="width:48px;height:48px;font-size:20px;">${authorName[0]}</div>
                                    <div>
                                        <strong>${authorName}</strong>
                                        <p class="post-meta">${timeAgo} ¬∑ <span style="color:var(--primary);font-weight:600;">${groupName}</span></p>
                                    </div>
                                </div>
                            </div>
                            <div class="post-content">${post.content}</div>
                            <div class="post-actions">
                                <button class="post-action-btn" id="gflike-${post.id}" onclick="likeFeedGroupPost('${post.id}', this)">üëç <span id="gflikecount-${post.id}">${post.likes_count || 0}</span> Likes</button>
                                <button class="post-action-btn" onclick="toggleFeedGroupComments('${post.id}')">üí¨ Comment</button>
                            </div>
                            <div id="gfcomments-${post.id}" style="display:none;margin-top:1rem;padding-top:1rem;border-top:1px solid var(--border);">
                                <div id="gfcomments-list-${post.id}" style="margin-bottom:0.75rem;"></div>
                                <div style="display:flex;gap:0.5rem;">
                                    <input type="text" id="gfcomment-input-${post.id}" placeholder="Write a comment..." style="flex:1;padding:8px;border-radius:8px;border:1px solid var(--border);" onkeypress="if(event.key==='Enter') submitFeedGroupComment('${post.id}')">
                                    <button class="btn btn-primary btn-sm" onclick="submitFeedGroupComment('${post.id}')">Post</button>
                                </div>
                            </div>
                        </div>`;
                }).join('');
            } catch (err) {
                console.error('Error loading group feed:', err);
                container.innerHTML = '<div class="empty-state"><p>Failed to load group posts.</p></div>';
            }
        }

        async function likeFeedGroupPost(postId, btn) {
            if (!currentUser) return;
            try {
                const { data: existing } = await supabaseClient
                    .from('post_likes')
                    .select('id')
                    .eq('post_id', postId)
                    .eq('user_id', currentUser.id)
                    .maybeSingle();

                if (existing) {
                    await supabaseClient.from('post_likes').delete().eq('id', existing.id);
                } else {
                    await supabaseClient.from('post_likes').insert([{ post_id: postId, user_id: currentUser.id }]);
                }

                const countEl = document.getElementById(`gflikecount-${postId}`);
                if (countEl) {
                    const cur = parseInt(countEl.textContent) || 0;
                    countEl.textContent = existing ? Math.max(0, cur - 1) : cur + 1;
                }
                if (btn) {
                    btn.style.color = existing ? '' : 'var(--primary)';
                    btn.style.fontWeight = existing ? '' : '700';
                }
            } catch (err) {
                console.error('Error liking post:', err);
            }
        }

        function toggleFeedGroupComments(postId) {
            const el = document.getElementById(`gfcomments-${postId}`);
            if (el) el.style.display = el.style.display === 'none' ? 'block' : 'none';
        }

        async function submitFeedGroupComment(postId) {
            if (!currentUser) return;
            const input = document.getElementById(`gfcomment-input-${postId}`);
            if (!input || !input.value.trim()) return;
            const text = input.value.trim();

            try {
                const { error } = await supabaseClient
                    .from('post_comments')
                    .insert([{ post_id: postId, user_id: currentUser.id, content: text }]);

                if (error) throw error;

                const listEl = document.getElementById(`gfcomments-list-${postId}`);
                if (listEl) {
                    listEl.innerHTML += `
                        <div style="background:var(--bg-light);border-radius:8px;padding:8px 12px;margin-bottom:6px;font-size:13px;">
                            <strong>${currentUser.firstName}:</strong> ${text}
                        </div>`;
                }
                input.value = '';
            } catch (err) {
                console.error('Error posting comment:', err);
            }
        }

        // ===== SMART RECOMMENDATIONS =====
        function getSmartRecommendations() {
            if (!currentUser) return [];

            const userInterests = currentUser.interests || [];
            const userHobbies = currentUser.hobbies || [];
            const userIndustry = currentUser.industry;

            return users.filter(u => u.id !== currentUser.id).map(user => {
                let score = 0;
                const reasons = [];

                // Field of study match (highest priority)
                if (user.industry === userIndustry) {
                    score += 50;
                    reasons.push(`Same field: ${userIndustry}`);
                }

                // Interests match
                const commonInterests = userInterests.filter(interest =>
                    user.interests && user.interests.includes(interest)
                );
                if (commonInterests.length > 0) {
                    score += commonInterests.length * 20;
                    reasons.push(`Shared interests: ${commonInterests.join(', ')}`);
                }

                // Hobbies match
                if (user.hobbies && userHobbies.length > 0) {
                    const commonHobbies = userHobbies.filter(hobby =>
                        user.hobbies.includes(hobby)
                    );
                    if (commonHobbies.length > 0) {
                        score += commonHobbies.length * 15;
                        reasons.push(`Shared hobbies: ${commonHobbies.join(', ')}`);
                    }
                }

                // Graduation year match
                if (user.location && currentUser.location && user.location === currentUser.location) {
                    score += 10;
                    reasons.push(`Same class: ${user.location}`);
                }

                // School match
                if (user.company && currentUser.company && user.company.toLowerCase() === currentUser.company.toLowerCase()) {
                    score += 25;
                    reasons.push(`Same school: ${user.company}`);
                }

                // Career goals keyword match
                if (user.goals && currentUser.goals) {
                    const userGoalWords = currentUser.goals.toLowerCase().split(/\s+/).filter(w => w.length > 3);
                    const theirGoalWords = user.goals.toLowerCase().split(/\s+/).filter(w => w.length > 3);
                    const commonGoalWords = userGoalWords.filter(word => theirGoalWords.includes(word));
                    if (commonGoalWords.length > 0) {
                        score += Math.min(commonGoalWords.length * 10, 30);
                        reasons.push('Aligned career goals');
                    }
                }

                // Mentorship potential (upperclassmen/alumni mentoring underclassmen)
                if (user.role && currentUser.role && user.industry === userIndustry) {
                    const seniorKeywords = ['senior', 'recent grad', 'junior', 'lead', 'head', 'director', 'vp', 'chief', 'principal', 'staff', 'manager'];
                    const userIsSenior = seniorKeywords.some(k => currentUser.role.toLowerCase().includes(k));
                    const theyAreSenior = seniorKeywords.some(k => user.role.toLowerCase().includes(k));
                    if (userIsSenior !== theyAreSenior) {
                        score += 15;
                        reasons.push('Mentorship potential');
                    }
                }

                return {
                    user,
                    score,
                    reasons
                };
            })
            .sort((a, b) => b.score - a.score); // Sort by score descending; show all
        }

        function renderRecommendations() {
            const recommendations = getSmartRecommendations();

            if (recommendations.length === 0) return '';

            return `
                <div style="margin-bottom: 2rem;">
                    <h2 style="margin-bottom: 1rem;">‚ú® Recommended For You</h2>
                    <div class="grid">
                        ${recommendations.slice(0, 3).map(item => {
                            const user = item.user;
                            const fn = user.firstName || '?';
                            const ln = user.lastName || '?';
                            const isConnected = connections.find(c =>
                                (c.user_id === currentUser.id && c.connected_user_id === user.id) ||
                                (c.connected_user_id === currentUser.id && c.user_id === user.id));
                            const isPending = sentRequests.find(c => c.connected_user_id === user.id);
                            const hasRequestedMe = pendingRequests.find(c => c.user_id === user.id);
                            const avatarContent = user.profilePicture
                                ? `<img src="${user.profilePicture}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`
                                : `${fn[0]}${ln[0]}`;

                            let recActionBtn;
                            if (isConnected) {
                                recActionBtn = `<button class="btn btn-secondary btn-sm" onclick="startMessage('${user.id}')" style="flex: 1;">Message</button>`;
                            } else if (hasRequestedMe) {
                                recActionBtn = `<button class="btn btn-accent btn-sm" onclick="acceptConnection('${hasRequestedMe.id}')" style="flex: 1;">Accept Request</button>`;
                            } else if (isPending) {
                                recActionBtn = `<button class="btn btn-secondary btn-sm" disabled style="flex: 1; opacity: 0.6;">Request Sent</button>`;
                            } else {
                                recActionBtn = `<button class="btn btn-accent btn-sm" onclick="connectUser('${user.id}')" style="flex: 1;">Connect</button>`;
                            }

                            return `
                                <div class="card person-card">
                                    <div style="background: linear-gradient(135deg, var(--accent), var(--primary)); padding: 0.5rem; border-radius: 8px; margin-bottom: 1rem;">
                                        <p style="font-size: 11px; color: white; margin: 0; text-align: center;">${item.score > 0 ? `‚≠ê ${item.score}% Match` : 'üëã New Member'}</p>
                                    </div>
                                    <div class="person-avatar" style="width: 70px; height: 70px; font-size: 28px; margin: 0 auto 1rem;">${avatarContent}</div>
                                    <h3>${fn} ${ln}</h3>
                                    <p class="role">${user.role || user.industry || ''}</p>
                                    <div style="text-align: left; margin: 1rem 0; padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                                        <p style="font-size: 11px; color: var(--primary); font-weight: 600; margin-bottom: 0.5rem;">Why we suggest ${fn}:</p>
                                        ${item.reasons.map(reason => `<p style="font-size: 11px; color: #666; margin: 0.25rem 0;">‚Ä¢ ${reason}</p>`).join('')}
                                    </div>
                                    <div class="profile-actions">
                                        <button class="btn btn-primary btn-sm" onclick="viewProfile('${user.id}')" style="flex: 1;">View Profile</button>
                                        ${recActionBtn}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        // (Recommendations and hobbies integrated into original functions above)

        // ===== AVAILABILITY FUNCTIONS =====
        async function renderAvailability() {
            if (!currentUser) return;

            try {
                const { data: availability, error } = await supabaseClient
                    .from('availability')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('day_of_week', { ascending: true })
                    .order('start_time', { ascending: true });

                if (error) throw error;

                const container = document.getElementById('availabilitySlots');

                if (!availability || availability.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <p>No availability set. Add your available times below.</p>
                        </div>
                    `;
                    return;
                }

                const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

                container.innerHTML = availability.map(slot => `
                    <div class="meeting-card" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <div>
                            <strong>${days[slot.day_of_week]}</strong>
                            <p style="font-size: 14px; color: #666; margin: 0.25rem 0;">
                                ${slot.start_time} - ${slot.end_time}
                            </p>
                        </div>
                        <button class="btn btn-danger btn-sm" onclick="deleteAvailabilitySlot('${slot.id}')">Delete</button>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error rendering availability:', error);
            }
        }

        async function addAvailabilitySlot() {
            if (!currentUser) {
                alert('Please log in');
                return;
            }

            const day = document.getElementById('availabilityDay').value;
            const startTime = document.getElementById('availabilityStartTime').value;
            const endTime = document.getElementById('availabilityEndTime').value;

            if (!startTime || !endTime) {
                alert('Please select start and end times');
                return;
            }

            if (startTime >= endTime) {
                alert('End time must be after start time');
                return;
            }

            try {
                const { error } = await supabaseClient
                    .from('availability')
                    .insert([{
                        user_id: currentUser.id,
                        day_of_week: parseInt(day),
                        start_time: startTime,
                        end_time: endTime,
                        is_available: true
                    }]);

                if (error) throw error;

                await renderAvailability();
                alert('Availability added!');
            } catch (error) {
                console.error('Error adding availability:', error);
                alert('Failed to add availability: ' + error.message);
            }
        }

        async function deleteAvailabilitySlot(slotId) {
            if (!currentUser) return;

            if (!confirm('Delete this availability slot?')) return;

            try {
                const { error } = await supabaseClient
                    .from('availability')
                    .delete()
                    .eq('id', slotId);

                if (error) throw error;

                await renderAvailability();
                alert('Availability deleted');
            } catch (error) {
                console.error('Error deleting availability:', error);
                alert('Failed to delete availability: ' + error.message);
            }
        }

        // ============================================
        // MY PROFILE (LinkedIn-style)
        // ============================================

        function renderMyProfile() {
            if (!currentUser) return;
            const container = document.getElementById('myProfileContent');
            if (!container) return;

            const { percentage, missing } = getProfileCompletion();
            const streak = getLoginStreak();
            const myPosts = posts.filter(p => p.author_id === currentUser.id);
            const chatsCompleted = meetings.filter(m => new Date(m.date) < new Date()).length;

            const initials = `${(currentUser.firstName || '?')[0]}${(currentUser.lastName || '?')[0]}`.toUpperCase();
            const avatarHTML = currentUser.profilePicture
                ? `<img src="${currentUser.profilePicture}" alt="${currentUser.firstName}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`
                : initials;

            const allTags = [
                ...(currentUser.interests || []).map(i => `<span style="padding:7px 15px;background:var(--latte-soft);border:1.5px solid var(--latte);border-radius:100px;font-size:13px;font-weight:500;color:var(--brown);">${i}</span>`),
                ...(currentUser.hobbies || []).map(h => `<span style="padding:7px 15px;background:var(--latte-soft);border:1.5px solid var(--latte);border-radius:100px;font-size:13px;font-weight:500;color:var(--brown);">${h}</span>`)
            ].join('');

            container.innerHTML = `
                <style>
                    @keyframes mpFillBar { from { width:0% } to { width:${percentage}%; } }
                    .mp-btn {
                        transition: transform 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
                    }
                    .mp-btn:hover {
                        transform: translateY(-3px) scale(1.03);
                        box-shadow: 0 10px 28px rgba(28,18,8,0.28) !important;
                    }
                    .mp-btn:active { transform: translateY(-1px) scale(1.01); }
                    .mp-resume-link {
                        transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
                    }
                    .mp-resume-link:hover {
                        transform: translateY(-3px);
                        box-shadow: 0 8px 24px rgba(192,124,58,0.22);
                        border-color: var(--caramel) !important;
                    }
                </style>

                <!-- HERO CARD -->
                <div style="background:var(--card);border-radius:24px;border:1.5px solid var(--border);box-shadow:0 4px 24px rgba(28,18,8,0.08);overflow:hidden;margin-bottom:24px;">
                    <div style="height:110px;background:linear-gradient(130deg,var(--espresso) 0%,var(--brown) 55%,var(--caramel) 100%);"></div>
                    <div style="padding:0 36px 36px;display:flex;align-items:flex-end;gap:24px;flex-wrap:wrap;margin-top:-44px;position:relative;">
                        <div style="width:88px;height:88px;border-radius:50%;background:linear-gradient(135deg,var(--caramel),var(--brown));display:flex;align-items:center;justify-content:center;font-size:30px;font-weight:700;color:#fff;border:4px solid var(--card);box-shadow:0 4px 20px rgba(28,18,8,0.2);flex-shrink:0;">${avatarHTML}</div>
                        <div style="padding-top:52px;flex:1;min-width:180px;">
                            <h1 style="font-family:'Playfair Display',serif;font-size:28px;font-weight:700;color:var(--espresso);line-height:1.1;margin:0;">${currentUser.firstName} ${currentUser.lastName}</h1>
                            <div style="display:flex;align-items:center;gap:10px;margin-top:10px;flex-wrap:wrap;">
                                <span style="padding:5px 14px;border-radius:100px;font-size:12.5px;font-weight:600;background:var(--latte-soft);color:var(--brown);border:1.5px solid var(--latte);">${currentUser.industry || 'Add Major'}</span>
                                <span style="padding:5px 14px;border-radius:100px;font-size:12.5px;font-weight:600;background:linear-gradient(90deg,#E8620A,var(--caramel));color:#fff;box-shadow:0 2px 10px rgba(232,98,10,0.3);">üî• ${streak} day streak</span>
                                <span style="font-size:13px;color:var(--muted);font-weight:500;">üîó ${connections.length} connections</span>
                            </div>
                            <div style="display:flex;align-items:center;gap:18px;margin-top:8px;flex-wrap:wrap;">
                                ${currentUser.company ? `<span style="font-size:13px;color:var(--muted);">üè´ ${currentUser.company}</span>` : ''}
                                ${currentUser.location ? `<span style="font-size:13px;color:var(--muted);">üéì Class of ${currentUser.location}</span>` : ''}
                            </div>
                        </div>
                        <div style="padding-top:52px;flex-shrink:0;">
                            <button onclick="editMyProfile()" class="mp-btn" style="padding:10px 22px;background:var(--brown);color:#fff;border:none;border-radius:10px;font-size:13.5px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;box-shadow:0 3px 12px rgba(28,18,8,0.2);">‚úèÔ∏è Edit Profile</button>
                        </div>
                    </div>
                </div>

                <!-- PROGRESS (hidden at 100%) -->
                ${percentage < 100 ? `
                <div style="background:var(--card);border-radius:20px;border:1.5px solid var(--border);padding:24px 32px;box-shadow:0 4px 24px rgba(28,18,8,0.06);display:flex;align-items:center;gap:28px;margin-bottom:24px;flex-wrap:wrap;">
                    <div style="flex-shrink:0;">
                        <strong style="font-family:'Playfair Display',serif;font-size:22px;font-weight:700;color:var(--caramel);display:block;">${percentage}%</strong>
                        <span style="font-size:13px;color:var(--muted);font-weight:500;white-space:nowrap;">Profile Complete</span>
                    </div>
                    <div style="flex:1;min-width:120px;height:8px;background:var(--latte-soft);border-radius:100px;overflow:hidden;">
                        <div style="height:100%;width:${percentage}%;background:linear-gradient(90deg,var(--caramel),#E8620A);border-radius:100px;animation:mpFillBar 1.2s cubic-bezier(0.22,1,0.36,1) forwards;"></div>
                    </div>
                    <div style="font-size:12.5px;color:var(--muted);white-space:nowrap;flex-shrink:0;">Next: <span onclick="editMyProfile()" style="color:var(--caramel);font-weight:600;cursor:pointer;">${missing[0]} ‚Üí</span></div>
                </div>
                ` : ''}

                <!-- STATS ROW -->
                <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:24px;">
                    <div style="background:var(--card);border:1.5px solid var(--border);border-radius:14px;padding:14px 18px;box-shadow:0 4px 24px rgba(28,18,8,0.06);display:flex;align-items:center;gap:14px;">
                        <div style="font-size:18px;width:36px;height:36px;border-radius:10px;background:var(--latte-soft);display:flex;align-items:center;justify-content:center;flex-shrink:0;">üî•</div>
                        <div>
                            <div style="font-family:'Playfair Display',serif;font-size:22px;font-weight:700;color:var(--espresso);line-height:1;">${streak}</div>
                            <div style="font-size:11.5px;color:var(--muted);font-weight:500;margin-top:2px;">Day Streak</div>
                        </div>
                    </div>
                    <div style="background:var(--card);border:1.5px solid var(--border);border-radius:14px;padding:14px 18px;box-shadow:0 4px 24px rgba(28,18,8,0.06);display:flex;align-items:center;gap:14px;">
                        <div style="font-size:18px;width:36px;height:36px;border-radius:10px;background:var(--latte-soft);display:flex;align-items:center;justify-content:center;flex-shrink:0;">üîó</div>
                        <div>
                            <div style="font-family:'Playfair Display',serif;font-size:22px;font-weight:700;color:var(--espresso);line-height:1;">${connections.length}</div>
                            <div style="font-size:11.5px;color:var(--muted);font-weight:500;margin-top:2px;">Connections</div>
                        </div>
                    </div>
                    <div style="background:var(--card);border:1.5px solid var(--border);border-radius:14px;padding:14px 18px;box-shadow:0 4px 24px rgba(28,18,8,0.06);display:flex;align-items:center;gap:14px;">
                        <div style="font-size:18px;width:36px;height:36px;border-radius:10px;background:var(--latte-soft);display:flex;align-items:center;justify-content:center;flex-shrink:0;">‚òï</div>
                        <div>
                            <div style="font-family:'Playfair Display',serif;font-size:22px;font-weight:700;color:var(--espresso);line-height:1;">${chatsCompleted}</div>
                            <div style="font-size:11.5px;color:var(--muted);font-weight:500;margin-top:2px;">Coffee Chats</div>
                        </div>
                    </div>
                </div>

                <!-- BIO -->
                <div style="background:var(--card);border-radius:20px;border:1.5px solid var(--border);padding:32px;box-shadow:0 4px 24px rgba(28,18,8,0.06);margin-bottom:24px;">
                    <div style="font-family:'Playfair Display',serif;font-size:18px;font-weight:600;color:var(--espresso);margin-bottom:16px;">üí¨ Bio</div>
                    ${currentUser.bio
                        ? `<p style="font-size:15px;color:var(--muted);line-height:1.8;margin:0;">${currentUser.bio}</p>`
                        : `<p style="font-size:14px;color:var(--muted);font-style:italic;margin:0;">No bio added yet. <span onclick="editMyProfile()" style="color:var(--caramel);font-weight:600;cursor:pointer;font-style:normal;">Add one ‚Üí</span></p>`
                    }
                </div>

                <!-- CAREER GOALS + SKILLS (2-col) -->
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:24px;">
                    <div style="background:var(--card);border-radius:20px;border:1.5px solid var(--border);padding:32px;box-shadow:0 4px 24px rgba(28,18,8,0.06);">
                        <div style="font-family:'Playfair Display',serif;font-size:18px;font-weight:600;color:var(--espresso);margin-bottom:16px;">üéØ Career Goals</div>
                        ${currentUser.goals
                            ? `<p style="font-size:15px;color:var(--muted);line-height:1.75;margin:0;">${currentUser.goals}</p>`
                            : `<p style="font-size:14px;color:var(--muted);font-style:italic;margin:0;">No career goals added yet. <span onclick="editMyProfile()" style="color:var(--caramel);font-weight:600;cursor:pointer;font-style:normal;">Add yours ‚Üí</span></p>`
                        }
                    </div>
                    <div style="background:var(--card);border-radius:20px;border:1.5px solid var(--border);padding:32px;box-shadow:0 4px 24px rgba(28,18,8,0.06);">
                        <div style="font-family:'Playfair Display',serif;font-size:18px;font-weight:600;color:var(--espresso);margin-bottom:16px;">‚ú® Skills & Interests</div>
                        ${allTags
                            ? `<div style="display:flex;flex-wrap:wrap;gap:10px;">${allTags}</div>`
                            : `<p style="font-size:14px;color:var(--muted);font-style:italic;margin:0;">No interests added yet. <span onclick="editMyProfile()" style="color:var(--caramel);font-weight:600;cursor:pointer;font-style:normal;">Add yours ‚Üí</span></p>`
                        }
                    </div>
                </div>

                <!-- RESUME -->
                ${currentUser.resume ? `
                <div style="background:var(--card);border-radius:20px;border:1.5px solid var(--border);padding:32px;box-shadow:0 4px 24px rgba(28,18,8,0.06);margin-bottom:24px;">
                    <div style="font-family:'Playfair Display',serif;font-size:18px;font-weight:600;color:var(--espresso);margin-bottom:16px;">üìÑ Resume</div>
                    <a href="${currentUser.resume}" download="${currentUser.firstName}_${currentUser.lastName}_Resume.pdf" class="mp-resume-link" style="display:inline-flex;align-items:center;gap:14px;padding:14px 20px;background:var(--latte-soft);border:1.5px solid var(--latte);border-radius:12px;text-decoration:none;color:var(--espresso);">
                        <span style="font-size:28px;">üìÑ</span>
                        <div>
                            <div style="font-weight:600;font-size:14px;">${currentUser.firstName} ${currentUser.lastName} ‚Äî Resume</div>
                            <div style="font-size:12px;color:var(--muted);margin-top:2px;">Click to download</div>
                        </div>
                    </a>
                </div>
                ` : ''}

                <!-- BADGES -->
                <div style="background:var(--card);border-radius:20px;border:1.5px solid var(--border);padding:32px;box-shadow:0 4px 24px rgba(28,18,8,0.06);margin-bottom:24px;">
                    <div style="font-family:'Playfair Display',serif;font-size:18px;font-weight:600;color:var(--espresso);margin-bottom:20px;">üèÖ Badges</div>
                    <div class="badge-grid" id="myProfileBadgesView"></div>
                </div>

                <!-- MY POSTS -->
                <div style="background:var(--card);border-radius:20px;border:1.5px solid var(--border);padding:32px;box-shadow:0 4px 24px rgba(28,18,8,0.06);">
                    <div style="font-family:'Playfair Display',serif;font-size:18px;font-weight:600;color:var(--espresso);margin-bottom:20px;">üìù My Posts</div>
                    ${myPosts.length > 0
                        ? myPosts.map(post => `
                            <div style="padding:16px;border:1.5px solid var(--border);border-radius:12px;margin-bottom:12px;background:var(--warm-white);">
                                <p style="color:var(--espresso);font-size:14px;line-height:1.7;margin:0;">${post.content}</p>
                                <p style="font-size:12px;color:var(--muted);margin-top:10px;margin-bottom:0;">${post.date || 'Recently'} ¬∑ ${post.likes_count || 0} likes</p>
                            </div>
                        `).join('')
                        : `<div style="display:flex;flex-direction:column;align-items:center;padding:40px 20px;text-align:center;gap:14px;">
                            <div style="width:64px;height:64px;border-radius:50%;background:var(--latte-soft);display:flex;align-items:center;justify-content:center;font-size:26px;border:1.5px solid var(--latte);">‚úçÔ∏è</div>
                            <p style="color:var(--muted);font-size:14px;margin:0;">You haven't posted anything yet. Share your thoughts!</p>
                            <button onclick="switchView('hubView')" class="mp-btn" style="display:inline-flex;align-items:center;gap:6px;padding:9px 22px;background:linear-gradient(90deg,var(--brown),var(--caramel));color:#fff;border:none;border-radius:100px;font-size:13.5px;font-weight:600;cursor:pointer;box-shadow:0 3px 14px rgba(28,18,8,0.2);font-family:'DM Sans',sans-serif;">‚ú® Create your first post</button>
                        </div>`
                    }
                </div>
            `;

            setTimeout(() => renderBadges('myProfileBadgesView'), 50);
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================

        function getTimeAgo(date) {
            if (!date) return '';
            const now = Date.now();
            const diff = now - new Date(date).getTime();
            const mins = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            if (mins < 1) return 'Just now';
            if (mins < 60) return `${mins}m ago`;
            if (hours < 24) return `${hours}h ago`;
            if (days < 7) return `${days}d ago`;
            return `${Math.floor(days / 7)}w ago`;
        }

        function animateCounter(elementId, target) {
            const el = document.getElementById(elementId);
            if (!el) return;
            const current = parseInt(el.textContent) || 0;
            if (current === target) { el.textContent = target; return; }
            const duration = 600;
            const start = performance.now();
            function tick(now) {
                const elapsed = now - start;
                const progress = Math.min(elapsed / duration, 1);
                const eased = 1 - Math.pow(1 - progress, 3);
                el.textContent = Math.round(current + (target - current) * eased);
                if (progress < 1) requestAnimationFrame(tick);
            }
            requestAnimationFrame(tick);
        }

        // ============================================
        // TOAST NOTIFICATIONS
        // ============================================

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            if (!container) return;
            const icons = { success: '&#10003;', info: '&#9749;', warning: '&#9888;', error: '&#10007;', celebration: '&#127881;' };
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<span>${icons[type] || ''}</span> ${message}`;
            container.appendChild(toast);
            setTimeout(() => { if (toast.parentNode) toast.remove(); }, 3200);
        }

        // ============================================
        // CONFETTI
        // ============================================

        function showConfetti() {
            const colors = ['#D4A574', '#6F4E37', '#FF9800', '#4CAF50', '#FF6B6B', '#8B6F47'];
            for (let i = 0; i < 30; i++) {
                const piece = document.createElement('div');
                piece.className = 'confetti-piece';
                piece.style.left = `${Math.random() * 100}vw`;
                piece.style.top = `${Math.random() * 30}vh`;
                piece.style.background = colors[Math.floor(Math.random() * colors.length)];
                piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
                piece.style.width = `${6 + Math.random() * 6}px`;
                piece.style.height = `${6 + Math.random() * 6}px`;
                piece.style.animationDuration = `${1 + Math.random() * 1.5}s`;
                piece.style.animationDelay = `${Math.random() * 0.5}s`;
                document.body.appendChild(piece);
                setTimeout(() => piece.remove(), 3000);
            }
        }

        // ============================================
        // PROFILE COMPLETION
        // ============================================

        function getProfileCompletion() {
            if (!currentUser) return { percentage: 0, missing: [], completed: [] };
            const fields = [
                { key: 'firstName', label: 'First Name' },
                { key: 'lastName', label: 'Last Name' },
                { key: 'bio', label: 'Bio' },
                { key: 'role', label: 'Status' },
                { key: 'company', label: 'School' },
                { key: 'location', label: 'Location' },
                { key: 'industry', label: 'Field of Study' },
                { key: 'interests', label: 'Interests', isArray: true },
                { key: 'hobbies', label: 'Hobbies', isArray: true },
                { key: 'goals', label: 'Career Goals' },
                { key: 'profilePicture', label: 'Profile Picture' },
                { key: 'resume', label: 'Resume' }
            ];
            const completed = [];
            const missing = [];
            fields.forEach(f => {
                const val = currentUser[f.key];
                const filled = f.isArray ? (val && val.length > 0) : (val && val.trim && val.trim() !== '');
                if (filled) completed.push(f.label);
                else missing.push(f.label);
            });
            return {
                percentage: Math.round((completed.length / fields.length) * 100),
                missing,
                completed
            };
        }

        function renderProfileCompletion() {
            const { percentage, missing } = getProfileCompletion();
            const ring = document.getElementById('progressRing');
            const text = document.getElementById('progressPercent');
            const msg = document.getElementById('completionMsg');
            const card = document.getElementById('completionCard');
            if (!ring || !text) return;

            const circumference = 2 * Math.PI * 34;
            const offset = circumference - (percentage / 100) * circumference;
            ring.style.strokeDasharray = circumference;
            setTimeout(() => { ring.style.strokeDashoffset = offset; }, 100);
            text.textContent = percentage + '%';

            if (percentage === 100) {
                if (card) card.style.display = 'none';
            } else {
                if (card) card.style.display = 'flex';
                msg.textContent = `Add: ${missing.slice(0, 3).join(', ')}${missing.length > 3 ? '...' : ''}`;
            }
        }

        // ============================================
        // GETTING STARTED CHECKLIST
        // ============================================

        function renderGettingStarted() {
            const container = document.getElementById('gettingStarted');
            const list = document.getElementById('checklistItems');
            if (!container || !list) return;

            if (localStorage.getItem('gettingStartedDismissed') === 'true') {
                container.style.display = 'none';
                return;
            }
            container.style.display = 'block';

            const { percentage } = getProfileCompletion();
            const hasConnections = connections.length > 0;
            const hasJoinedGroup = myGroupIds.size > 0;
            const hasSentMessage = sentMessageCount > 0;
            const hasMeeting = meetings.length > 0;

            const items = [
                { label: 'Complete your profile', done: percentage >= 80, action: 'editMyProfile()' },
                { label: 'Discover people to connect with', done: hasConnections, action: "switchView('discoverView')" },
                { label: 'Join a community', done: hasJoinedGroup, action: "switchView('groupsView')" },
                { label: 'Send your first message', done: hasSentMessage, action: "switchView('messagesView')" },
                { label: 'Schedule a coffee chat', done: hasMeeting, action: "switchView('calendarView')" }
            ];

            list.innerHTML = items.map(item => `
                <li class="checklist-item ${item.done ? 'done' : ''}" onclick="${item.action}">
                    <span class="check-icon">${item.done ? '&#10003;' : ''}</span>
                    <span class="check-label">${item.label}</span>
                </li>
            `).join('');
        }

        function dismissGettingStarted() {
            localStorage.setItem('gettingStartedDismissed', 'true');
            const el = document.getElementById('gettingStarted');
            if (el) el.style.display = 'none';
        }

        // ============================================
        // NOTIFICATIONS
        // ============================================

        let notifications = [];

        function generateNotifications() {
            notifications = [];
            const now = new Date();

            // Upcoming meeting reminders
            meetings.forEach(m => {
                const meetingTime = new Date(m.start_time || m.startTime);
                const hoursUntil = (meetingTime - now) / 3600000;
                if (hoursUntil > 0 && hoursUntil < 24) {
                    const partner = users.find(u => u.id === m.participant_id || u.id === m.participantId);
                    notifications.push({
                        id: 'meeting-' + m.id,
                        type: 'meeting',
                        icon: '&#128197;',
                        text: `Upcoming chat${partner ? ` with ${partner.firstName}` : ''} in ${Math.round(hoursUntil)}h`,
                        time: meetingTime,
                        unread: true
                    });
                }
            });

            // Pending connection requests
            if (pendingRequests.length > 0) {
                pendingRequests.forEach(req => {
                    const requester = users.find(u => u.id === req.user_id);
                    const name = requester ? `${requester.firstName} ${requester.lastName}` : 'Someone';
                    notifications.unshift({
                        id: 'pending-' + req.id,
                        type: 'connection',
                        icon: 'ü§ù',
                        text: `${name} wants to connect with you`,
                        time: new Date(req.created_at || now),
                        unread: true,
                        action: () => switchHubTab('network')
                    });
                });
            }

            // Connection notifications
            if (connections.length > 0) {
                notifications.push({
                    id: 'conn-welcome',
                    type: 'connection',
                    icon: '&#129309;',
                    text: `You have ${connections.length} connection${connections.length > 1 ? 's' : ''}. Keep growing your network!`,
                    time: new Date(now - 3600000),
                    unread: false
                });
            }

            // Welcome notification
            notifications.push({
                id: 'welcome',
                type: 'event',
                icon: '&#9749;',
                text: 'Welcome to First Sip! Start by completing your profile.',
                time: new Date(now - 86400000),
                unread: false
            });

            renderNotifications();
        }

        function renderNotifications() {
            const list = document.getElementById('notifList');
            const badge = document.getElementById('bellBadge');
            if (!list) return;

            const unreadCount = notifications.filter(n => n.unread).length;

            if (badge) {
                badge.textContent = unreadCount;
                badge.classList.toggle('hidden', unreadCount === 0);
            }

            // Shake bell if new notifications
            if (unreadCount > 0) {
                const bell = document.getElementById('notifBell');
                if (bell) {
                    bell.classList.add('has-new');
                    setTimeout(() => bell.classList.remove('has-new'), 700);
                }
            }

            if (notifications.length === 0) {
                list.innerHTML = '<div class="notification-empty"><p>&#9749; No notifications yet</p><p style="font-size: 12px;">You\'re all caught up!</p></div>';
                return;
            }

            list.innerHTML = notifications.map(n => {
                const hasAction = !!n.action;
                return `
                <div class="notification-item ${n.unread ? 'unread' : ''}${hasAction ? ' notif-clickable' : ''}" onclick="handleNotifClick('${n.id}')">
                    <div class="notification-icon ${n.type}">${n.icon}</div>
                    <div class="notification-text">
                        <p>${n.text}</p>
                        <span class="notif-time">${getTimeAgo(n.time)}</span>
                    </div>
                </div>`;
            }).join('');
        }

        function toggleNotifications() {
            const panel = document.getElementById('notifPanel');
            const overlay = document.getElementById('notifOverlay');
            if (!panel || !overlay) return;
            const isOpen = panel.classList.contains('open');
            panel.classList.toggle('open');
            overlay.classList.toggle('open');
        }

        function markNotificationRead(id) {
            const notif = notifications.find(n => n.id === id);
            if (notif) notif.unread = false;
            renderNotifications();
        }

        function handleNotifClick(id) {
            markNotificationRead(id);
            const notif = notifications.find(n => n.id === id);
            if (notif && notif.action) {
                notif.action();
                toggleNotifications();
            }
        }

        function clearAllNotifications() {
            notifications = [];
            renderNotifications();
            showToast('Notifications cleared', 'info');
        }

        // ============================================
        // GAMIFICATION - BADGES & STREAKS
        // ============================================

        const BADGES = [
            { id: 'first-sip', name: 'First Sip', icon: '&#9749;', desc: 'Complete your profile', check: () => getProfileCompletion().percentage >= 50 },
            { id: 'regular', name: 'Regular', icon: '&#128260;', desc: '3-day login streak', check: () => getLoginStreak() >= 3 },
            { id: 'connoisseur', name: 'Connoisseur', icon: '&#127942;', desc: '10+ connections', check: () => connections.length >= 10 },
            { id: 'connector', name: 'Connector', icon: '&#129309;', desc: 'Send 5+ messages', check: () => sentMessageCount >= 5 },
            { id: 'butterfly', name: 'Social Butterfly', icon: '&#129419;', desc: 'Join 3+ groups', check: () => myGroupIds.size >= 3 },
            { id: 'icebreaker', name: 'Icebreaker', icon: '&#129482;', desc: 'Use conversation starter', check: () => localStorage.getItem('usedIcebreaker') === 'true' },
            { id: 'profile-pro', name: 'Profile Pro', icon: '&#11088;', desc: '100% profile completion', check: () => getProfileCompletion().percentage === 100 }
        ];

        function checkBadges() {
            return BADGES.map(badge => ({
                ...badge,
                earned: badge.check()
            }));
        }

        function checkBadgesWithCelebration() {
            const prev = JSON.parse(localStorage.getItem('earnedBadges') || '[]');
            const badges = checkBadges();
            const newlyEarned = badges.filter(b => b.earned && !prev.includes(b.id));

            localStorage.setItem('earnedBadges', JSON.stringify(badges.filter(b => b.earned).map(b => b.id)));

            if (newlyEarned.length > 0) {
                setTimeout(() => showBadgeEarned(newlyEarned[0]), 1000);
            }
        }

        function showBadgeEarned(badge) {
            showConfetti();
            const overlay = document.createElement('div');
            overlay.className = 'badge-toast-overlay';
            overlay.onclick = () => overlay.remove();
            overlay.innerHTML = `
                <div class="badge-toast-card">
                    <div class="big-badge">${badge.icon}</div>
                    <h2 style="color: var(--primary); margin-bottom: 0.5rem;">Badge Earned!</h2>
                    <h3 style="color: var(--accent); margin-bottom: 0.5rem;">${badge.name}</h3>
                    <p style="color: #999; font-size: 13px;">${badge.desc}</p>
                    <button class="btn btn-accent" onclick="this.closest('.badge-toast-overlay').remove()" style="margin-top: 1rem;">Awesome!</button>
                </div>
            `;
            document.body.appendChild(overlay);
            setTimeout(() => { if (overlay.parentNode) overlay.remove(); }, 5000);
        }

        function renderBadges(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            const badges = checkBadges();
            container.innerHTML = badges.map(b => `
                <div class="badge-item ${b.earned ? '' : 'locked'}">
                    <div class="badge-tooltip">${b.desc}</div>
                    <div class="badge-icon">${b.icon}</div>
                    <span class="badge-name">${b.name}</span>
                </div>
            `).join('');
        }

        function renderDashboardBadges() {
            renderBadges('dashboardBadges');
        }

        function recordLogin() {
            const history = JSON.parse(localStorage.getItem('loginHistory') || '[]');
            const today = new Date().toDateString();
            if (!history.includes(today)) {
                history.push(today);
                // Keep last 90 days only
                if (history.length > 90) history.shift();
                localStorage.setItem('loginHistory', JSON.stringify(history));
            }
        }

        function getLoginStreak() {
            const history = JSON.parse(localStorage.getItem('loginHistory') || '[]');
            if (history.length === 0) return 0;
            let streak = 1;
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // Check if logged in today
            if (!history.includes(today.toDateString())) return 0;

            for (let i = 1; i < 365; i++) {
                const checkDate = new Date(today);
                checkDate.setDate(checkDate.getDate() - i);
                if (history.includes(checkDate.toDateString())) {
                    streak++;
                } else {
                    break;
                }
            }
            return streak;
        }

        init();
    </script>

    <!-- Notification Panel -->
    <div class="notification-panel-overlay" id="notifOverlay" onclick="toggleNotifications()"></div>
    <div class="notification-panel" id="notifPanel">
        <div class="notification-panel-header">
            <h3>Notifications</h3>
            <button class="btn btn-sm" onclick="clearAllNotifications()" style="font-size: 12px;">Clear All</button>
        </div>
        <div class="notification-list" id="notifList"></div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
</body>
</html>
